22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
important point 
When the VSALocal update is completed in VSADemo, move all the data to Vvsalocal, vsademo ```start . Similarly, continue moving data from VSADemo to VSALive


Comment all places on vsademo and uncomment on vsalive 

#1
   app\Http\Controllers\ApplyleaveController.php
   app\Http\Controllers\TimesheetController.php

   itsupport_delhi@vsa.co.in  ise comment kar de and add own mail on vsademo sukhbahadur1993@gmail.com

#2
     agar is per koi bhi update ho to profile me 10th and 12th ka documnet check karle ek baar ye baar baar problem aata hai 
     independence ke ander create and view file insert karna hai 
     IndependenceController.php
     TeammemberController (1).php

Please check once vsalive bugs hare file


vsalocal, vsademo, vsalive ```start hare 
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\ApplyleaveController.php
    public function store(Request $request)


      $request->validate([
      'leavetype' => "required",
      'to' => "required",
      'from' => "required",
    ]);


    $authUserId = auth()->user()->teammember_id;
    $joinigandrejoindate = DB::table('teammembers')
      ->where('teammembers.id',  $authUserId)
      ->leftJoin('teamrolehistory', 'teamrolehistory.teammember_id', '=', 'teammembers.id')
      ->leftJoin('rejoiningsamepost', 'rejoiningsamepost.teammember_id', '=', 'teammembers.id')
      ->value(DB::raw('COALESCE(teamrolehistory.rejoiningdate, rejoiningsamepost.rejoiningdate, teammembers.joining_date)'));

    if ($joinigandrejoindate) {
      $date = Carbon::parse($joinigandrejoindate);
      if ($date->year > 2023) {
        $timesheetRecordcheck = DB::table('timesheetusers')
          // ->where('status', '0')
          ->whereIn('status', [0, 1, 2, 3])
          ->where('createdby', $authUserId)
          ->where('date', $joinigandrejoindate)
          ->exists();

        if (!$timesheetRecordcheck) {
          $output = ['msg' => 'Your timesheet has not been filled on the joining date. Please fill it'];
          return back()->with('statuss', $output);
        }
      }
    }

    $skipaftertrue = false;






22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\TimesheetController.php
replace it 

    public function timesheetrequestupdate(Request $request)
  {
    try {
      $request->validate([
        'reason' => 'required',
        'file' => 'nullable|mimes:png,pdf,jpeg,jpg|max:5120',
      ], [
        'file.max' => 'The file may not be greater than 5 MB.',
      ]);

      $fileName =  $request->attachmentexist ?? null;
      if ($request->hasFile('file')) {
        // public\backEnd\image\confirmationfile
        $destinationPath = public_path('backEnd/image/confirmationfile');
        // Delete the existing file if it exists
        if ($request->attachmentexist) {
          $existingFilePath = $destinationPath . '/' . $request->attachmentexist;
          if (file_exists($existingFilePath)) {
            unlink($existingFilePath);
          }
        }
        // Process the new file upload
        $file = $request->file('file');
        $fileName = $file->getClientOriginalName();
        $file->move($destinationPath, $fileName);
      }

      DB::table('timesheetrequests')
        ->where('id', $request->timesheetrequestid)
        ->update([
          'reason' => $request->reason,
          'partner' => $request->approver,
          'attachment' => $fileName,
          'updated_at' => date('Y-m-d H:i:s'),
        ]);

      // timesheet request mail to partner
      $teammembermail = Teammember::where('id', $request->approver)->pluck('emailid')->first();
      $name = Teammember::where('id', auth()->user()->teammember_id)
        ->select('team_member', 'staffcode')
        ->first();

      $data = array(
        'teammember' => $name ?? '',
        'reason' => $request->reason ?? '',
        'created_at' => date('d-m-Y H:i:s'),
        'email' => $teammembermail ?? '',
        'id' => $id ?? '',
      );

      Mail::send('emails.timesheetrequestform', $data, function ($msg) use ($data) {
        $msg->to($data['email']);
        // $msg->cc('itsupport_delhi@vsa.co.in');
        $msg->subject('Timesheet Submission Request has been Edited');
      });

      $output = array('msg' => 'Updated Successfully');
      return back()->with('success', $output);
    } catch (Exception $e) {
      DB::rollBack();
      Log::emergency("File:" . $e->getFile() . "Line:" . $e->getLine() . "Message:" . $e->getMessage());
      report($e);
      return response()->json(['success' => false, 'msg' => $e->getMessage()]);
    }
  }








1.The client wants the URL to redirect to the open leave page when the partner clicks on the 'Here' button in the email ```start
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\applyleave\openindex.blade.php


       <div class="content-header row align-items-center m-0">
          <nav aria-label="breadcrumb" class="col-sm-4 order-sm-last mb-3 mb-sm-0 p-0 ">
              @if (Auth::user()->role_id == 11 || Auth::user()->role_id == 18)
                  @if (isset($myapplyleaveDatas))
                      <a href="{{ url('leave/teamapplication/') }}" style="float: right;" class="btn btn-success ml-2">Team
                          Application</a>
                  @endif
              @endif
              @if (isset($myapplyleaveDatas))
                  <a href="{{ url('applyleave/create/') }}" style="float: right;" class="btn btn-success ml-2">Apply
                      Leave</a>
              @endif
          </nav>
          <div class="col-sm-8 header-title p-0">
              <div class="media">
                  <div class="header-icon text-success mr-3"><i class="typcn typcn-puzzle-outline"></i></div>
                  <div class="media-body">
                      <h1 class="font-weight-bold">Open Leave</h1>
                      <small>From now on you will start your activities.</small>
                  </div>
              </div>
          </div>
      </div>
	  
	  
	  
	  
	  
	  
	  
	  
	  
	  
	  
	  
	  
	  
	  
	  
	  
	  
              <div class="card-body">
                  @component('backEnd.components.alert')
                  @endcomponent
                  <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                      <li class="nav-item">
                          <a class="nav-link active" id="pills-home-tab" data-toggle="pill" href="#pills-home"
                              role="tab" aria-controls="pills-home" aria-selected="true">
                              @if (isset($myapplyleaveDatas))
                                  My Application
                              @else
                                  Team Application
                              @endif
                          </a>
                      </li>

                      @if (Auth::user()->role_id == 13)
                          @if (isset($myapplyleaveDatas))
                              <li class="nav-item">
                                  <a class="nav-link" id="pills-user-tab" data-toggle="pill" href="#pills-user"
                                      role="tab" aria-controls="pills-user" aria-selected="false">Team Application</a>
                              </li>
                          @else
                          @endif
                      @endif
                  </ul>

                  <br>
                  <div class="tab-content" id="pills-tabContent">
                      @if (isset($myapplyleaveDatas))
                          <div class="tab-pane fade show active" id="pills-home" role="tabpanel"
                              aria-labelledby="pills-home-tab">
                              <div class="table-responsive">
                                  <table id="examplee" class="table display table-bordered table-striped table-hover">
                                      <thead>
                                          <tr>
                                              <th class="textfixed">Date of Request</th>
                                              <th>Employee</th>
                                              <th class="textfixed">Staff Code</th>
                                              <th>Leave Type</th>
                                              <th>Approver</th>
                                              <th class="textfixed">Approver Code</th>
                                              <th class="textfixed">Reason for Leave</th>
                                              <th>Leave Period</th>
                                              <th>Days</th>
                                              <th>Status</th>
                                              @foreach ($myapplyleaveDatas as $applyleaveDatas)
                                                  @if ($applyleaveDatas->leavetype == 11 && $applyleaveDatas->status == 1 && $loop->first)
                                                      <th>Action</th>
                                                  @endif
                                              @endforeach
                                          </tr>
                                      </thead>
                                      <tbody>

                                          @foreach ($myapplyleaveDatas as $applyleaveDatas)
                                              <tr>
                                                  <td>{{ date('d-m-Y', strtotime($applyleaveDatas->created_at)) ?? '' }}
                                                  </td>
                                                  <td class="textfixed"> <a
                                                          href="{{ route('applyleave.show', $applyleaveDatas->id) }}">
                                                          {{ $applyleaveDatas->team_member ?? '' }}</a></td>
                                                  {{-- <td>{{ $applyleaveDatas->staffcode ?? '' }}</td> --}}
                                                  <td>{{ $applyleaveDatas->newstaff_code ?? $applyleaveDatas->staffcode }}
                                                  </td>
                                                  <td class="textfixed">

                                                      {{ $applyleaveDatas->name ?? '' }}<br>
                                                      @if ($applyleaveDatas->type == '0')
                                                          <b>Type :</b> <span>Birthday</span><br>
                                                          <span><b>Birthday Date :
                                                              </b>{{ date(
                                                                  'F d,Y',
                                                                  strtotime(
                                                                      App\Models\Teammember::select('dateofbirth')->where('id', $applyleaveDatas->createdby)->first()->dateofbirth,
                                                                  ),
                                                              ) ?? '' }}</span>
                                                      @elseif($applyleaveDatas->type == '1')
                                                          <span>Religious Festival</span>
                                                      @endif
                                                      @if ($applyleaveDatas->examtype == '0')
                                                          <b>Exam Type :</b> <span>PCC</span>
                                                      @elseif($applyleaveDatas->examtype == '1')
                                                          <b>Exam Type :</b> <span>CA Final</span>
                                                      @elseif($applyleaveDatas->examtype == '2')
                                                          <b>Exam Type :</b> <span>B.Com</span>
                                                      @endif
                                                      @if ($applyleaveDatas->examtype == '3')
                                                          <b>Other :</b>
                                                          <span>{{ $applyleaveDatas->otherexam ?? '' }}</span>
                                                      @endif
                                                  </td>
                                                  <td class="textfixed">
                                                      {{ App\Models\Teammember::select('team_member')->where('id', $applyleaveDatas->approver)->first()->team_member ?? '' }}

                                                  </td>
                                                  <td>
                                                      {{ App\Models\Teammember::select('team_member', 'staffcode')->where('id', $applyleaveDatas->approver)->first()->staffcode ?? '' }}
                                                  </td>

                                                  {{-- <td class="textfixed">{{ $applyleaveDatas->reasonleave ?? '' }} </td> --}}
                                                  {{-- <td class="textfixed">
                                                @if (strlen($applyleaveDatas->reasonleave) > 25)
                                                    <span class="reasonleave-truncated" data-toggle="tooltip"
                                                        title="{{ $applyleaveDatas->reasonleave }}">
                                                        {{ substr($applyleaveDatas->reasonleave, 0, 25) }}...
                                                    </span>
                                                @else
                                                    {{ $applyleaveDatas->reasonleave ?? '' }}
                                                @endif
                                            </td> --}}

                                                  <td class="textfixed">
                                                      @if (strlen($applyleaveDatas->reasonleave) > 25)
                                                          <span id="reasonleave-{{ $applyleaveDatas->id }}"
                                                              class="reasonleave-truncated">
                                                              {{ substr($applyleaveDatas->reasonleave, 0, 25) }}.....
                                                              <span style="color: #37A000; cursor: pointer;"
                                                                  data-toggle="tooltip" title="Show full text"
                                                                  onclick="showFullText('{{ $applyleaveDatas->reasonleave }}')">View
                                                                  Detail</span>
                                                          </span>
                                                      @else
                                                          {{ $applyleaveDatas->reasonleave ?? '' }}
                                                      @endif
                                                  </td>

                                                  <td class="textfixed">
                                                      {{ date('d-m-Y', strtotime($applyleaveDatas->from)) ?? '' }} -
                                                      {{ date('d-m-Y', strtotime($applyleaveDatas->to)) ?? '' }}</td>
                                                  @php
                                                      $to = Carbon\Carbon::createFromFormat(
                                                          'Y-m-d',
                                                          $applyleaveDatas->to ?? '',
                                                      );
                                                      $from = Carbon\Carbon::createFromFormat(
                                                          'Y-m-d',
                                                          $applyleaveDatas->from,
                                                      );
                                                      $diff_in_days = $to->diffInDays($from) + 1;
                                                      $holidaycount = DB::table('holidays')
                                                          ->where('startdate', '>=', $applyleaveDatas->from)
                                                          ->where('enddate', '<=', $applyleaveDatas->to)
                                                          ->count();
                                                  @endphp
                                                  <td>{{ $diff_in_days - $holidaycount ?? '' }}</td>


                                                  <td>
                                                      @if ($applyleaveDatas->status == 0)
                                                          <span class="badge badge-pill badge-warning">Created</span>
                                                      @elseif($applyleaveDatas->status == 1)
                                                          <span class="badge badge-success">Approved</span>
                                                      @elseif($applyleaveDatas->status == 2)
                                                          <span class="badge badge-danger">Rejected</span>
                                                      @endif
                                                  </td>
                                                  <td>
                                                      @if ($applyleaveDatas->leavetype == 11 && $applyleaveDatas->status == 1 && $loop->first)
                                                          <button class="btn btn-danger" data-toggle="modal"
                                                              style="height: 16px; width: auto; border-radius: 7px; display: flex; align-items: center; justify-content: center;font-size: 11px;"
                                                              data-target="#requestModal{{ $applyleaveDatas->id }}">Request</button>
                                                      @endif
                                                  </td>

                                              </tr>
                                              {{-- leaverequest form --}}
                                              @if ($applyleaveDatas->leavetype == 11)
                                                  <div class="modal fade" id="requestModal{{ $applyleaveDatas->id }}"
                                                      tabindex="-1" role="dialog" aria-labelledby="requestModalLabel"
                                                      aria-hidden="true">
                                                      <div class="modal-dialog" role="document">
                                                          <form method="post" action="{{ route('applyleaverequest') }}"
                                                              enctype="multipart/form-data">
                                                              @csrf
                                                              <div class="modal-content">
                                                                  <div class="modal-header">
                                                                      {{-- @php
                                                                dd($applyleaveDatas);
                                                            @endphp --}}
                                                                      <h5 class="modal-title" id="requestModalLabel">
                                                                          Enter
                                                                          Request Details</h5>
                                                                      <button type="button" class="close"
                                                                          data-dismiss="modal" aria-label="Close">
                                                                          <span aria-hidden="true">&times;</span>
                                                                      </button>
                                                                  </div>
                                                                  <div class="modal-body">
                                                                      @if ($errors->any())
                                                                          <div class="">
                                                                              <ul>
                                                                                  @foreach ($errors->all() as $error)
                                                                                      <li class="text-danger">
                                                                                          {{ $error }}</li>
                                                                                  @endforeach
                                                                              </ul>
                                                                          </div>
                                                                      @endif
                                                                      {{-- <form method="post"
                                                                action="{{ url('/applyleaverequest') }}"
                                                                enctype="multipart/form-data"> --}}

                                                                      <input type="hidden" name="applyleaveid"
                                                                          value="{{ $applyleaveDatas->id }}"
                                                                          class="form-control" placeholder="">
                                                                      <input type="hidden" name="createdby"
                                                                          value="{{ $applyleaveDatas->createdby }}"
                                                                          class="form-control" placeholder="">
                                                                      <input type="hidden" name="approver"
                                                                          value="{{ $applyleaveDatas->approver }}"
                                                                          class="form-control" placeholder="">
                                                                      <input type="hidden" name="status"
                                                                          value="{{ $applyleaveDatas->status }}"
                                                                          class="form-control" placeholder="">

                                                                      <!-- Input fields for request details here -->
                                                                      <label for="">Reason:*</label>

                                                                      <input type="text" name="reason"
                                                                          class="form-control" placeholder="Enter Reason"
                                                                          required>
                                                                      <label for="">Select Date:*</label>
                                                                      <input type="date" name="date"
                                                                          class="form-control yearValidate" maxlength="10"
                                                                          required>
                                                                      {{-- validation for year --}}
                                                                      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                                                                      <script>
                                                                          $(document).ready(function() {
                                                                              $('.yearValidate').on('change', function() {
                                                                                  var leaveDate = $('.yearValidate');
                                                                                  var leaveDateValue = $('.yearValidate').val();
                                                                                  console.log(leaveDateValue);
                                                                                  var leaveDateGet = new Date(leaveDateValue);
                                                                                  var leaveyear = leaveDateGet.getFullYear();
                                                                                  // console.log(startyear);
                                                                                  var leaveyearLength = leaveyear.toString().length;
                                                                                  if (leaveyearLength > 4) {
                                                                                      alert('Enter four digits for the year');
                                                                                      leaveDate.val('');
                                                                                  }
                                                                              });
                                                                          });
                                                                      </script>
                                                                  </div>
                                                                  <div class="modal-footer">
                                                                      <button type="button" class="btn btn-secondary"
                                                                          data-dismiss="modal">Close</button>
                                                                      <button type="submit"
                                                                          class="btn btn-primary">Submit</button>
                                                                  </div>
                                                              </div>
                                                          </form>
                                                      </div>
                                                  </div>
                                              @endif
                                          @endforeach
                                      </tbody>
                                  </table>

                              </div>
                          </div>
                      @endif

                      @if (isset($myapplyleaveDatas))
                          <div class="tab-pane fade" id="pills-user" role="tabpanel" aria-labelledby="pills-user-tab">
                          @else
                              <div class="tab-pane fade show active" id="pills-home" role="tabpanel"
                                  aria-labelledby="pills-home-tab">
                      @endif

                      <div class="table-responsive">
                          <table id="example1" class="table display table-bordered table-striped table-hover">
                              <thead>
                                  <tr>
                                      <th>Employee</th>
                                      <th class="textfixed">Staff Code</th>
                                      <th>Leave Type</th>
                                      <th>Approver</th>
                                      <th class="textfixed">Approver Code</th>
                                      <th class="textfixed">Reason for Leave</th>
                                      <th> Leave Period</th>
                                      <th>Days</th>
                                      <th class="textfixed">Date of Request</th>
                                      <th>Status</th>
                                      <th>Approved</th>
                                      <th>Reject</th>
                                  </tr>
                              </thead>
                              <tbody>
                                  @foreach ($teamapplyleaveDatas as $applyleaveDatas)
                                      <tr>
                                          <td class="textfixed"> <a
                                                  href="{{ route('applyleave.show', $applyleaveDatas->id) }}">
                                                  {{ $applyleaveDatas->team_member ?? '' }}</a></td>
                                          <td>{{ $applyleaveDatas->staffcode ?? '' }}</td>
                                          <td class="textfixed">

                                              {{ $applyleaveDatas->name ?? '' }}<br>
                                              @if ($applyleaveDatas->type == '0')
                                                  <b>Type :</b> <span>Birthday</span><br>
                                                  <span><b>Birthday Date :
                                                      </b>{{ date(
                                                          'd-m-Y',
                                                          strtotime(
                                                              App\Models\Teammember::select('dateofbirth')->where('id', $applyleaveDatas->createdby)->first()->dateofbirth,
                                                          ),
                                                      ) ?? '' }}</span>
                                              @elseif($applyleaveDatas->type == '1')
                                                  <span>Religious Festival</span>
                                              @endif
                                              @if ($applyleaveDatas->examtype == '0')
                                                  <b>Exam Type :</b> <span>PCC</span>
                                              @elseif($applyleaveDatas->examtype == '1')
                                                  <b>Exam Type :</b> <span>CA Final</span>
                                              @elseif($applyleaveDatas->examtype == '2')
                                                  <b>Exam Type :</b> <span>B.Com</span>
                                              @endif
                                              @if ($applyleaveDatas->examtype == '3')
                                                  <b>Other :</b> <span>{{ $applyleaveDatas->otherexam ?? '' }}</span>
                                              @endif
                                          </td>

                                          @php
                                              $approvelpartner = DB::table('teammembers')
                                                  ->leftJoin(
                                                      'teamrolehistory',
                                                      'teamrolehistory.teammember_id',
                                                      '=',
                                                      'teammembers.id',
                                                  )
                                                  ->where('teammembers.id', $applyleaveDatas->approver)
                                                  ->select(
                                                      'teammembers.team_member',
                                                      'teammembers.staffcode',
                                                      'teamrolehistory.newstaff_code',
                                                      'teamrolehistory.created_at',
                                                  )
                                                  ->first();

                                              $datadate = $applyleaveDatas->created_at
                                                  ? Carbon\Carbon::createFromFormat(
                                                      'Y-m-d H:i:s',
                                                      $applyleaveDatas->created_at,
                                                  )
                                                  : null;

                                              $permotiondate = null;
                                              if ($approvelpartner->created_at) {
                                                  $permotiondate = Carbon\Carbon::createFromFormat(
                                                      'Y-m-d H:i:s',
                                                      $approvelpartner->created_at,
                                                  );
                                              }
                                          @endphp

                                          <td class="textfixed">
                                              {{ $approvelpartner->team_member ?? '' }}

                                          </td>
                                          <td>
                                              @if ($permotiondate && $datadate && $datadate->greaterThan($permotiondate))
                                                  {{ $approvelpartner->newstaff_code }}
                                              @else
                                                  {{ $approvelpartner->staffcode }}
                                              @endif
                                          </td>

                                          <td class="textfixed">
                                              @if (strlen($applyleaveDatas->reasonleave) > 25)
                                                  <span id="reasonleave-{{ $applyleaveDatas->id }}"
                                                      class="reasonleave-truncated">
                                                      {{ substr($applyleaveDatas->reasonleave, 0, 25) }}.....
                                                      <span style="color: #37A000; cursor: pointer;" data-toggle="tooltip"
                                                          title="Show full text"
                                                          onclick="showFullText('{{ $applyleaveDatas->reasonleave }}')">View
                                                          Detail</span>
                                                  </span>
                                              @else
                                                  {{ $applyleaveDatas->reasonleave ?? '' }}
                                              @endif
                                          </td>

                                          <td class="textfixed">
                                              {{ date('d-m-Y', strtotime($applyleaveDatas->from)) ?? '' }} to
                                              {{ date('d-m-Y', strtotime($applyleaveDatas->to)) ?? '' }}
                                          </td>
                                          @php
                                              $to = Carbon\Carbon::createFromFormat(
                                                  'Y-m-d',
                                                  $applyleaveDatas->to ?? '',
                                              );
                                              $from = Carbon\Carbon::createFromFormat('Y-m-d', $applyleaveDatas->from);
                                              $diff_in_days = $to->diffInDays($from) + 1;
                                              $holidaycount = DB::table('holidays')
                                                  ->where('startdate', '>=', $applyleaveDatas->from)
                                                  ->where('enddate', '<=', $applyleaveDatas->to)
                                                  ->count();
                                          @endphp
                                          <td>{{ $diff_in_days - $holidaycount ?? '' }}</td>
                                          <td> {{ date('d-m-Y', strtotime($applyleaveDatas->created_at)) ?? '' }}</td>
                                          <td>
                                              @if ($applyleaveDatas->status == 0)
                                                  <span class="badge badge-pill badge-warning">Created</span>
                                              @elseif($applyleaveDatas->status == 1)
                                                  <span class="badge badge-success">Approved</span>
                                              @elseif($applyleaveDatas->status == 2)
                                                  <span class="badge badge-danger">Rejected</span>
                                              @endif
                                          </td>

                                          <td>
                                              @if ($applyleaveDatas->status == 0)
                                                  <form method="post"
                                                      action="{{ route('applyleave.update', $applyleaveDatas->id) }}"
                                                      enctype="multipart/form-data" style="text-align: center;">
                                                      @method('PATCH')
                                                      @csrf
                                                      <input type="text" hidden id="example-date-input" name="status"
                                                          value="1" class="form-control"
                                                          placeholder="Enter Location">
                                                      <button type="submit" class="btn btn-success"
                                                          style="border-radius: 7px; font-size: 10px; padding: 5px;"
                                                          onclick="return confirm('Are you sure you want to approve this ?');">
                                                          Approve</button>
                                                  </form>
                                              @endif
                                          </td>
                                          <td style="text-align: center;">
                                              @if ($applyleaveDatas->status == 0)
                                                  <button data-toggle="modal"
                                                      data-target="#exampleModal12{{ $loop->index }}"
                                                      class="btn btn-danger"
                                                      style="border-radius: 7px; font-size: 10px; padding: 5px; margin-bottom: 16px;">
                                                      Reject</button>
                                              @endif
                                          </td>

                                          <!-- model box / pop up box  -->
                                          @if ($applyleaveDatas->status == 0)
                                              <div class="modal fade" id="exampleModal12{{ $loop->index }}"
                                                  tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel4"
                                                  aria-hidden="true">
                                                  <div class="modal-dialog" role="document">
                                                      <div class="modal-content">
                                                          <div class="modal-header" style="background:#37A000">
                                                              <h5 style="color: white" class="modal-title font-weight-600"
                                                                  id="exampleModalLabel1">Reason For
                                                                  Rejection</h5>
                                                              <button type="button" class="close" data-dismiss="modal"
                                                                  aria-label="Close">
                                                                  <span aria-hidden="true">&times;</span>
                                                              </button>
                                                          </div>
                                                          <form method="post"
                                                              action="{{ url('applyleave/update', $applyleaveDatas->id) }}"
                                                              enctype="multipart/form-data" id="formdata">
                                                              @csrf
                                                              <div class="modal-body">
                                                                  <div class="row row-sm">
                                                                      <div class="col-12">
                                                                          <label for="">Reason : <span
                                                                                  class="text-danger">*</span> </label>
                                                                      </div>
                                                                      <div class="col-12">
                                                                          <div class="form-group">
                                                                              {{-- <textarea rows="6" name="remark" class="form-control" placeholder="" id="reasoninput"></textarea> --}}
                                                                              <textarea rows="6" name="remark" class="form-control" placeholder="" id="reasoninput-{{ $loop->index }}"></textarea>
                                                                              <input hidden type="text"
                                                                                  id="example-date-input" name="status"
                                                                                  value="2" class="form-control"
                                                                                  placeholder="Enter Reason">
                                                                          </div>
                                                                      </div>
                                                                  </div>
                                                                  <button type="button" class="btn btn-danger"
                                                                      data-dismiss="modal">Close</button>
                                                                  {{-- <button type="submit" style="float: right"
                                                                        class="btn btn-success" id="saveform">Save
                                                                    </button> --}}

                                                                  <button type="submit" style="float: right"
                                                                      class="btn btn-success saveform"
                                                                      id="saveform-{{ $loop->index }}">Save</button>
                                                              </div>
                                                          </form>
                                                      </div>
                                                  </div>
                                              </div>
                                              <script>
                                                  $(document).ready(function() {
                                                      $('#exampleModal12{{ $loop->index }}').on('hidden.bs.modal', function() {
                                                          $(this).find('form')[0].reset();
                                                      });
                                                  });
                                              </script>
                                          @endif
                                      </tr>
                                  @endforeach
                              </tbody>
                          </table>
                      </div>

                  </div>
              </div>








22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\emails\applyleaveform.blade.php

{{-- <p>
    To approve or reject the request, please click <a href="{{ url('/applyleave/' . $id) }}">here</a>.
</p> --}}
<p>
    To approve or reject the request, please click <a href="{{ url('/openleave/0?id=' . $id) }}">here</a>.
</p>







22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\ApplyleaveController.php

  public function update(Request $request, $id)
  find return redirect('applyleave')->with('success', $output);
  
  
     $output = array('msg' => 'Updated Successfully');
      // return redirect('applyleave')->with('success', $output);

      $urlheader = $request->headers->get('referer');
      $url = parse_url($urlheader);
      $path = $url['path'];
      $query = $url['query'] ?? null;

      if ($path == '/openleave/0' && $query) {
        return back()->with('success', $output);
      } else {
        return redirect('applyleave')->with('success', $output);
      }
	  
	  




22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\ApplyleaveController.php

public function open_leave($id)

      $leaveId = request()->query('id');
       if (!$leaveId) {
	
	
	
	rest of code 
	
	
	
	   
   } else {
      $teamapplyleaveDatas  = DB::table('applyleaves')
        ->leftjoin('leavetypes', 'leavetypes.id', 'applyleaves.leavetype')
        ->leftjoin('teammembers', 'teammembers.id', 'applyleaves.createdby')
        ->leftjoin('roles', 'roles.id', 'teammembers.role_id')
        ->where('applyleaves.approver', auth()->user()->teammember_id)
        // ->where('applyleaves.status', 0)
        ->where('applyleaves.id',  $leaveId)
        ->select('applyleaves.*', 'teammembers.team_member', 'teammembers.staffcode', 'roles.rolename', 'leavetypes.name')->get();

      return view('backEnd.applyleave.openindex', compact(
        'teamapplyleaveDatas'
      ));
    }
	
	





1.The client wants the URL to redirect to the open leave page when the partner clicks on the 'Here' button in the email ```end



Pop-up message when manager sends timesheet Request ```start hare
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\timesheet\index.blade.php
find Requested Done

Request Sent Successfully


Pop-up message when manager sends timesheet Request ```end hare




222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\TimesheetController.php

public function timesheet_teamlist()
if (auth()->user()->role_id == 13) {


      $get_datess = DB::table('timesheetreport')
        ->leftJoin('teammembers', 'teammembers.id', 'timesheetreport.teamid')
        ->leftJoin('teammembers as partners', 'partners.id', 'timesheetreport.partnerid')
        ->where('timesheetreport.partnerid', auth()->user()->teammember_id)
        ->whereColumn('timesheetreport.teamid', '!=', 'timesheetreport.partnerid')
        ->select('timesheetreport.*', 'teammembers.team_member', 'teammembers.staffcode', 'partners.team_member as partnername')
        ->latest()
        ->get();




2.Client wants to add multiple partner in lead partner and other partner column ```start ~!~!
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\ChecklistanswerController.php

      public function otherpatnerUpdate(Request $request)
    {
        try {
            // dd($request);
            $assignmentId = $request->assignmentgenerate_id;
            $partnerId = $request->otherpatnerid;

            // Fetch assignment mapping once
            $assignmentMapping = DB::table('assignmentmappings')
                ->where('assignmentgenerate_id', $assignmentId)
                ->first();

            $assignmentTeammapping = DB::table('assignmentteammappings')
                ->where('assignmentmapping_id', $assignmentMapping->id)
                ->where('teammember_id', $partnerId)
                ->first();

            // Check if the partner is already assigned as lead or other partner
            if ($assignmentMapping->leadpartner == $partnerId || $assignmentMapping->otherpartner == $partnerId || $assignmentTeammapping) {
                return back()->with('statuss', ['msg' => 'This partner is already assigned']);
            }

            // If `otherpartner` is null, update directly
            if (is_null($assignmentMapping->otherpartner)) {
                DB::table('assignmentmappings')
                    ->where('id', $assignmentMapping->id)
                    ->update(['otherpartner' => $partnerId]);
            } else {
                // Insert new mapping into `assignmentteammappings`
                DB::table('assignmentteammappings')->insert([
                    'assignmentmapping_id' => $assignmentMapping->id,
                    'teammember_id' => $partnerId,
                    'type' => 1,
                    'status' => 1,
                    'teamhour' => 0,
                    'created_at' => now(),
                    'updated_at' => now()
                ]);
            }

            // assignment assigned mail start from hare
            $assignmentbudgeting = DB::table('assignmentbudgetings')
                ->where('assignmentgenerate_id', $assignmentId)
                ->first();

            $clientname = DB::table('clients')
                ->where('id', $assignmentbudgeting->client_id)
                ->select('client_name', 'client_code')
                ->first();

            $assignment_name = DB::table('assignments')
                ->where('id', $assignmentbudgeting->assignment_id)->select('assignment_name')->pluck('assignment_name')->first();


            $teamemailpartner = DB::table('teammembers')
                ->where('id', $assignmentMapping->leadpartner)
                ->select('emailid', 'team_member', 'staffcode')
                ->first();


            // $teamemailotherpartner = DB::table('teammembers')
            //     ->where('id', $assignmentMapping->otherpartner)
            //     ->select('emailid', 'team_member', 'staffcode')
            //     ->first();


            $teamemailotherpartner = DB::table('teammembers')
                ->where('id', $partnerId)
                ->select('emailid', 'team_member', 'staffcode')
                ->first();

            $teamleader = DB::table('assignmentteammappings')
                ->where('assignmentmapping_id',  $assignmentMapping->id)
                ->where('type', '!=', 1)
                ->leftJoin('teammembers', 'teammembers.id', '=', 'assignmentteammappings.teammember_id')
                ->select('teammembers.team_member', 'teammembers.staffcode')
                ->get();

            // Mail for otherpartner
            // if (!empty($assignmentMapping->otherpartner)) {
            // dd($assignmentMapping->otherpartner);
            $data = [
                'assignmentid'      => $assignmentId,
                'clientname'        => $clientname->client_name,
                'clientcode'        => $clientname->client_code,
                'assignmentname'    => $request->assignmentname,
                'assignment_name'   => $assignment_name,
                'emailid'           => $teamemailotherpartner->emailid,
                'otherpatner'       => $teamemailotherpartner,
                'assignmentpartner' => $teamemailpartner,
                'teamleader'        => $teamleader,
                'periodend' => $assignmentMapping->periodend,
                'assignmentgenerate' => $assignmentId,
            ];

            $this->sendAssignmentEmail($data);
            // }
            // assignment assigned mail end hare
            $output = array('msg' => 'This partner has been added successfully.');
            return back()->with('success', $output);
        } catch (Exception $e) {
            DB::rollBack();
            Log::emergency("File:" . $e->getFile() . "Line:" . $e->getLine() . "Message:" . $e->getMessage());
            report($e);
            $output = array('msg' => $e->getMessage());
            return back()->withErrors($output)->withInput();
        }
    }











after above function add it 

    function sendAssignmentEmail($data)
    {
        Mail::send('emails.assignmentassign', $data, function ($msg) use ($data) {
            $msg->to($data['emailid']);
            $msg->subject('VSA || New Assignment Allocation || ' . $data['assignmentname'] . ' / ' . $data['assignmentid'] . ' || Independence Confirmation ');
        });
    }










22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\TimesheetController.php

find   public function create(Request $request)
find } elseif (auth()->user()->role_id == 13) {

  $clientss = DB::table('clients')
        ->leftJoin('assignmentbudgetings', 'assignmentbudgetings.client_id', '=', 'clients.id')
        ->leftJoin('assignmentmappings', 'assignmentmappings.assignmentgenerate_id', '=', 'assignmentbudgetings.assignmentgenerate_id')
        ->leftJoin('assignmentteammappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
        ->where('assignmentbudgetings.status', 1)
        ->where(function ($query) {
          $query->where('assignmentmappings.leadpartner', auth()->user()->teammember_id)
            ->orWhere('assignmentmappings.otherpartner', auth()->user()->teammember_id)
            ->orWhere('assignmentteammappings.teammember_id', auth()->user()->teammember_id);
        })
        ->select('clients.client_name', 'clients.id', 'clients.client_code')
        ->distinct()
        ->orderBy('clients.client_name', 'ASC')
        ->get();
















22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\TimesheetController.php

find  public function create(Request $request)
find  if ($request->ajax()) {
find  if (isset($request->cid)) 
find  elseif (auth()->user()->role_id == 13) {{



            foreach (
              DB::table('assignmentbudgetings')
                ->select(
                  'assignmentbudgetings.assignmentgenerate_id',
                  'assignments.assignment_name',
                  'assignmentbudgetings.assignmentname'
                )
                ->where('assignmentbudgetings.client_id', $request->cid)
                ->leftJoin('assignments', 'assignments.id', 'assignmentbudgetings.assignment_id')
                ->leftJoin('assignmentmappings', 'assignmentmappings.assignmentgenerate_id', 'assignmentbudgetings.assignmentgenerate_id')
                ->leftJoin('assignmentteammappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
                ->where(function ($query) {
                  $query->where('assignmentmappings.leadpartner', auth()->user()->teammember_id)
                    ->orWhere('assignmentmappings.otherpartner', auth()->user()->teammember_id)
                    ->orWhere('assignmentteammappings.teammember_id', auth()->user()->teammember_id);
                })
                ->where(function ($query) use ($selectedDate) {
                  $query->whereNull('otpverifydate')
                    ->orWhere('otpverifydate', '>=', $selectedDate->modify('-1 day'));
                })
                ->orderBy('assignment_name')
                ->distinct() // Ensure unique rows
                ->get() as $sub
            )











22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\TimesheetController.php

find  public function create(Request $request)
find  if ($request->ajax()) {
find  if (isset($request->timesheetdate)) {
find  } elseif (auth()->user()->role_id == 13) {



          $clientss = DB::table('assignmentmappings')
            ->leftjoin('assignmentbudgetings', 'assignmentbudgetings.assignmentgenerate_id', 'assignmentmappings.assignmentgenerate_id')
            ->leftJoin('assignmentteammappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
            ->leftjoin('clients', 'clients.id', 'assignmentbudgetings.client_id')
            ->where(function ($query) {
              $query->where('assignmentmappings.leadpartner', auth()->user()->teammember_id)
                ->orWhere('assignmentmappings.otherpartner', auth()->user()->teammember_id)
                ->orWhere('assignmentteammappings.teammember_id', auth()->user()->teammember_id);
            })
            ->where(function ($query) use ($selectedDate) {
              $query->whereNull('otpverifydate')
                ->orWhere('otpverifydate', '>=', $selectedDate->modify('-1 day'));
            })
            // ->whereNotNull('clients.client_name')
            ->select('clients.client_name', 'clients.id', 'clients.client_code')
            ->orderBy('client_name', 'ASC')
            ->distinct()->get();












22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\TimesheetController.php
public function store(Request $request)
   if ($assignmentdata->otherpartner == auth()->user()->teammember_id) { after this 



            if ($assignmentdata->otherpartner != auth()->user()->teammember_id && $assignmentdata->leadpartner != auth()->user()->teammember_id) {
              $getTotalTeamHour = DB::table('assignmentteammappings')
                ->join('assignmentmappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
                ->where('assignmentmappings.assignmentgenerate_id', $request->assignment_id[$i])
                ->where('assignmentteammappings.teammember_id', auth()->user()->teammember_id)
                ->value('teamhour') ?? 0;

              $finalResult = $getTotalTeamHour + $request->hour[$i];

              DB::table('assignmentteammappings')
                ->join('assignmentmappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
                ->where('assignmentmappings.assignmentgenerate_id', $request->assignment_id[$i])
                ->where('assignmentteammappings.teammember_id', auth()->user()->teammember_id)
                ->update(['teamhour' => $finalResult]);
            }










total hour for
public function store(Request $request)
if (auth()->user()->role_id == 14 || auth()->user()->role_id == 15) {
		  
		  
		  

          if (auth()->user()->role_id == 14 || auth()->user()->role_id == 15) {
            // dd($request);
            $getTotalTeamHour = DB::table('assignmentteammappings')
              ->join('assignmentmappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
              ->where('assignmentmappings.assignmentgenerate_id', $request->assignment_id[$i])
              ->where('assignmentteammappings.teammember_id', auth()->user()->teammember_id)
              ->value('teamhour') ?? 0;

            $finalResult = $getTotalTeamHour + $request->hour[$i];

            DB::table('assignmentteammappings')
              ->join('assignmentmappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
              ->where('assignmentmappings.assignmentgenerate_id', $request->assignment_id[$i])
              ->where('assignmentteammappings.teammember_id', auth()->user()->teammember_id)
              ->update(['teamhour' => $finalResult]);
          }








22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\TimesheetController.php

  public function destroy(Request $request, $id)
   if (auth()->user()->role_id == 14 || auth()->user()->role_id == 15) {


      if (auth()->user()->role_id == 14 || auth()->user()->role_id == 15) {
        $getTotalTeamHour = DB::table('assignmentteammappings')
          ->join('assignmentmappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
          ->where('assignmentmappings.assignmentgenerate_id', $timesheetdelete->assignmentgenerate_id)
          ->where('assignmentteammappings.teammember_id', auth()->user()->teammember_id)
          ->value('teamhour') ?? 0;

        $finalResult = $getTotalTeamHour - $timesheetdelete->hour;

        if ($finalResult >= 0) {
          DB::table('assignmentteammappings')
            ->join('assignmentmappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
            ->where('assignmentmappings.assignmentgenerate_id', $timesheetdelete->assignmentgenerate_id)
            ->where('assignmentteammappings.teammember_id', auth()->user()->teammember_id)
            ->update(['teamhour' => $finalResult]);
        }
      }











app\Http\Controllers\TimesheetController.php

public function destroy(Request $request, $id)
  if (auth()->user()->role_id == 13) {
   if ($assignmentdata->otherpartner == auth()->user()->teammember_id) {  after this body add this below code 

        if ($assignmentdata->otherpartner != auth()->user()->teammember_id && $assignmentdata->leadpartner != auth()->user()->teammember_id) {
          $getTotalTeamHour = DB::table('assignmentteammappings')
            ->join('assignmentmappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
            ->where('assignmentmappings.assignmentgenerate_id', $timesheetdelete->assignmentgenerate_id)
            ->where('assignmentteammappings.teammember_id', auth()->user()->teammember_id)
            ->value('teamhour') ?? 0;

          $finalResult = $getTotalTeamHour - $timesheetdelete->hour;

          if ($finalResult >= 0) {
            DB::table('assignmentteammappings')
              ->join('assignmentmappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
              ->where('assignmentmappings.assignmentgenerate_id', $timesheetdelete->assignmentgenerate_id)
              ->where('assignmentteammappings.teammember_id', auth()->user()->teammember_id)
              ->update(['teamhour' => $finalResult]);
          }
        }












22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\TimesheetController.php

 public function savedtimesheetEdit(Request $request, $id)
 } elseif (auth()->user()->role_id == 13) {






       $clientss = DB::table('assignmentmappings')
        ->leftjoin('assignmentbudgetings', 'assignmentbudgetings.assignmentgenerate_id', 'assignmentmappings.assignmentgenerate_id')
        ->leftJoin('assignmentteammappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
        ->leftjoin('clients', 'clients.id', 'assignmentbudgetings.client_id')
        ->where(function ($query) {
          $query->where('assignmentmappings.leadpartner', auth()->user()->teammember_id)
            ->orWhere('assignmentmappings.otherpartner', auth()->user()->teammember_id)
            ->orWhere('assignmentteammappings.teammember_id', auth()->user()->teammember_id);
        })
        ->where(function ($query) use ($selectedDate) {
          $query->whereNull('otpverifydate')
            ->orWhere('otpverifydate', '>=', $selectedDate->modify('-1 day'));
        })
        // ->whereNotNull('clients.client_name')
        ->select('clients.client_name', 'clients.id', 'clients.client_code')
        ->orderBy('client_name', 'ASC')
        ->distinct()->get();









22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\TimesheetController.php
  public function timesheeteditonchange(Request $request)
        if (isset($request->cid)) {
if (auth()->user()->role_id == 13) {


            foreach (
              DB::table('assignmentbudgetings')
                ->select('assignmentbudgetings.assignmentgenerate_id', 'assignments.assignment_name', 'assignmentbudgetings.assignmentname')
                ->where('assignmentbudgetings.client_id', $request->cid)
                ->leftJoin('assignments', 'assignments.id', 'assignmentbudgetings.assignment_id')
                ->leftJoin('assignmentmappings', 'assignmentmappings.assignmentgenerate_id', 'assignmentbudgetings.assignmentgenerate_id')
                ->leftJoin('assignmentteammappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
                ->where(function ($query) {
                  $query->where('assignmentmappings.leadpartner', auth()->user()->teammember_id)
                    ->orWhere('assignmentmappings.otherpartner', auth()->user()->teammember_id)
                    ->orWhere('assignmentteammappings.teammember_id', auth()->user()->teammember_id);
                })
                ->where(function ($query) use ($selectedDate) {
                  $query->whereNull('otpverifydate')
                    ->orWhere('otpverifydate', '>=', $selectedDate->modify('-1 day'));
                })
                ->orderBy('assignment_name')
                ->distinct()
                ->get() as $sub
            )










22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\TimesheetController.php

function create(Request $request)
 if ($request->ajax()) {
 if (isset($request->cid)) {
 elseif (auth()->user()->role_id == 13) {
 

            foreach (
              DB::table('assignmentbudgetings')
                ->select(
                  'assignmentbudgetings.assignmentgenerate_id',
                  'assignments.assignment_name',
                  'assignmentbudgetings.assignmentname'
                )
                ->where('assignmentbudgetings.client_id', $request->cid)
                ->leftJoin('assignments', 'assignments.id', 'assignmentbudgetings.assignment_id')
                ->leftJoin('assignmentmappings', 'assignmentmappings.assignmentgenerate_id', 'assignmentbudgetings.assignmentgenerate_id')
                ->leftJoin('assignmentteammappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
                ->where(function ($query) {
                  $query->where('assignmentmappings.leadpartner', auth()->user()->teammember_id)
                    ->orWhere('assignmentmappings.otherpartner', auth()->user()->teammember_id)
                    ->orWhere('assignmentteammappings.teammember_id', auth()->user()->teammember_id);
                })
                ->where(function ($query) use ($selectedDate) {
                  $query->whereNull('otpverifydate')
                    ->orWhere('otpverifydate', '>=', $selectedDate->modify('-1 day'));
                })
                ->orderBy('assignment_name')
                ->distinct() // Ensure unique rows
                ->get() as $sub
            )












22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\TimesheetController.php
public function savedtimesheeteditstore(Request $request)  

if (!is_numeric($request->assignment_id)) {
  if (auth()->user()->role_id == 14 || auth()->user()->role_id == 15) {


      if (auth()->user()->role_id == 14 || auth()->user()->role_id == 15) {
        $gettotalteamhour = DB::table('assignmentteammappings')
          ->join('assignmentmappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
          ->where('assignmentmappings.assignmentgenerate_id', $oldtimesheetdata->assignmentgenerate_id)
          ->where('assignmentteammappings.teammember_id', auth()->user()->teammember_id)
          ->value('teamhour') ?? 0;


        $finalresult =  $gettotalteamhour - $oldtimesheetdata->hour;
        if ($finalresult >= 0) {
          DB::table('assignmentteammappings')
            ->join('assignmentmappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
            ->where('assignmentmappings.assignmentgenerate_id', $oldtimesheetdata->assignmentgenerate_id)
            ->where('assignmentteammappings.teammember_id', auth()->user()->teammember_id)
            ->update(['teamhour' => $finalresult]);
        }

        $gettotalteamhournew = DB::table('assignmentteammappings')
          ->join('assignmentmappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
          ->where('assignmentmappings.assignmentgenerate_id', $request->assignment_id)
          ->where('assignmentteammappings.teammember_id', auth()->user()->teammember_id)
          ->value('teamhour') ?? 0;

        $finalresult =   $gettotalteamhournew + $request->hour;

        if ($finalresult >= 0) {
          DB::table('assignmentteammappings')
            ->join('assignmentmappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
            ->where('assignmentmappings.assignmentgenerate_id', $request->assignment_id)
            ->where('assignmentteammappings.teammember_id', auth()->user()->teammember_id)
            ->update(['teamhour' => $finalresult]);
        }
      }

















find 
if (!is_numeric($request->assignment_id)) {
  if (auth()->user()->role_id == 13) {
->update(['otherpartnerhour' => $finalresultotherpatner]); 
 after this block add below code 
 
 
 
 
 
 
        // if ($assignmentdata->otherpartner != auth()->user()->teammember_id && $assignmentdata->leadpartner != auth()->user()->teammember_id) {
        $gettotalteamhour = DB::table('assignmentteammappings')
          ->join('assignmentmappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
          ->where('assignmentmappings.assignmentgenerate_id', $oldtimesheetdata->assignmentgenerate_id)
          ->where('assignmentteammappings.teammember_id', auth()->user()->teammember_id)
          ->value('teamhour') ?? 0;


        $finalresult =  $gettotalteamhour - $oldtimesheetdata->hour;
        if ($finalresult >= 0) {
          DB::table('assignmentteammappings')
            ->join('assignmentmappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
            ->where('assignmentmappings.assignmentgenerate_id', $oldtimesheetdata->assignmentgenerate_id)
            ->where('assignmentteammappings.teammember_id', auth()->user()->teammember_id)
            ->update(['teamhour' => $finalresult]);
        }

        $gettotalteamhournew = DB::table('assignmentteammappings')
          ->join('assignmentmappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
          ->where('assignmentmappings.assignmentgenerate_id', $request->assignment_id)
          ->where('assignmentteammappings.teammember_id', auth()->user()->teammember_id)
          ->value('teamhour') ?? 0;

        $finalresult =   $gettotalteamhournew + $request->hour;

        if ($finalresult >= 0) {
          DB::table('assignmentteammappings')
            ->join('assignmentmappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
            ->where('assignmentmappings.assignmentgenerate_id', $request->assignment_id)
            ->where('assignmentteammappings.teammember_id', auth()->user()->teammember_id)
            ->update(['teamhour' => $finalresult]);
        }
        // }
		
		





22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\TimesheetController.php
public function savedtimesheeteditstore(Request $request)
 if (is_numeric($request->assignment_id)) {
    find   if (auth()->user()->role_id == 14 || auth()->user()->role_id == 15) {


        if (auth()->user()->role_id == 14 || auth()->user()->role_id == 15) {
          $gettotalteamhour = DB::table('assignmentteammappings')
            ->join('assignmentmappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
            ->where('assignmentmappings.assignmentgenerate_id', $oldtimesheetdata->assignmentgenerate_id)
            ->where('assignmentteammappings.teammember_id', auth()->user()->teammember_id)
            ->value('teamhour') ?? 0;

          $subtractoldhour =  $gettotalteamhour - $oldtimesheetdata->hour;
          $finalresult =  $subtractoldhour + $request->hour;

          if ($finalresult >= 0) {
            DB::table('assignmentteammappings')
              ->join('assignmentmappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
              ->where('assignmentmappings.assignmentgenerate_id', $oldtimesheetdata->assignmentgenerate_id)
              ->where('assignmentteammappings.teammember_id', auth()->user()->teammember_id)
              ->update(['teamhour' => $finalresult]);
          }
        }











public function savedtimesheeteditstore(Request $request)
 if (is_numeric($request->assignment_id)) {
 ->update(['otherpartnerhour' => $finalresultotherpatner]);
 after this if block add 
 
 
          if ($assignmentdata->otherpartner != auth()->user()->teammember_id && $assignmentdata->leadpartner != auth()->user()->teammember_id) {
            $gettotalteamhour = DB::table('assignmentteammappings')
              ->join('assignmentmappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
              ->where('assignmentmappings.assignmentgenerate_id', $oldtimesheetdata->assignmentgenerate_id)
              ->where('assignmentteammappings.teammember_id', auth()->user()->teammember_id)
              ->value('teamhour') ?? 0;

            $subtractoldhour =  $gettotalteamhour - $oldtimesheetdata->hour;
            $finalresult =  $subtractoldhour + $request->hour;

            if ($finalresult >= 0) {
              DB::table('assignmentteammappings')
                ->join('assignmentmappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
                ->where('assignmentmappings.assignmentgenerate_id', $oldtimesheetdata->assignmentgenerate_id)
                ->where('assignmentteammappings.teammember_id', auth()->user()->teammember_id)
                ->update(['teamhour' => $finalresult]);
            }
          }








22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\StepController.php

$teammemberDatas = DB::table('assignmentmappings')



 $teammemberDatas = DB::table('assignmentteammappings')
            ->join('assignmentmappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
            ->join('teammembers', 'teammembers.id', '=', 'assignmentteammappings.teammember_id')
            ->leftJoin('teamrolehistory as teamrolehistoryteam', function ($join) {
                $join->on('teamrolehistoryteam.teammember_id', '=', 'assignmentteammappings.teammember_id')
                    ->whereRaw('teamrolehistoryteam.created_at < assignmentmappings.created_at');
            })
            ->leftJoin('titles', 'titles.id', '=', 'teammembers.title_id')
            ->leftJoin('roles', 'roles.id', '=', 'teammembers.role_id')
            ->where('assignmentmappings.assignmentgenerate_id', $id)
            ->whereNotNull('assignmentteammappings.id')
            ->where('assignmentteammappings.type', '!=', 1)
            ->select([
                'teammembers.*',
                'roles.rolename',
                'titles.title',
                'assignmentteammappings.id AS assignmentteammappingsId',
                'assignmentteammappings.status AS assignmentteammappingsStatus',
                'assignmentteammappings.type',
                'assignmentteammappings.teamhour',
                'assignmentteammappings.viewerteam',
                'assignmentmappings.assignmentgenerate_id AS assignmentgenerateid',
                'assignmentmappings.leadpartner',
                'teamrolehistoryteam.newstaff_code'
            ])
            ->orderByDesc('assignmentteammappings.id')
            ->get();

        // dd($teammemberDatas);












find 
  $leadpartner = DB::table('assignmentmappings')
  after that replace all code 




        $leadpartner = DB::table('assignmentmappings')
            ->join('teammembers as team', 'team.id', 'assignmentmappings.leadpartner')
            ->leftJoin('titles', 'titles.id', '=', 'team.title_id')
            ->where('assignmentmappings.assignmentgenerate_id', $id)
            ->select('team.id', 'team.team_member', 'team.staffcode',  'team.mobile_no', 'team.role_id', 'assignmentmappings.leadpartnerhour as assignmenthour', 'titles.title', 'assignmentmappings.created_at as createdat')
            ->get();


        $otherpartner = DB::table('assignmentmappings')
            ->join('teammembers as team', 'team.id', 'assignmentmappings.otherpartner')
            ->leftJoin('titles', 'titles.id', '=', 'team.title_id')
            ->where('assignmentmappings.assignmentgenerate_id', $id)
            ->select('team.id', 'team.team_member', 'team.staffcode', 'team.mobile_no', 'team.role_id', 'assignmentmappings.otherpartnerhour as assignmenthour', 'titles.title', 'assignmentmappings.created_at as createdat')
            ->get();

        $teammpartner = DB::table('assignmentteammappings')
            ->join('assignmentmappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
            ->join('teammembers', 'teammembers.id', '=', 'assignmentteammappings.teammember_id')
            ->leftJoin('titles', 'titles.id', '=', 'teammembers.title_id')
            ->leftJoin('roles', 'roles.id', '=', 'teammembers.role_id')
            ->where('assignmentmappings.assignmentgenerate_id', $id)
            ->whereNotNull('assignmentteammappings.id')
            ->where('assignmentteammappings.type', '=', 1)
            ->select([
                'teammembers.id',
                'teammembers.team_member',
                'teammembers.staffcode',
                'teammembers.mobile_no',
                'teammembers.role_id',
                'assignmentteammappings.teamhour as assignmenthour',
                'assignmentteammappings.created_at as createdat',
                'titles.title',
            ])
            ->orderByDesc('assignmentteammappings.id')
            ->get();

        // $partner = $leadpartner->merge($otherpartner)->merge($teammpartner);
        $partner = $leadpartner->merge($otherpartner)->merge($teammpartner)
            ->sortByDesc('createdat')
            // ->sortBy('createdat')
            ->values();

        // dd($partner);










22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\viewassignment.blade.php

find and replace 
{{ $partnerData->leadpartnerhour ?? ($partnerData->otherpartnerhour ?? 0) }}

                   <td>{{ $partnerData->assignmenthour ?? 0 }}</td>






22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\StepController.php
 find $leadpartner = DB::table('assignmentmappings')



        $leadpartner = DB::table('assignmentmappings')
            ->join('teammembers as team', 'team.id', 'assignmentmappings.leadpartner')
            ->leftJoin('titles', 'titles.id', '=', 'team.title_id')
            ->where('assignmentmappings.assignmentgenerate_id', $id)
            ->select('team.id', 'team.team_member', 'team.staffcode',  'team.mobile_no', 'team.role_id', 'assignmentmappings.leadpartnerhour as assignmenthour', 'titles.title', 'assignmentmappings.created_at as createdat')
            ->get();


        $otherpartner = DB::table('assignmentmappings')
            ->join('teammembers as team', 'team.id', 'assignmentmappings.otherpartner')
            ->leftJoin('titles', 'titles.id', '=', 'team.title_id')
            ->where('assignmentmappings.assignmentgenerate_id', $id)
            ->select('team.id', 'team.team_member', 'team.staffcode', 'team.mobile_no', 'team.role_id', 'assignmentmappings.otherpartnerhour as assignmenthour', 'titles.title', 'assignmentmappings.created_at as createdat')
            ->get();

        $teammpartner = DB::table('assignmentteammappings')
            ->join('assignmentmappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
            ->join('teammembers', 'teammembers.id', '=', 'assignmentteammappings.teammember_id')
            ->leftJoin('titles', 'titles.id', '=', 'teammembers.title_id')
            ->leftJoin('roles', 'roles.id', '=', 'teammembers.role_id')
            ->where('assignmentmappings.assignmentgenerate_id', $id)
            ->whereNotNull('assignmentteammappings.id')
            ->where('assignmentteammappings.type', '=', 1)
            ->select([
                'teammembers.id',
                'teammembers.team_member',
                'teammembers.staffcode',
                'teammembers.mobile_no',
                'teammembers.role_id',
                'assignmentteammappings.teamhour as assignmenthour',
                'assignmentteammappings.created_at as createdat',
                'titles.title',
            ])
            ->orderByDesc('assignmentteammappings.id')
            ->get();

        // $partner = $leadpartner->merge($otherpartner)->merge($teammpartner);
        $partner = $leadpartner->merge($otherpartner)->merge($teammpartner)
            ->sortByDesc('createdat')
            // ->sortBy('createdat')
            ->values();

        // dd($partner);

        $addonpartner = Teammember::where('role_id', '=', 13)
            ->where('status', '=', 1)
            ->leftJoin('teamrolehistory', 'teamrolehistory.teammember_id', '=', 'teammembers.id')
            ->with('title')
            ->orderBy('team_member', 'asc')
            ->select('teammembers.*', 'teamrolehistory.newstaff_code')
            ->get();
        // dd($partner);
		
	
	
	

	
		
pass this addonpartner in view







22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\viewassignment.blade.php

 $('#exampleModal12').on('hidden.bs.modal', function() {
replace it 

<script>
    $(document).ready(function() {
        $('#exampleModal12').on('hidden.bs.modal', function() {
            $('#detailsFormudin')[0].reset();
        });
        $('#exampleModal120').on('hidden.bs.modal', function() {
            var formElement = $(this).find('form')[0];
            if (formElement) {
                formElement.reset();
            }
            // Reset Select2 dropdowns
            $(this).find('select').val(null).trigger('change');
            $(this).find('input[type="hidden"]').val('');
            console.log('Form Reset Done');
        });

    });
</script>








22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\viewassignment.blade.php



                                     <div class="card-head">
                                        <b>Partner List:</b>

                                        {{-- <b>
                                                <a data-toggle="modal" data-target="#exampleModal14"
                                                    class="btn btn-info-soft btn-sm">
                                                    <i class="fa fa-plus"></i>
                                                </a>
                                            </b> --}}
                                        <b>
                                            <a data-toggle="modal" data-target="#exampleModal120"
                                                class="btn btn-info-soft btn-sm ml-1"><i class="fa fa-plus"></i></a>
                                        </b>
                                    </div>
				


				
									




find text after this div add 
   <div class="modal fade" id="exampleModal14" tabindex="-1" role="dialog"



                                @if (auth()->user()->role_id == 11 || auth()->user()->role_id == 13)
                                    <div class="modal fade" id="exampleModal120" tabindex="-1" role="dialog"
                                        aria-labelledby="exampleModalLabel4" aria-hidden="true">
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header" style="background:#37A000;color:white;">
                                                    <h5 class="modal-title font-weight-600" id="exampleModalLabel4">Add
                                                        Partner</h5>
                                                    <div>
                                                        <ul>
                                                            @foreach ($errors->all() as $e)
                                                                <li style="color:red;">{{ $e }}</li>
                                                            @endforeach
                                                        </ul>
                                                    </div>
                                                    <button style="color: white" type="button" class="close"
                                                        data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                </div>
                                                <form id="exampleModal120111" method="post"
                                                    action="{{ url('otherpatner/update') }}"
                                                    enctype="multipart/form-data">
                                                    @csrf
                                                    <div class="modal-body">
                                                        <div class="details-form-field form-group row">
                                                            <div class="col-12">
                                                                <div class="form-group">
                                                                    <label class="font-weight-600">Partner Name : *</label>
                                                                    <select required class="language form-control"
                                                                        id="exampleFormControlSelect1"
                                                                        name="otherpatnerid">
                                                                        <option value="">Please Select One</option>
                                                                        @foreach ($addonpartner as $teammemberData)
                                                                            <option value="{{ $teammemberData->id }}">
                                                                                {{ $teammemberData->team_member }} (
                                                                                {{ $teammemberData->newstaff_code ?? ($teammemberData->staffcode ?? '') }})
                                                                            </option>
                                                                        @endforeach
                                                                    </select>
                                                                    <input type="hidden" name="assignmentgenerate_id"
                                                                        value="{{ $assignmentbudgetingDatas->assignmentgenerate_id }}"
                                                                        class=" form-control">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        {{-- <button type="button" class="btn btn-danger"
                                                            data-dismiss="modal">Close</button> --}}
                                                        <button type="submit" class="btn btn-success">Submit</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                @endif














22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\assignmentmapping\yearwise.blade.php
   @if ($otherPartner && $otherPartner->team_member != null)

                                    <td class="textfixed">
                                        @if ($otherPartner && $otherPartner->team_member != null)
                                            {{ $otherPartner->team_member ?? '' }}
                                            {{-- @else
                                            @if (auth()->user()->role_id == 11)
                                                <div class="card-head">
                                                    <a data-toggle="modal" data-target="#exampleModal1{{ $loop->index }}"
                                                        class="btn btn-info-soft btn-sm"><i class="fa fa-plus"></i></a>
                                                </div>
                                            @endif --}}
                                        @endif
                                    </td>
			

			
	

	

22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\BackEndController.php
 public function index()
    } elseif (auth()->user()->role_id == 13) {
 $assignmentcount =



      $assignmentcountall = DB::table('assignmentmappings')
        ->leftJoin('assignmentbudgetings', 'assignmentbudgetings.assignmentgenerate_id', '=', 'assignmentmappings.assignmentgenerate_id')
        ->leftJoin('assignmentteammappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
        ->leftJoin('assignments', 'assignments.id', '=', 'assignmentbudgetings.assignment_id')
        ->leftJoin('clients', 'clients.id', '=', 'assignmentbudgetings.client_id')
        ->where(function ($query) {
          $userId = auth()->user()->teammember_id;
          $query->where('assignmentmappings.leadpartner', $userId)
            ->orWhere('assignmentmappings.otherpartner', $userId)
            ->orWhere('assignmentteammappings.teammember_id', $userId);
        })
        ->where('assignmentbudgetings.status', 1)
        ->select([
          'assignmentmappings.id',
          'clients.client_name',
          'assignmentbudgetings.assignmentname',
          'assignments.assignment_name',
          'assignmentbudgetings.assignmentgenerate_id'
        ])
        ->distinct()
        ->get();

      $assignmentcount = $assignmentcountall->count();












22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\ReportController.php


$assignmentmappingData = $assignmentmappingOpenotherpartner->merge($assignmentmappingOpenleadpartner);
replace  assignmentmappingData,assignmentmappingOpenotherpartner and assignmentmappingOpenleadpartner varable 


      $assignmentmappingData = DB::table('assignmentmappings')
        ->leftJoin('assignmentbudgetings', 'assignmentbudgetings.assignmentgenerate_id', '=', 'assignmentmappings.assignmentgenerate_id')
        ->leftJoin('assignmentteammappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
        ->leftJoin('clients', 'clients.id', '=', 'assignmentbudgetings.client_id')
        ->leftJoin('assignments', 'assignments.id', '=', 'assignmentmappings.assignment_id')
        ->where('assignmentbudgetings.status', '1')
        ->whereNotIn('assignmentbudgetings.assignmentname', ['Unallocated', 'Official Travel', 'Off/Holiday', 'Seminar/Conference/Post Qualification Course'])
        ->where(function ($query) {
          $userId = auth()->user()->teammember_id;
          $query->where('assignmentmappings.leadpartner', $userId)
            ->orWhere('assignmentmappings.otherpartner', $userId)
            ->orWhere('assignmentteammappings.teammember_id', $userId);
        })
        ->select(
          'assignmentmappings.*',
          'assignmentbudgetings.duedate',
          'assignmentbudgetings.assignmentname',
          'assignmentbudgetings.status',
          'assignments.assignment_name',
          'clients.client_name',
          'clients.client_code',
          'assignmentmappings.leadpartner',
          'assignmentmappings.otherpartner'
        )
        ->distinct()
        ->get();

      // dd($assignmentmappingData);
	  
	  


2.Client wants to add multiple partner in lead partner and other partner column ```end  ~!~!



I am working on profile validation ``` start
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\teammember\edit.blade.php


                                @if ($reset != null)
                                    <a style="float: right;color:white;"
                                        href="{{ url('/resetpassword/' . $teammember->id) }}"
                                        class="btn btn-info-soft btn-sm">Reset Password :<i
                                            class="fas fa-unlock-alt"></i></a>
                                @endif






22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\teammember\form.blade.php
replace all code 






22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\teammember\edit.blade.php
replace all code 


@extends('backEnd.layouts.layout') @section('backEnd_content')
    <!--Content Header (Page header)-->
    <div class="content-header row align-items-center m-0">

    </div>
    <!--/.Content Header (Page header)-->
    <div class="body-content">
        <div class="row">
            <div class="col-md-12 col-lg-12">
                <div class="card mb-4">
                    <div class="card-header" style="background: #37A000">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="col-md-6">
                                <h6 style="color:white;" class="fs-17 font-weight-600 mb-0">Edit Team Member</h6>
                            </div>
                            <div class="col-md-6">
                                @php
                                    $reset = DB::table('users')->where('teammember_id', $teammember->id)->first();
                                @endphp
                                @if ($reset != null)
                                    <a style="float: right;color:white;"
                                        href="{{ url('/resetpassword/' . $teammember->id) }}"
                                        class="btn btn-info-soft btn-sm">Reset Password :<i
                                            class="fas fa-unlock-alt"></i></a>
                                @endif
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <form method="post" action="{{ route('teammember.update', $teammember->id) }}"
                            enctype="multipart/form-data">
                            @method('PATCH')
                            @csrf
                            @component('backEnd.components.alert')
                            @endcomponent
                            @include('backEnd.teammember.form')
                        </form>
                        <hr class="my-4">

                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--/.body content-->
@endsection

<!--Page Active Scripts(used by this page)-->
<script src="{{ url('backEnd/dist/js/pages/forms-basic.active.js') }}"></script>
<!--Page Scripts(used by all page)-->
<script src="{{ url('backEnd/dist/js/sidebar.js') }}"></script>








22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\layouts\includes\js.blade.php


 <script>
     $(document).ready(function() {
         $('.datevalidation').on('change', function() {
             var leaveDateValue = $(this).val();
             var leaveDateGet = new Date(leaveDateValue);
             var leaveyear = leaveDateGet.getFullYear();
             var leaveyearLength = leaveyear.toString().length;

             if (leaveyearLength > 4) { // Ensure exactly 4 digits
                 alert('Enter a valid four-digit year');
                 $(this).val(''); // Clear only the incorrect field
             }
         });
     });
 </script>
 
 

 @if (Request::is('teammember/*/edit') || Request::is('teammember/create'))
     <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
     <script>
         $(document).ready(function() {
             $('form').submit(function(event) {

                 let profilepic = $("[name='profilepic']").val().trim();
                 let allowedExtensions = /(\.jpg|\.jpeg|\.png)$/i;
                 if (profilepic && !allowedExtensions.test(profilepic)) {
                     alert("Profile picture must be in JPG, JPEG, or PNG format");
                     $("[name='profilepic']").val('').focus();
                     event.preventDefault();
                     return false;
                 }

                 let personalemail = $("[name='personalemail']").val().trim();
                 let emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
                 if (!emailPattern.test(personalemail)) {
                     alert("Enter a valid email address");
                     $("[name='personalemail']").focus();
                     event.preventDefault();
                     return false;
                 }

                 let fields = {
                     mobile_no: "Mobile Number",
                     emergencycontactnumber: "Emergency Contact Number",
                     mothernumber: "Mother's Mobile Number",
                     fathernumber: "Father's Mobile Number",
                     bankaccountnumber: "Bank Account Number",
                     adharcardnumber: "Aadhar Number",
                 };

                 for (let field in fields) {
                     let value = $("[name='" + field + "']").val();
                     if (value && !/^\d+$/.test(value)) {
                         alert(`Enter ${fields[field]} using only digits`);
                         $("[name='" + field + "']").focus();
                         event.preventDefault();
                         return false;
                     }
                 }

                 let pancardno = $("[name='pancardno']").val().trim();
                 let panPattern = /^[A-Z]{5}[0-9]{4}[A-Z]{1}$/;
                 if (!panPattern.test(pancardno)) {
                     alert("Enter a valid PAN Card number like AAAAA9999A");
                     $("[name='pancardno']").focus();
                     event.preventDefault();
                     return false;
                 }

                 let today = new Date();
                 today.setHours(0, 0, 0, 0);

                 let dates = {
                     dateofbirth: "Date of Birth",
                     joining_date: "Date of Joining",
                     leavingdate: "Date of Leaving",
                 };

                 for (let dateField in dates) {
                     let dateValue = $("[name='" + dateField + "']").val();
                     if (dateValue) {
                         let selectedDate = new Date(dateValue);
                         if (selectedDate > today) {
                             alert(`${dates[dateField]} cannot be in the future`);
                             $("[name='" + dateField + "']").focus();
                             event.preventDefault();
                             return false;
                         }
                     }
                 }
             });
         });
     </script>
 @endif
 
 
 
 
 

22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\teammember\create.blade.php
remove this code 

{{-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        $('.leaveDate').on('change', function() {
            var leaveDate = $(this);
            var leaveDateValue = leaveDate.val();
            var leaveDateGet = new Date(leaveDateValue);
            var leaveyear = leaveDateGet.getFullYear();
            // console.log(startyear);
            var leaveyearLength = leaveyear.toString().length;
            if (leaveyearLength > 4) {
                alert('Enter four digits for the year');
                leaveDate.val('');
            }
        });
    });
</script> --}}


22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\layouts\includes\stylesheet.blade.php
find text   .textfixed {
after this style add this style 
 
<style>
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
 
    /* input[type="number"] {
        -moz-appearance: textfield;
    } */
</style>





22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\layouts\includes\js.blade.php
add this code end of file 

 <script>
     $(document).ready(function() {
         $('input[name="mobile_no"], input[name="emergencycontactnumber"], input[name="adharcardnumber"], input[name="mothernumber"], input[name="fathernumber"], input[name="bankaccountnumber"], input[name="stdcost"], input[name="esthours"], input[name="fees"], input[name="estcost"]')
             .on('keypress', function(e) {
                 if (e.which === 45 || e.which === 43) e.preventDefault(); // Block "-" and "+"
             });
     });
 </script>




22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\teammember\form.blade.php


comment qualification file for vsademo and uncomment live wla

                        @foreach ($teamqualification as $teamqualificationData)
                            <tr>

                                <td>{{ $teamqualificationData->qualification ?? '' }}</td>
                                <td><a target="blank" target="blank" data-toggle="tooltip"
                                        title="{{ $teamqualificationData->document_file }}"
                                        href="{{ url('backEnd/image/teammember/document_file/' . $teamqualificationData->document_file ?? '') }}">
                                        {{ $teamqualificationData->original_file ?? '' }}</a>
                                </td>
                                <!-- <td>
                                <a href="{{ url('qualification/delete/' . $teamqualificationData->id) }}"
                                onclick="return confirm('Are you sure you want to delete this item?');"
                                class="btn btn-danger-soft btn-sm"><i class="far fa-trash-alt"></i></a>
                            </td> -->
                            </tr>
                        @endforeach 

I am working on profile validation ``` end ~!~!




User is able to fill the timesheet beyond 'Leaving Date'.
If user have leaveing date then not will be active by admin  ~!~!

22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\teammember\index.blade.php
find data-target="#requestModal">Inactive</button>


                                    <td>
                                        @if ($teammemberData->status == 0)
                                            @php
                                                $rejoiningUser = DB::table('teammembers')
                                                    ->where('teammembers.id', $teammemberData->id)
                                                    ->leftJoin(
                                                        'teamrolehistory',
                                                        'teamrolehistory.teammember_id',
                                                        '=',
                                                        'teammembers.id',
                                                    )
                                                    ->leftJoin(
                                                        'rejoiningsamepost',
                                                        'rejoiningsamepost.teammember_id',
                                                        '=',
                                                        'teammembers.id',
                                                    )
                                                    ->select([
                                                        'teammembers.id',
                                                        DB::raw(
                                                            'COALESCE(teamrolehistory.rejoiniedexitdate, rejoiningsamepost.rejoiniedexitdate, teammembers.leavingdate) AS final_leavingdate',
                                                        ),
                                                        DB::raw(
                                                            'COALESCE(teamrolehistory.rejoiningdate, rejoiningsamepost.rejoiningdate, teammembers.joining_date) AS final_joiningdate',
                                                        ),
                                                    ])
                                                    ->first();

                                                // Convert dates to Carbon instances (if they exist)
                                                $finalLeavingDate = $rejoiningUser->final_leavingdate
                                                    ? \Carbon\Carbon::parse($rejoiningUser->final_leavingdate)
                                                    : null;
                                                $finalJoiningDate = $rejoiningUser->final_joiningdate
                                                    ? \Carbon\Carbon::parse($rejoiningUser->final_joiningdate)
                                                    : null;
                                            @endphp
                                            @if (is_null($finalLeavingDate) || ($finalJoiningDate && $finalLeavingDate && $finalJoiningDate->gt($finalLeavingDate)))
                                                <a href="{{ url('/changeteamStatus/' . $teammemberData->status . '/1/' . $teammemberData->id) }}"
                                                    onclick="return confirm('Are you sure you want to Active this teammember?');">
                                                    <button class="btn btn-danger" data-toggle="modal"
                                                        style="height: 16px; width: auto; border-radius: 7px; display: flex; align-items: center; justify-content: center;font-size: 11px;"
                                                        data-target="#requestModal">Inactive</button>
                                                </a>
                                            @else
                                                <a style="pointer-events: none; opacity: 0.6;">
                                                    <button class="btn btn-danger" data-toggle="modal"
                                                        style="height: 16px; width: auto; border-radius: 7px; display: flex; align-items: center; justify-content: center;font-size: 11px;"
                                                        data-target="#requestModal">Inactive</button>
                                                </a>
                                            @endif
                                        @else
                                            <a href="{{ url('/changeteamStatus/' . $teammemberData->status . '/0/' . $teammemberData->id) }}"
                                                onclick="return confirm('Are you sure you want to Inactive this teammember?');">
                                                <button class="btn btn-primary" data-toggle="modal"
                                                    style="height: 16px; width: auto; border-radius: 7px; display: flex; align-items: center; justify-content: center;font-size: 11px;"
                                                    data-target="#requestModal">Active</button>
                                            </a>
                                        @endif
                                    </td>                                     






22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\teammember\form.blade.php

    <select name="status" id="exampleFormControlSelect1" class="form-control">


                <select name="status" id="exampleFormControlSelect1" class="form-control">
                    @if (Request::is('teammember/*/edit')) >
                        @if ($teammember->status == '0')
                            @php
                                $rejoiningUser = DB::table('teammembers')
                                    ->where('teammembers.id', $teammember->id)
                                    ->leftJoin(
                                        'teamrolehistory',
                                        'teamrolehistory.teammember_id',
                                        '=',
                                        'teammembers.id',
                                    )
                                    ->leftJoin(
                                        'rejoiningsamepost',
                                        'rejoiningsamepost.teammember_id',
                                        '=',
                                        'teammembers.id',
                                    )
                                    ->select([
                                        'teammembers.id',
                                        DB::raw(
                                            'COALESCE(teamrolehistory.rejoiniedexitdate, rejoiningsamepost.rejoiniedexitdate, teammembers.leavingdate) AS final_leavingdate',
                                        ),
                                        DB::raw(
                                            'COALESCE(teamrolehistory.rejoiningdate, rejoiningsamepost.rejoiningdate, teammembers.joining_date) AS final_joiningdate',
                                        ),
                                    ])
                                    ->first();

                                // Convert dates to Carbon instances (if they exist)
                                $finalLeavingDate = $rejoiningUser->final_leavingdate
                                    ? \Carbon\Carbon::parse($rejoiningUser->final_leavingdate)
                                    : null;
                                $finalJoiningDate = $rejoiningUser->final_joiningdate
                                    ? \Carbon\Carbon::parse($rejoiningUser->final_joiningdate)
                                    : null;
                            @endphp
                            @if (is_null($finalLeavingDate) || ($finalJoiningDate && $finalLeavingDate && $finalJoiningDate->gt($finalLeavingDate)))
                                <option value="0" selected>Inactive</option>
                                <option value="1">Active</option>
                            @else
                                <option value="0" selected disabled>Inactive</option>
                                <option value="1" disabled>Active</option>
                            @endif
                        @else
                            <option value="1" selected>Active</option>
                            <option value="0">Inactive</option>
                        @endif
                    @else
                        <option value="0">InActive</option>
                        <option value="1">Active</option>
                    @endif
                </select>
				
				
				
				
				

22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\promotion\index.blade.php
   @foreach ($rejoiningdatamerge as $rejoiningdata)
  
                                    <tr>
                                        <th>Employee Name</th>
                                        <th>Employee Code</th>
                                        <th>Rejoining Date</th>
                                        <th>Created Date</th>
                                        <th>Leaving Date</th>
                                    </tr>
									
									
									
	
	
									
									
									
   
                                    @foreach ($rejoiningdatamerge as $rejoiningdata)
                                        <tr>
                                            <td>{{ $rejoiningdata->team_member }}</td>
                                            <td>{{ $rejoiningdata->newstaff_code ?? ($rejoiningdata->staffcode ?? '') }}
                                            </td>
                                            <td class="textfixed"> <span style="display: none;">
                                                    {{ date('Y-m-d', strtotime($rejoiningdata->rejoiningdate)) }}</span>{{ date('d-m-Y', strtotime($rejoiningdata->rejoiningdate)) }}
                                            </td>
                                            <td class="textfixed">
                                                {{ date('d-m-Y', strtotime($rejoiningdata->rejoiningcreated ?? $rejoiningdata->created_at)) }}
                                            </td>
                                            <td class="textfixed">
                                                {{ $rejoiningdata->rejoiniedexitdate ? date('d-m-Y', strtotime($rejoiningdata->rejoiniedexitdate)) : 'NA' }}
                                            </td>
                                        </tr>
                                    @endforeach





1.User is able to fill the timesheet beyond 'Leaving Date'. ```end  ~!~!



Date Format update list ~!~!
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
1
resources\views\backEnd\appointmentletter\index.blade.php
fix date formate 
date('F d,Y',

date('d-m-Y',







2
resources\views\backEnd\index.blade.php
$holiday->startdate

{{ date('d-m-Y', strtotime($holiday->startdate)) }}







3
resources\views\backEnd\timesheetrequest\view.blade.php
{{ date('F d,Y', strtotime($timesheetrequest->created_at)) ?? '' }}


{{ date('d-m-Y', strtotime($timesheetrequest->created_at)) ?? '' }}







4
resources\views\backEnd\viewassignment.blade.php


                                        <td style="color: cornflowerblue;">
                                            {{ date('d-m-Y', strtotime($assignmentbudgetingDatas->periodend)) }}
                                        </td>
										
			
			
			

			
										
									
5							
resources\views\backEnd\article\view.blade.php
<small>{{ date('d-M-Y', strtotime($article->created_at)) }}</small>

{{ date('d-m-Y', strtotime($article->created_at)) }}





Date Format update list end ~!~!



Spelling of Promotion 
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
find text permotion using cace for all portal 
find text Permotion  using case for all portal 

replace Promotion



Spelling of Promotion end 





the exported leave report contains incorrect employee codes.
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\ApplyleaveController.php

index fun 
role 13 

replace it 

      $teamapplyleaveDatas  = DB::table('applyleaves')
        ->leftjoin('leavetypes', 'leavetypes.id', 'applyleaves.leavetype')
        ->leftjoin('teammembers', 'teammembers.id', 'applyleaves.createdby')
        ->leftJoin('teamrolehistory as teamrolehistoryteam', function ($join) {
          $join->on('teamrolehistoryteam.teammember_id', '=', 'applyleaves.createdby')
            ->on('teamrolehistoryteam.created_at', '<', 'applyleaves.created_at');
        })
        ->leftJoin('teammembers as approvername', 'approvername.id', '=', 'applyleaves.approver')
        ->leftJoin('teamrolehistory', function ($join) {
          $join->on('teamrolehistory.teammember_id', '=', 'approvername.id')
            ->on('teamrolehistory.created_at', '<', 'applyleaves.created_at');
        })
        ->leftjoin('roles', 'roles.id', 'teammembers.role_id')
        // ->where('applyleaves.status', 0)
        // ->where('teammembers.id', 835)
        ->select('applyleaves.*', 'teammembers.team_member', 'teammembers.staffcode', 'teammembers.emailid', 'roles.rolename', 'leavetypes.name', 'approvername.team_member as approvernames', 'approvername.staffcode as approverstaffcode', 'teamrolehistory.newstaff_code', 'teamrolehistoryteam.newstaff_code as teamnewstaffcode')
        ->take(7)
        ->get();
		
		
		
		
app\Http\Controllers\ApplyleaveController.php

index fun 
role 13 

replace it 

   $teamapplyleaveDatasfilter  = DB::table('applyleaves')
        ->leftjoin('leavetypes', 'leavetypes.id', 'applyleaves.leavetype')
        ->leftjoin('teammembers', 'teammembers.id', 'applyleaves.createdby')
        ->leftJoin('roles', 'roles.id', '=', 'teammembers.role_id')
        ->leftJoin(DB::raw('
          (SELECT teammember_id, newstaff_code 
           FROM teamrolehistory 
           WHERE created_at = (SELECT MAX(created_at) 
                               FROM teamrolehistory th2 
                               WHERE th2.teammember_id = teamrolehistory.teammember_id)
          ) AS teamrolehistory
      '), function ($join) {
          $join->on('teamrolehistory.teammember_id', '=', 'teammembers.id');
        })
        // ->where('applyleaves.status', 0)
        ->select('applyleaves.*', 'teammembers.team_member', 'teammembers.staffcode', 'teammembers.emailid', 'roles.rolename', 'leavetypes.name', 'teamrolehistory.newstaff_code')
        ->distinct()
        ->get();







22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\applyleave\teamapplication.blade.php
   <strong><label for="employee">Employee</label></strong>
replace  <select 


                                     <select class="language form-control" id="employee1" name="employee">
                                         <option value="">Please Select One</option>
                                         @foreach ($teamapplyleaveDatasfilter->unique('emailid') as $applyleaveDatas)
                                             <option value="{{ $applyleaveDatas->createdby }}"
                                                 {{ old('employee') == $applyleaveDatas->createdby ? 'selected' : '' }}>
                                                 {{ $applyleaveDatas->team_member }}
                                                 ({{ $applyleaveDatas->newstaff_code ?? ($applyleaveDatas->staffcode ?? '') }})
                                             </option>
                                         @endforeach
                                     </select>
									 
		
		
		

		
									 
									 
									 
resources\views\backEnd\applyleave\teamapplication.blade.php
{ $applyleaveDatas->newstaff_code ?? ($applyleaveDatas->staffcode ?? '') }}
replace  <td>


                                     <td>{{ $applyleaveDatas->teamnewstaffcode ?? ($applyleaveDatas->staffcode ?? '') }}
                                     </td>	







resources\views\backEnd\applyleave\teamapplication.blade.php
 <td>{{ $diff_in_days - $holidaycount ?? '' }}</td>
replace below code and remove @php for approver partne wla 

                                     <td class="textfixed">
                                         {{ $applyleaveDatas->approvernames ?? '' }}
                                     </td>
                                     <td>
                                         {{ $applyleaveDatas->newstaff_code ?? ($applyleaveDatas->approverstaffcode ?? '') }}
                                     </td>	




									 

22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\ApplyleaveController.php
function filterDataAdmin(Request $request)
replace this varable $teamapplyleaveDatasfilter 


  $teamapplyleaveDatasfilter  = DB::table('applyleaves')
      ->leftjoin('leavetypes', 'leavetypes.id', 'applyleaves.leavetype')
      ->leftjoin('teammembers', 'teammembers.id', 'applyleaves.createdby')
      ->leftJoin('roles', 'roles.id', '=', 'teammembers.role_id')
      ->leftJoin(DB::raw('
    (SELECT teammember_id, newstaff_code 
     FROM teamrolehistory 
     WHERE created_at = (SELECT MAX(created_at) 
                         FROM teamrolehistory th2 
                         WHERE th2.teammember_id = teamrolehistory.teammember_id)
    ) AS teamrolehistory
'), function ($join) {
        $join->on('teamrolehistory.teammember_id', '=', 'teammembers.id');
      })
      // ->where('applyleaves.status', 0)
      ->select('applyleaves.*', 'teammembers.team_member', 'teammembers.staffcode', 'teammembers.emailid', 'roles.rolename', 'leavetypes.name', 'teamrolehistory.newstaff_code')
      ->distinct()
      ->get();



the exported leave report contains incorrect employee codes. end 




Client wants to add multiple partner in lead partner and other partner column  ```start  2nd time
When admin and partner create assignment on that time form should be validate  ~!~!


22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\AssignmentmappingController.php
  public function create(Request $request)
   $teammember = Teammember::where('status', '1')->whereIn('role_id', [14, 15])->with('title', 'role')
  
  
         // $teammember = Teammember::where('status', '1')->whereIn('role_id', [14, 15])->with('title', 'role')
        //     ->orderBy('team_member', 'asc')->get();
        $teammember = DB::table('teammembers')
            ->leftJoin('teamrolehistory', 'teamrolehistory.teammember_id', '=', 'teammembers.id')
            ->leftjoin('titles', 'titles.id', 'teammembers.title_id')
            ->leftjoin('roles', 'roles.id', 'teammembers.role_id')
            ->whereIn('teammembers.role_id', [15, 14])
            ->where('teammembers.status', 1)
            ->select('teammembers.*', 'titles.title', 'roles.rolename', 'teamrolehistory.newstaff_code')
            ->orderBy('team_member', 'ASC')
            // ->take(7)
            ->get(); 



22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\AssignmentmappingController.php
public function store(Request $request)
 
if (!empty($request->otherpartner)) {
	


1
     
              $additionalpartnerIds = $request->additionalpartner_id;
                if (is_array($additionalpartnerIds) && count($additionalpartnerIds) > 0) {
                    foreach ($additionalpartnerIds as $index => $additionalpartnerId) {
                        if ($additionalpartnerId) {
                            DB::table('assignmentteammappings')->insert([
                                'assignmentmapping_id' => $id,
                                'teammember_id' => $additionalpartnerId,
                                'type' => 1,
                                'status' => 1,
                                'teamhour' => 0,
                                'created_at' => now(),
                                'updated_at' => now()
                            ]);

                            $additionalpartneremail = DB::table('teammembers')
                                ->where('id', $additionalpartnerId)
                                ->first();

                            $data = [
                                'assignmentid'      => $assignmentgenerate,
                                'clientname'        => $clientname->client_name,
                                'clientcode'        => $clientname->client_code,
                                'assignmentname'    => $request->assignmentname,
                                'assignment_name'   => $assignment_name,
                                'emailid'           => $additionalpartneremail->emailid,
                                'otherpatner'       => $teamemailotherpartner,
                                'assignmentpartner' => $teamemailpartner,
                                'teamleader'        => $teamleader,
                                'periodend' => $assignmentbudgetingDatas->periodend,
                                'assignmentgenerate' => $assignmentgenerate,
                            ];

                            $this->sendAssignmentEmail($data);
                        }
                    }
                }











2

               $additionalpartnerIds = $request->additionalpartner_id;
                if (is_array($additionalpartnerIds) && count($additionalpartnerIds) > 0) {
                    foreach ($additionalpartnerIds as $index => $additionalpartnerId) {
                        if ($additionalpartnerId) {
                            DB::table('assignmentteammappings')->insert([
                                'assignmentmapping_id' => $id,
                                'teammember_id' => $additionalpartnerId,
                                'type' => 1,
                                'status' => 1,
                                'teamhour' => 0,
                                'created_at' => now(),
                                'updated_at' => now()
                            ]);

                            $additionalpartneremail = DB::table('teammembers')
                                ->where('id', $additionalpartnerId)
                                ->first();

                            $data = [
                                'assignmentid'      => $assignmentgenerate,
                                'clientname'        => $clientname->client_name,
                                'clientcode'        => $clientname->client_code,
                                'assignmentname'    => $request->assignmentname,
                                'assignment_name'   => $assignment_name,
                                'emailid'           => $additionalpartneremail->emailid,
                                'otherpatner'       => $teamemailotherpartner,
                                'assignmentpartner' => $teamemailpartner,
                                'periodend' => $assignmentbudgetingDatas->periodend,
                                'assignmentgenerate' => $assignmentgenerate,
                            ];

                            $this->sendAssignmentEmail($data);
                        }
                    }
                }









22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\assignmentmapping\create.blade.php


<script type="text/javascript">
      $(document).ready(function() {
          var maxField = 60; // Input fields increment limitation
          var addButton = $('.add_buttonn'); // Add button selector
          var wrapper = $('.field_wrapper'); // Input field wrapper
          var x = 1; // Initial field counter

          // Store team member names for easy lookup
          var teamMembers = {};
          @foreach ($teammember as $teammemberData)
              teamMembers['{{ $teammemberData->id }}'] =
                  '{{ $teammemberData->team_member }} ({{ $teammemberData->rolename }}) ({{ $teammemberData->newstaff_code ?? ($teammemberData->staffcode ?? '') }})';
          @endforeach

          // Function to update options based on selected team members
          function updateDropdowns() {
              var selectedValues = [];

              // Get all selected team member IDs
              $('.language').each(function() {
                  var selectedValue = $(this).val();
                  if (selectedValue) {
                      selectedValues.push(selectedValue);
                  }
              });

              // Update each dropdown's options
              $('.language').each(function() {
                  var dropdown = $(this);
                  var currentValue = dropdown.val();

                  dropdown.find('option').each(function() {
                      var optionValue = $(this).val();

                      // If optionValue is selected in another dropdown, remove it from this dropdown
                      if (optionValue && selectedValues.includes(optionValue) && optionValue !==
                          currentValue) {
                          $(this).remove(); // Remove selected option
                      }
                  });
              });
          }

          // Initialize Select2 for the first select box
          $('.language').select2();

          // Update dropdowns on page load
          updateDropdowns();

          // Trigger update when any dropdown changes
          $(wrapper).on('change', '.language', function() {
              updateDropdowns();
          });

          // Once add button is clicked
          $(addButton).click(function() {
              if (x < maxField) {
                  x++; // Increment field counter

                  var fieldHTML =
                      '<div class="row row-sm hidedive"><div class="col-6"><div class="form-group">' +
                      '<label class="font-weight-600">Name *</label>' +
                      '<select required class="language form-control enablefalse" id="teammember_' + x +
                      '" name="teammember_id[]">' +
                      '<option value="">Please Select One</option>' +
                      '@foreach ($teammember as $teammemberData)' +
                      '<option value="{{ $teammemberData->id }}">' +
                      '{{ $teammemberData->team_member }} ({{ $teammemberData->rolename }}) ({{ $teammemberData->newstaff_code ?? ($teammemberData->staffcode ?? '') }})</option>' +
                      '@endforeach</select></div></div>' +
                      '<div class="col-5"><div class="form-group">' +
                      '<label class="font-weight-600">Type *</label>' +
                      '<select required class="form-control key enablefalse" name="type[]" id="type_' +
                      x + '">' +
                      '<option value="">Please Select One</option>' +
                      '<option value="0">Team Leader</option>' +
                      '<option value="2">Staff</option></select></div></div>' +
                      '<a style="margin-top: 36px; margin-left:12px" href="javascript:void(0);" class="remove_button">' +
                      '<img src="{{ url('backEnd/image/remove-icon.png') }}" /></a></div></div>';


                  $(wrapper).append(fieldHTML); // Add field html

                  // Initialize Select2 for the newly added select box
                  $('#teammember_' + x).select2();

                  // Update dropdowns after adding a new one
                  updateDropdowns();
              }
          });

          // Once remove button is clicked
          $(wrapper).on('click', '.remove_button', function(e) {
              e.preventDefault();

              // Get the selected value of the dropdown being removed
              var removedValue = $(this).closest('.row').find('.language').val();

              // Remove field html
              $(this).closest('.row').remove();
              x--; // Decrement field counter

              // Re-add the removed value to all dropdowns if it was selected
              if (removedValue) {
                  $('.language').each(function() {
                      var dropdown = $(this);
                      // Check if option already exists
                      if (!dropdown.find('option[value="' + removedValue + '"]').length) {
                          dropdown.append('<option value="' + removedValue + '">' + teamMembers[
                              removedValue] + '</option>');
                      }
                  });
              }

              // Update dropdowns after removing the field
              updateDropdowns();
          });
      });
  </script>
  
  
  
  

 
  <script type="text/javascript">
      $(document).ready(function() {
          var maxField = 5; // Input fields increment limitation
          var addButtonpartner = $('.add_buttonnpartner'); // Add button selector
          var wrapper = $('.field_wrapperpartner'); // Input field wrapper
          var x = 1; // Initial field counter

          // Initialize Select2 for the first select box
          $('.language').select2();

          // Once add button is clicked
          $(addButtonpartner).click(function() {
              if (x < maxField) {
                  x++; // Increment field counter

                  var fieldHTML =
                      '<div class="row row-sm"><div class="col-11"><div class="form-group">' +
                      '<label class="font-weight-600">Additional Partner</label>' +
                      '<select class="language form-control" id="additionalpartner_' +
                      x +
                      '" name="additionalpartner_id[]">' +
                      '<option value="">Please Select One</option>' +
                      '@foreach ($partner as $teammemberData)' +
                      '<option value="{{ $teammemberData->id }}">' +
                      '{{ $teammemberData->team_member }} ({{ $teammemberData->newstaff_code ?? ($teammemberData->staffcode ?? '') }})</option>' +
                      '@endforeach</select></div></div>' +
                      '<a style="margin-top: 36px; margin-left:12px" href="javascript:void(0);" class="remove_buttonpartner">' +
                      '<img src="{{ url('backEnd/image/remove-icon.png') }}" /></a></div></div>';


                  $(wrapper).append(fieldHTML); // Add field html

                  // Initialize Select2 for the newly added select box
                  $('#additionalpartner_' + x).select2();


              }
          });

          // Once remove button is clicked
          $(wrapper).on('click', '.remove_buttonpartner', function(e) {
              e.preventDefault();
              // Get the selected value of the dropdown being removed
              var removedValue = $(this).closest('.row').find('.language').val();
              // Remove field html
              $(this).closest('.row').remove();
              x--; // Decrement field counter
          });
      });
  </script>








22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\assignmentmapping\form.blade.php
<label class="font-weight-600">Lead Partner *</label>



<div class="field_wrapperpartner">
    <div class="row row-sm">
        <div class="col-6">
            <div class="form-group">
                <label class="font-weight-600">Lead Partner <span class="text-danger">*</span></label>
                <select required class="language form-control" id="category" name="leadpartner"
                    @if (Request::is('client/*/edit')) > <option disabled
            style="display:block">Please Select One</option>

            @foreach ($partner as $teammemberData)
            <option value="{{ $teammemberData->id }}"
            @if ($client->leadpartner == $teammemberData->id) selected @endif>
                    {{ $teammemberData->team_member }}</option>
                    @endforeach
                @else
                    <option></option>
                    <option value="">Please Select One</option>
                    @foreach ($partner as $teammemberData)
                        <option value="{{ $teammemberData->id }}">
                            {{ $teammemberData->team_member }} (
                            {{ $teammemberData->newstaff_code ?? ($teammemberData->staffcode ?? '') }} )</option>
                    @endforeach
                    @endif
                </select>
            </div>
        </div>
        <div class="col-5">
            <div class="form-group">
                <label class="font-weight-600">Other Partner </label>
                <select class="language form-control" name="otherpartner"
                    @if (Request::is('client/*/edit')) > <option disabled
            style="display:block">Please Select One</option>

            @foreach ($partner as $teammemberData)
            <option value="{{ $teammemberData->id }}"
            @if ($client->leadpartner == $teammemberData->id) selected @endif>
                    {{ $teammemberData->team_member }}</option>
                    @endforeach
                @else
                    <option></option>
                    <option value="">Please Select One</option>
                    @foreach ($partner as $teammemberData)
                        <option value="{{ $teammemberData->id }}">
                            {{ $teammemberData->team_member }}
                            ({{ $teammemberData->newstaff_code ?? ($teammemberData->staffcode ?? '') }})
                        </option>

                    @endforeach
                    @endif
                </select>
            </div>
        </div>
        <div class="col-1">
            <div class="form-group" style="margin-top: 36px;">
                <a href="javascript:void(0);" class="add_buttonnpartner" title="Add field"><img
                        src="{{ url('backEnd/image/add-icon.png') }}" /></a>
            </div>
        </div>
    </div>
</div>











22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\assignmentmapping\create.blade.php
Add Assignment Mapping


Add Assignment





22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\layouts\includes\js.blade.php
find  @if (Request::is('teammember/*/edit') || Request::is('teammember/create')) 
after this if condition add below script 


 @if (Request::is('assignmentmapping/create'))
     {{-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> --}}
     <script>
         $(document).ready(function() {
             $('form').submit(function(event) {
                 let fields = {
                     stdcost: "Std Cost",
                     estcost: "Est Cost",
                     fees: "Fees of The Asignment",
                 };
                 for (let field in fields) {
                     let value = $("[name='" + field + "']").val();
                     if (value && !/^\d+$/.test(value)) {
                         alert(`Enter ${fields[field]} using only digits`);
                         $("[name='" + field + "']").focus();
                         event.preventDefault();
                         return false;
                     }
                 }

                 // All partner value added in array
                 var partners = [
                     $("[name='leadpartner']").val() || "",
                     $("[name='otherpartner']").val() || "",
                     $('#additionalpartner_2').val() || "",
                     $('#additionalpartner_3').val() || "",
                     $('#additionalpartner_4').val() || "",
                     $('#additionalpartner_5').val() || ""
                 ];
                 console.log("Original: " + partners);
                 // Remove empty and undefined values
                 var filteredPartners = partners.filter(p => p && p.trim() !== "");
                 console.log("Filtered: " + filteredPartners);
                 // Check for duplicates using Set
                 var uniquePartners = new Set(filteredPartners);

                 if (uniquePartners.size !== filteredPartners.length) {
                     alert('The Lead Partner, Other Partner, and Additional Partner cannot be the same');
                     event.preventDefault(); // Prevent form submission
                     return false; // Exit the function
                 }

                 // Get the submit button
                 const submitButton = document.getElementById('submitButton');
                 // Disable the submit button to prevent multiple submissions
                 if (submitButton) {
                     submitButton.disabled = true;
                     submitButton.textContent = "Submitting...";
                 }

             });
         });
     </script>
 @endif







22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\assignmentmapping\form.blade.php
remove this script   submitButton.textContent = "Submitting...";

{{-- <script>
    document.getElementById('Myform').addEventListener('submit', function(event) {
        // Get the submit button
        const submitButton = document.getElementById('submitButton');
        // Disable the submit button to prevent multiple submissions
        submitButton.disabled = true;
        submitButton.textContent = "Submitting..."; // Optional: change the button text

    });
</script> --}}



22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\assignmentmapping\form.blade.php
find {{-- validation for date --}}
before findest text replace all code 

{{-- Assignment budgetting start --}}
<div class="row row-sm">
    <div class="col-3">
        <div class="form-group">
            <label class="font-weight-600">Client <span class="text-danger">*</span></label>
            <select required class="language form-control" id="exampleFormControlSelect1" name="client_id"
                @if (Request::is('assignmentmapping/*/edit')) > <option disabled style="display:block">Please Select One
                </option>
                @foreach ($clientss as $clientData)
                <option value="{{ $clientData->id }}"
                    {{ $assignmentbudgeting->client->id == $clientData->id ?? '' ? 'selected="selected"' : '' }}>
                    {{ $clientData->client_name }}</option>
                @endforeach
                @else
                <option></option>
                <option value="">Please Select One</option>
                @foreach ($clientss as $clientData)
                <option value="{{ $clientData->id }}">
                    {{ $clientData->client_name }} </option>

                @endforeach @endif
                </select>
        </div>
    </div>
    <div class="col-3">
        <div class="form-group">
            <label class="font-weight-600">Assignment <span class="text-danger">*</span></label>
            <select required class="form-control" id="exampleFormControlSelect1" name="assignment_id"
                @if (Request::is('assignmentmapping/*/edit')) > <option disabled style="display:block">Please Select One
                </option>

                @foreach ($assignment as $assignmentData)
                <option value="{{ $assignmentData->id }}"
                    {{ $assignmentbudgeting->assignment->id == $assignmentData->id ?? '' ? 'selected="selected"' : '' }}>
                    {{ $assignmentData->assignment_name }}</option>
                @endforeach


                @else
                <option></option>
                <option value="">Please Select One</option>
                @foreach ($assignment as $assignmentData)
                <option value="{{ $assignmentData->id }}">
                    {{ $assignmentData->assignment_name }}</option>

                @endforeach @endif
                </select>
        </div>
    </div>
    <div class="col-3">
        <div class="form-group">
            <label class="font-weight-600">Assignment Name <span class="text-danger">*</span></label>
            <input required type="text" name="assignmentname"
                value="{{ $assignmentbudgeting->assignmentname ?? '' }}" class=" form-control"
                placeholder="Enter Assignment Name">
        </div>
    </div>
    <div class="col-3">
        <div class="form-group">
            <label class="font-weight-600">Due Date <span class="text-danger">*</span></label>
            <input type="date" required id="example-date-input" name="duedate"
                value="{{ $assignmentbudgeting->date ?? '' }}" class=" form-control leaveDate" placeholder="Enter Date"
                required>
        </div>
    </div>
</div>
<div class="form-group">
    {{-- <button type="submit" class="btn btn-success" style="float:right"> Submit</button> --}}
    {{-- <a class="btn btn-secondary" href="{{ url('assignmentbudgeting') }}">
        Back</a> --}}

</div>
<div class="row row-sm">
    <div class="col-4">
        <div class="form-group">
            <label class="font-weight-600"> Period Start <span class="text-danger">*</span></label>
            <input type="date" required name="periodstart" id="startDate"
                value="{{ $assignmentmapping->periodstart ?? '' }}" class=" form-control"
                placeholder="Enter Period start">
        </div>
    </div>

    <div class="col-4">
        <div class="form-group">
            <label class="font-weight-600">Period End <span class="text-danger">*</span></label>
            <input type="date" required name="periodend" id="endDate"
                value="{{ $assignmentmapping->periodend ?? '' }}" class=" form-control" placeholder="Enter Perio End">
        </div>
    </div>
    <div class="col-4">
        <div class="form-group">
            <label class="font-weight-600">Is Role Over Assignment</label>
            <select class="form-control" id="exampleFormControlSelect1" name="roleassignment">
                <option value="1">No</option>
                <option value="2">Yes</option>

            </select>
        </div>
    </div>
</div>
<div class="row row-sm">
    <div class="col-4">
        <div class="form-group">
            <label class="font-weight-600">Est Hours <span class="text-danger">*</span></label>
            <input type="number" required name="esthours" value="{{ $assignmentmapping->esthours ?? '' }}"
                class=" form-control" placeholder="Enter Est Hours">
        </div>
    </div>
    <div class="col-4">
        <div class="form-group">
            <label class="font-weight-600">Std Cost <span class="text-danger">*</span></label>
            <input type="number" required name="stdcost" value="{{ $assignmentmapping->stdcost ?? '' }}"
                class=" form-control" placeholder="Enter Std Cost">
        </div>
    </div>
    <div class="col-4">
        <div class="form-group">
            <label class="font-weight-600">Est Cost <span class="text-danger">*</span></label>
            <input type="number" required name="estcost" value="{{ $assignmentmapping->estcost ?? '' }}"
                class=" form-control" placeholder="Enter Est Cost">
        </div>
    </div>

</div>
<div class="row row-sm">

    <div class="col-4">
        <div class="form-group">
            <label class="font-weight-600">Fees of The Asignment <span class="text-danger">*</span></label>
            <input type="number" required name="fees" value="{{ $assignmentmapping->fees ?? '' }}"
                class=" form-control" placeholder="Enter Fees of The Asignment">
        </div>
    </div>
</div>

<div class="field_wrapperpartner">
    <div class="row row-sm">
        <div class="col-6">
            <div class="form-group">
                <label class="font-weight-600">Lead Partner <span class="text-danger">*</span></label>
                <select required class="language form-control" id="category" name="leadpartner"
                    @if (Request::is('client/*/edit')) > <option disabled
            style="display:block">Please Select One</option>

            @foreach ($partner as $teammemberData)
            <option value="{{ $teammemberData->id }}"
            @if ($client->leadpartner == $teammemberData->id) selected @endif>
                    {{ $teammemberData->team_member }}</option>
                    @endforeach
                @else
                    <option></option>
                    <option value="">Please Select One</option>
                    @foreach ($partner as $teammemberData)
                        <option value="{{ $teammemberData->id }}">
                            {{ $teammemberData->team_member }} (
                            {{ $teammemberData->newstaff_code ?? ($teammemberData->staffcode ?? '') }} )</option>
                    @endforeach
                    @endif
                </select>
            </div>
        </div>
        <div class="col-5">
            <div class="form-group">
                <label class="font-weight-600">Other Partner </label>
                <select class="language form-control" name="otherpartner"
                    @if (Request::is('client/*/edit')) > <option disabled
            style="display:block">Please Select One</option>

            @foreach ($partner as $teammemberData)
            <option value="{{ $teammemberData->id }}"
            @if ($client->leadpartner == $teammemberData->id) selected @endif>
                    {{ $teammemberData->team_member }}</option>
                    @endforeach
                @else
                    <option></option>
                    <option value="">Please Select One</option>
                    @foreach ($partner as $teammemberData)
                        <option value="{{ $teammemberData->id }}">
                            {{ $teammemberData->team_member }}
                            ({{ $teammemberData->newstaff_code ?? ($teammemberData->staffcode ?? '') }})
                        </option>

                    @endforeach
                    @endif
                </select>
            </div>
        </div>
        <div class="col-1">
            <div class="form-group" style="margin-top: 36px;">
                <a href="javascript:void(0);" class="add_buttonnpartner" title="Add field"><img
                        src="{{ url('backEnd/image/add-icon.png') }}" /></a>
            </div>
        </div>
    </div>
</div>

<div class="field_wrapper">
    <div class="row row-sm">

        <div class="col-6">
            <div class="form-group">
                <label class="font-weight-600">Name <span class="text-danger">*</span></label>
                <input type="checkbox" data-toggle="tooltip" id="enablebox" style="margin-left: 10px;"
                    title="You want to submit without teammember, please click on check box">
                <select required class="language form-control enablefalse" id="key" name="teammember_id[]">
                    <option value="">Please Select One</option>
                    @foreach ($teammember as $teammemberData)
                        <option value="{{ $teammemberData->id }}" @if (!empty($store->financial) && $store->financial == $teammemberData->id) selected @endif>
                            {{ $teammemberData->team_member }} ( {{ $teammemberData->rolename }} ) (
                            {{ $teammemberData->newstaff_code ?? ($teammemberData->staffcode ?? '') }} )</option>
                    @endforeach
                </select>
            </div>
        </div>


        <div class="col-5">
            <div class="form-group">
                <label class="font-weight-600">Type <span class="text-danger">*</span></label>
                <select required class="form-control key enablefalse" id="key" name="type[]">
                    <option value="">Please Select One</option>
                    <option value="0">Team Leader</option>
                    <option value="2">Staff</option>
                </select>
            </div>
        </div>

        <div class="col-1">
            <div class="form-group" style="margin-top: 36px;">
                <a href="javascript:void(0);" class="add_buttonn" title="Add field"><img
                        src="{{ url('backEnd/image/add-icon.png') }}" /></a>
            </div>
        </div>
    </div>
</div>
<div class="form-group">
    <button type="submit" id="submitButton" class="btn btn-success" style="float:right"> Submit</button>
    <a class="btn btn-secondary" href="{{ url('assignmentmapping') }}">
        Back</a>

</div>









Client wants to add multiple partner in lead partner and other partner column  ```start  2nd time  end hare 

vsalocal, vsademo, vsalive ```end hare 


vsalocal, vsademo ```start 
Rejoining/Promotion features Deployed ```start
Client want to implement Rejoining process to users.
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\TimesheetController.php
 public function allteamsubmitted()


    return (object)[
        'id' => $firstItem->id,
        'teamid' => $firstItem->teamid,
        'week' => $firstItem->week,
        'totaldays' => $group->sum('totaldays'),
        'totaltime' => $group->sum('totaltime'),
        'dayscount' => $group->sum('dayscount'),
        'startdate' => $firstItem->startdate,
        'enddate' => $firstItem->enddate,
        'partnername' => $firstItem->partnername,
        'created_at' => $firstItem->created_at,
        'team_member' => $firstItem->team_member,
        'emailid' => $firstItem->emailid,
        // Use newstaff_code if available, otherwise staffcode
        'staffcode' => $firstItem->newstaff_code ?? $firstItem->staffcode,
        'partnerid' => $firstItem->partnerid,
      ];




22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\timesheet\myteamindex.blade.php
 <select class="language form-control" id="category7" name="teamname">
 

                                      <select class="language form-control" id="category7" name="teamname">
                                          <option value="">Please Select One</option>
                                          @foreach ($get_date->unique('emailid') as $jobDatas)
                                              <option value="{{ $jobDatas->teamid }}">
                                                  {{ $jobDatas->team_member }}(
                                                  {{ $jobDatas->newstaff_code ?? ($jobDatas->staffcode ?? '') }})
                                              </option>
                                          @endforeach
                                      </select>
	

	
									  
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\assignmentmapping\yearwise.blade.php
 @if ($sub->profilepic == null)
 
 
 1

                                        @foreach (DB::table('assignmentmappings')->leftJoin('assignmentteammappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')->leftJoin('teammembers', 'teammembers.id', '=', 'assignmentteammappings.teammember_id')->leftJoin('teamrolehistory as teamrolehistoryteam', function ($join) {
                $join->on('teamrolehistoryteam.teammember_id', '=', 'assignmentteammappings.teammember_id')->on('teamrolehistoryteam.created_at', '<', 'assignmentmappings.created_at');
            })->where('assignmentmappings.id', $assignmentmappingDatas->id)->where('assignmentteammappings.type', 0)->select('assignmentmappings.*', 'assignmentteammappings.*', 'teammembers.team_member', 'teammembers.staffcode', 'teammembers.profilepic', 'teamrolehistoryteam.newstaff_code')->get() as $sub)
                                            @if ($sub->profilepic == null)
                                                <a class="avatar avatar-xs" data-toggle="tooltip"
                                                    title="{{ $sub->team_member }} ({{ $sub->newstaff_code ?? ($sub->staffcode ?? '') }})">
                                                    <img src="{{ url('backEnd/image/dummy.png') }}"
                                                        class="avatar-img rounded-circle" alt="...">
                                                @else
                                                    <a class="avatar avatar-xs" data-toggle="tooltip"
                                                        title="{{ $sub->team_member }} ({{ $sub->newstaff_code ?? ($sub->staffcode ?? '') }})">
                                                        <img src="{{ asset('backEnd/image/teammember/profilepic/' . $sub->profilepic) }}"
                                                            class="avatar-img rounded-circle" alt="...">
                                            @endif
                                        @endforeach
										
										
										
										
										
										
										
2
                                        @foreach (DB::table('assignmentmappings')->leftjoin('assignmentteammappings', 'assignmentteammappings.assignmentmapping_id', 'assignmentmappings.id')->leftjoin('teammembers', 'teammembers.id', 'assignmentteammappings.teammember_id')->leftJoin('teamrolehistory as teamrolehistoryteam', function ($join) {
                $join->on('teamrolehistoryteam.teammember_id', '=', 'assignmentteammappings.teammember_id')->on('teamrolehistoryteam.created_at', '<', 'assignmentmappings.created_at');
            })->where('assignmentmappings.id', $assignmentmappingDatas->id)->where('assignmentteammappings.type', 2)->select('assignmentmappings.*', 'assignmentteammappings.*', 'teammembers.team_member', 'teammembers.staffcode', 'teammembers.profilepic', 'teamrolehistoryteam.newstaff_code')->get() as $sub)
                                            @if ($sub->profilepic == null)
                                                <a class="avatar avatar-xs" data-toggle="tooltip"
                                                    title="{{ $sub->team_member }} ({{ $sub->newstaff_code ?? ($sub->staffcode ?? '') }})">
                                                    <img src="{{ url('backEnd/image/dummy.png') }}"
                                                        class="avatar-img rounded-circle" alt="...">
                                                @else
                                                    <a class="avatar avatar-xs" data-toggle="tooltip"
                                                        title="{{ $sub->team_member }} ({{ $sub->newstaff_code ?? ($sub->staffcode ?? '') }})">
                                                        <img src="{{ asset('backEnd/image/teammember/profilepic/' . $sub->profilepic) }}"
                                                            class="avatar-img rounded-circle" alt="...">
                                            @endif
                                        @endforeach										
										
			

			

22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\ChecklistanswerController.php

  public function assignmentList($id)
  $teammemberDatas = DB::table('assignmentmappings')
  
  
    $teammemberDatas = DB::table('assignmentmappings')
            ->join('assignmentteammappings', 'assignmentteammappings.assignmentmapping_id', 'assignmentmappings.id')
            ->join('teammembers', 'teammembers.id', 'assignmentteammappings.teammember_id')
            ->leftJoin('teamrolehistory as teamrolehistoryteam', function ($join) {
                $join
                    ->on(
                        'teamrolehistoryteam.teammember_id',
                        '=',
                        'assignmentteammappings.teammember_id',
                    )
                    ->on(
                        'teamrolehistoryteam.created_at',
                        '<',
                        'assignmentmappings.created_at',
                    );
            })
            ->where('assignmentmappings.assignmentgenerate_id', $id)
            ->select('teammembers.*', 'assignmentteammappings.type', 'teamrolehistoryteam.newstaff_code')
            ->get();





22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\assignmentlist.blade.php

<td>{{ $teammemberData->staffcode }}</td>
 
 
                                             <td>{{ $teammemberData->newstaff_code ?? ($teammemberData->staffcode ?? '') }}
                                            </td>
 





22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\ChecklistanswerController.php
 $teammember = Teammember::whereIn('role_id', [15, 14])

        $teammember = DB::table('teammembers')
            ->leftJoin('teamrolehistory', 'teamrolehistory.teammember_id', '=', 'teammembers.id')
            ->whereIn('teammembers.role_id', [15, 14])
            ->where('teammembers.status', 1)
            ->select('teammembers.*', 'teamrolehistory.newstaff_code')
            ->orderBy('team_member', 'ASC')
            ->get();




22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\assignmentlist.blade.php
@foreach ($teammember as $teammemberData)


                                        @foreach ($teammember as $teammemberData)
                                            <option value="{{ $teammemberData->id }}">{{ $teammemberData->team_member }}
                                                ({{ $teammemberData->newstaff_code ?? ($teammemberData->staffcode ?? '') }})
                                            </option>
                                        @endforeach





22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\StepController.php
$teammemberall = DB::table('teammembers')


        $teammemberall = DB::table('teammembers')
            ->leftJoin('teamrolehistory', 'teamrolehistory.teammember_id', '=', 'teammembers.id')
            ->whereIn('teammembers.role_id', [15, 14])
            ->where('teammembers.status', 1)
            ->select('teammembers.*', 'teamrolehistory.newstaff_code')
            ->orderBy('team_member', 'ASC')
            ->get();





22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\viewassignment.blade.php
 @foreach ($teammemberall as $teammemberData)

                                                                    @foreach ($teammemberall as $teammemberData)
                                                                        <option value="{{ $teammemberData->id }}">
                                                                            {{ $teammemberData->team_member }}
                                                                            ({{ $teammemberData->newstaff_code ?? ($teammemberData->staffcode ?? '') }})
                                                                        </option>
                                                                    @endforeach





22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\StepController.php
 $teammemberDatas = DB::table('assignmentteammappings')


        $teammemberDatas = DB::table('assignmentteammappings')
            ->join('assignmentmappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')
            ->join('teammembers', 'teammembers.id', '=', 'assignmentteammappings.teammember_id')
            ->leftJoin('teamrolehistory as teamrolehistoryteam', function ($join) {
                $join->on('teamrolehistoryteam.teammember_id', '=', 'assignmentteammappings.teammember_id')
                    ->whereRaw('teamrolehistoryteam.created_at < assignmentmappings.created_at');
            })
            ->leftJoin('titles', 'titles.id', '=', 'teammembers.title_id')
            ->leftJoin('roles', 'roles.id', '=', 'teammembers.role_id')
            ->where('assignmentmappings.assignmentgenerate_id', $id)
            ->whereNotNull('assignmentteammappings.id')
            ->where('assignmentteammappings.type', '!=', 1)
            ->select([
                'teammembers.*',
                'roles.rolename',
                'titles.title',
                'assignmentteammappings.id AS assignmentteammappingsId',
                'assignmentteammappings.status AS assignmentteammappingsStatus',
                'assignmentteammappings.type',
                'assignmentteammappings.teamhour',
                'assignmentteammappings.viewerteam',
                'assignmentmappings.assignmentgenerate_id AS assignmentgenerateid',
                'assignmentmappings.leadpartner',
                'teamrolehistoryteam.newstaff_code'
            ])
            ->orderByDesc('assignmentteammappings.id')
            ->get();








resources\views\backEnd\viewassignment.blade.php
<td>{{ $teammemberData->staffcode }}</td>

1

    <td>{{ $teammemberData->newstaff_code ?? ($teammemberData->staffcode ?? '') }}</td>

2
 <td>{{ $teammemberData->newstaff_code ?? ($teammemberData->staffcode ?? '') }}</td>
 
 
 
 
 
 
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\AssignmentfolderfileController.php
   $assignmentfolderfile = DB::table('assignmentfolderfiles')


        $assignmentfolderfile = DB::table('assignmentfolderfiles')
            ->leftjoin('teammembers', 'teammembers.id', 'assignmentfolderfiles.createdby')
            ->leftJoin('teamrolehistory as teamrolehistoryteam', function ($join) {
                $join->on('teamrolehistoryteam.teammember_id', '=', 'assignmentfolderfiles.createdby')
                    ->whereRaw('teamrolehistoryteam.created_at < assignmentfolderfiles.created_at');
            })
            ->where('assignmentfolderfiles.assignmentfolder_id', $id)
            ->where('assignmentfolderfiles.status', 1)
            ->select('assignmentfolderfiles.*', 'teammembers.team_member', 'teammembers.staffcode', 'teamrolehistoryteam.newstaff_code')
            ->latest()
            ->get();
			
			
		

		
			
			

resources\views\backEnd\assignmentfolderfile\index.blade.php	
<td>{{ $assignmentfolderData->team_member }}

			
                                    <td>{{ $assignmentfolderData->team_member }}
                                        ({{ $assignmentfolderData->newstaff_code ?? ($assignmentfolderData->staffcode ?? '') }})
                                    </td>





22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\AssignmentmappingController.php

 $teammember = Teammember::where('status', '1')->whereIn('role_id', [14, 15])->with('title', 'role')
 
 
         $teammember = DB::table('teammembers')
            ->leftJoin('teamrolehistory', 'teamrolehistory.teammember_id', '=', 'teammembers.id')
            ->leftjoin('titles', 'titles.id', 'teammembers.title_id')
            ->leftjoin('roles', 'roles.id', 'teammembers.role_id')
            ->whereIn('teammembers.role_id', [15, 14])
            ->where('teammembers.status', 1)
            ->select('teammembers.*', 'titles.title', 'roles.rolename', 'teamrolehistory.newstaff_code')
            ->orderBy('team_member', 'ASC')
            // ->take(7)
            ->get();
			
	

	

resources\views\backEnd\assignmentmapping\form.blade.php
 @foreach ($teammember as $teammemberData)

                    @foreach ($teammember as $teammemberData)
                        <option value="{{ $teammemberData->id }}" @if (!empty($store->financial) && $store->financial == $teammemberData->id) selected @endif>
                            {{ $teammemberData->team_member }} ( {{ $teammemberData->rolename }} ) (
                            {{ $teammemberData->newstaff_code ?? ($teammemberData->staffcode ?? '') }} )</option>
                    @endforeach

					
					
					
					
					
resources\views\backEnd\assignmentmapping\create.blade.php
  '{{ $teammemberData->team_member }} ({{ $teammemberData->role->rolename }}) ({{ $teammemberData->staffcode }})</option>' +					
					


                  var fieldHTML =
                      '<div class="row row-sm hidedive"><div class="col-6"><div class="form-group">' +
                      '<label class="font-weight-600">Name *</label>' +
                      '<select required class="language form-control enablefalse" id="teammember_' + x +
                      '" name="teammember_id[]">' +
                      '<option value="">Please Select One</option>' +
                      '@foreach ($teammember as $teammemberData)' +
                      '<option value="{{ $teammemberData->id }}">' +
                      '{{ $teammemberData->team_member }} ({{ $teammemberData->rolename }}) ({{ $teammemberData->newstaff_code ?? ($teammemberData->staffcode ?? '') }})</option>' +
                      '@endforeach</select></div></div>' +
                      '<div class="col-5"><div class="form-group">' +
                      '<label class="font-weight-600">Type *</label>' +
                      '<select required class="form-control key enablefalse" name="type[]" id="type_' +
                      x + '">' +
                      '<option value="">Please Select One</option>' +
                      '<option value="0">Team Leader</option>' +
                      '<option value="2">Staff</option></select></div></div>' +
                      '<a style="margin-top: 36px; margin-left:12px" href="javascript:void(0);" class="remove_button">' +
                      '<img src="{{ url('backEnd/image/remove-icon.png') }}" /></a></div></div>';				
					





resources\views\backEnd\assignmentmapping\create.blade.php
 @foreach ($teammember as $teammemberData)
 

          @foreach ($teammember as $teammemberData)
              teamMembers['{{ $teammemberData->id }}'] =
                  '{{ $teammemberData->team_member }} ({{ $teammemberData->rolename }}) ({{ $teammemberData->newstaff_code ?? ($teammemberData->staffcode ?? '') }})';
          @endforeach
				






22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\clientlist.blade.php
@foreach (DB::table('assignmentmappings')->leftjoin('assignmentteammappings', 


1


                                                @foreach (DB::table('assignmentmappings')->leftJoin('assignmentteammappings', 'assignmentteammappings.assignmentmapping_id', '=', 'assignmentmappings.id')->leftJoin('teammembers', 'teammembers.id', '=', 'assignmentteammappings.teammember_id')->leftJoin('teamrolehistory as teamrolehistoryteam', function ($join) {
                $join->on('teamrolehistoryteam.teammember_id', '=', 'assignmentteammappings.teammember_id')->on('teamrolehistoryteam.created_at', '<', 'assignmentmappings.created_at');
            })->where('assignmentmappings.id', $clientassignmentDatas->id)->where('assignmentteammappings.type', 0)->select('assignmentmappings.*', 'assignmentteammappings.*', 'teammembers.team_member', 'teammembers.staffcode', 'teammembers.profilepic', 'teamrolehistoryteam.newstaff_code')->get() as $sub)
                                                    @if ($sub->profilepic == null)
                                                        <a class="avatar avatar-xs" data-toggle="tooltip"
                                                            title="{{ $sub->team_member }} ({{ $sub->newstaff_code ?? ($sub->staffcode ?? '') }})">
                                                            <img src="{{ url('backEnd/image/dummy.png') }}"
                                                                class="avatar-img rounded-circle" alt="...">
                                                        @else
                                                            <a class="avatar avatar-xs" data-toggle="tooltip"
                                                                title="{{ $sub->team_member }} ({{ $sub->newstaff_code ?? ($sub->staffcode ?? '') }})">
                                                                <img src="{{ asset('backEnd/image/teammember/profilepic/' . $sub->profilepic) }}"
                                                                    class="avatar-img rounded-circle" alt="...">
                                                    @endif
                                                @endforeach





2



                                                @foreach (DB::table('assignmentmappings')->leftjoin('assignmentteammappings', 'assignmentteammappings.assignmentmapping_id', 'assignmentmappings.id')->leftjoin('teammembers', 'teammembers.id', 'assignmentteammappings.teammember_id')->leftJoin('teamrolehistory as teamrolehistoryteam', function ($join) {
                $join->on('teamrolehistoryteam.teammember_id', '=', 'assignmentteammappings.teammember_id')->on('teamrolehistoryteam.created_at', '<', 'assignmentmappings.created_at');
            })->where('assignmentmappings.id', $clientassignmentDatas->id)->where('assignmentteammappings.type', 2)->select('assignmentmappings.*', 'assignmentteammappings.*', 'teammembers.team_member', 'teammembers.staffcode', 'teammembers.profilepic', 'teamrolehistoryteam.newstaff_code')->get() as $sub)
                                                    @if ($sub->profilepic == null)
                                                        <a class="avatar avatar-xs" data-toggle="tooltip"
                                                            title="{{ $sub->team_member }} ({{ $sub->newstaff_code ?? ($sub->staffcode ?? '') }})">
                                                            <img src="{{ url('backEnd/image/dummy.png') }}"
                                                                class="avatar-img rounded-circle" alt="...">
                                                        @else
                                                            <a class="avatar avatar-xs" data-toggle="tooltip"
                                                                title="{{ $sub->team_member }} ({{ $sub->newstaff_code ?? ($sub->staffcode ?? '') }})">
                                                                <img src="{{ asset('backEnd/image/teammember/profilepic/' . $sub->profilepic) }}"
                                                                    class="avatar-img rounded-circle" alt="...">
                                                    @endif
                                                @endforeach






22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\TeamloginController.php
 $teammemberlist = Teammember::where('status', '0')->get();
 
 
            $teammemberlist = Teammember::leftJoin('teamrolehistory', 'teamrolehistory.teammember_id', '=', 'teammembers.id')
                ->where('teammembers.status', 0)
                ->select('teammembers.*', 'teamrolehistory.newstaff_code')
                ->get();





resources\views\backEnd\teamlogin\form.blade.php
@foreach ($teammemberlist as $teammemberlistData)

            <option value="{{ $teammemberlistData->emailid }}">
                {{ $teammemberlistData->team_member }} ({{ $teammemberlistData->newstaff_code ?? ($teammemberlistData->staffcode ?? '') }})</option>




22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\applyleave\adminrevertleave.blade.php
@foreach ($timesheetrequestsDatas as $timesheetrequestsData)

replace @php


                                     @php
                                         $teamMembers = DB::table('teamrolehistory')
                                             ->whereIn('teammember_id', [
                                                 $timesheetrequestsData->createdby,
                                                 $timesheetrequestsData->approver,
                                             ])
                                             ->get()
                                             ->keyBy('teammember_id');

                                         $datadate = $timesheetrequestsData->created_at
                                             ? Carbon\Carbon::createFromFormat(
                                                 'Y-m-d H:i:s',
                                                 $timesheetrequestsData->created_at,
                                             )
                                             : null;

                                         $permotioncheck = $teamMembers[$timesheetrequestsData->createdby] ?? null;
                                         $approverdata = $teamMembers[$timesheetrequestsData->approver] ?? null;

                                         $permotiondate = $permotioncheck
                                             ? Carbon\Carbon::createFromFormat(
                                                 'Y-m-d H:i:s',
                                                 $permotioncheck->created_at,
                                             )
                                             : null;
                                         $approverdate = $approverdata
                                             ? Carbon\Carbon::createFromFormat('Y-m-d H:i:s', $approverdata->created_at)
                                             : null;
                                     @endphp





1
 <a href="{{ url('examleaverequest', $timesheetrequestsData->id) }}"> after this td replace staffcode 

                                         <td>
                                             @if ($permotioncheck && $datadate && $datadate->greaterThan($permotiondate))
                                                 {{ $permotioncheck->newstaff_code }}
                                             @else
                                                 {{ $timesheetrequestsData->teamstaffcode }}
                                             @endif
                                         </td>
		
		
	


	
2
<td class="textfixed">{{ $timesheetrequestsData->team_member }} after this td replace staffcode 

                                     <td>
                                         @if ($approverdata && $datadate && $datadate->greaterThan($approverdate))
                                             {{ $approverdata->newstaff_code }}
                                         @else
                                             {{ $timesheetrequestsData->staffcode }}
                                         @endif
                                     </td>		

									 


22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\TimesheetController.php

  public function full_list()
  {

    $teammember = DB::table('teammembers')
      ->leftjoin('roles', 'roles.id', 'teammembers.role_id')
      ->leftJoin('teamrolehistory', 'teamrolehistory.teammember_id', '=', 'teammembers.id')
      ->select('teammembers.id', 'teammembers.team_member', 'teammembers.emailid', 'roles.rolename', 'teammembers.staffcode', 'teamrolehistory.newstaff_code')
      ->where('teammembers.status', '1')->distinct()->get();

    $month = collect([
      'January',
      'February',
      'March',
      'April',
      'May',
      'June',
      'July',
      'August',
      'September',
      'October',
      'November',
      'December'
    ]);

    $result = DB::table('timesheetusers')->select(DB::raw('YEAR(date) as year'))
      ->distinct()->orderBy('year', 'DESC')->limit(5)->get();

    $years = $result->pluck('year');

    $timesheetData = DB::table('timesheets')
      ->leftJoin('teammembers', 'teammembers.id', '=', 'timesheets.created_by')
      ->where('timesheets.status', 0)
      // ->where('timesheets.created_by', 780)
      ->select([
        'timesheets.*',
        'teammembers.team_member',
        'teammembers.staffcode'
      ])
      ->orderByDesc('timesheets.id')
      ->limit(20)
      ->get();

    return view('backEnd.timesheet.hrindex', compact('timesheetData', 'teammember', 'month', 'years'));
  }




22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\timesheet\hrindex.blade.php

                <form method="GET" action="{{ url('timesheet/search') }}">
                    <div class="row row-sm">
                        <div class="col-4">
                            <div class="form-group">
                                <label class="font-weight-600">Employee </label>
                                <select class="language form-control" id="categoryy" name="teammember">
                                    <option value="">Please Select One</option>
                                    @foreach ($teammember as $teammemberData)
                                        <option value="{{ $teammemberData->id }}">
                                            {{ $teammemberData->team_member }} (
                                            {{ $teammemberData->newstaff_code ?? ($teammemberData->staffcode ?? '') }} )
                                        </option>
                                    @endforeach
                                </select>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="form-group">
                                <label class="font-weight-600">Select Month *</label>
                                <select required class="language form-control" id="category" name="month">
                                    @if (Request::is('timesheet/search'))
                                        @foreach ($month as $monthData)
                                            <option value="{{ $monthData }}"
                                                {{ date('F') == $monthData ? 'selected="selected"' : '' }}>
                                                {{ $monthData }}
                                            </option>
                                        @endforeach
                                    @else
                                        <option value="">Please Select One</option>
                                        @foreach ($month as $monthData)
                                            <option value="{{ $monthData }}">{{ $monthData }}</option>
                                        @endforeach
                                    @endif
                                </select>
                            </div>
                        </div>

                        <div class="col-3">
                            <div class="form-group">
                                <label class="font-weight-600">Select Year *</label>
                                <select required class="language form-control" id="category" name="year">
                                    <option value="2025">2025</option>
                                    <option value="2024">2024</option>
                                    <option value="2023">2023</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-1">
                            <div class="form-group">
                                <label class="font-weight-600" style="visibility: hidden;">action</label>
                                <button type="submit" class="btn btn-success" style="float:right"> Submit</button>
                            </div>
                        </div>
                    </div>
                </form>






22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\timesheet\hrindex.blade.php

                    <table id="examplee" class="display nowrap">
                        <thead>
                            <tr>
                                <th style="display: none;">id</th>
                                <th>Employee Name</th>
                                <th class="textfixed">Staff Code</th>
                                <th>Date</th>
                                <th>Day</th>
                                <th>Client Name</th>
                                <th class="textfixed">Client Code</th>
                                <th>Assignment Name</th>
                                <th>Work Item</th>
                                <th>Partner</th>
                                <th class="textfixed">Partner Code</th>
                                <th>Hour</th>
                                <th>Total Hour</th>
                                @if (Auth::user()->role_id == 18 || Auth::user()->role_id == 11)
                                    <th>Action</th>
                                @endif
                            </tr>

                        </thead>
                        <tbody>
                            @foreach ($timesheetData as $timesheetDatas)
                                <tr>
                                    @php
                                        $client_id = DB::table('timesheetusers')
                                            ->leftjoin('clients', 'clients.id', 'timesheetusers.client_id')
                                            ->leftjoin('assignments', 'assignments.id', 'timesheetusers.assignment_id')
                                            ->leftjoin('teammembers', 'teammembers.id', 'timesheetusers.partner')
                                            ->where('timesheetusers.timesheetid', $timesheetDatas->id)
                                            ->select(
                                                'clients.client_name',
                                                'clients.client_code',
                                                'timesheetusers.hour',
                                                'assignments.assignment_name',
                                                'billable_status',
                                                'workitem',
                                                'teammembers.id',
                                                'teammembers.team_member',
                                                'teammembers.staffcode',
                                            )
                                            ->get();

                                        //  dd($client_id);
                                        $total = DB::table('timesheetusers')

                                            ->where('timesheetusers.timesheetid', $timesheetDatas->id)
                                            ->sum('hour');

                                        $dates = date('l', strtotime($timesheetDatas->date));

                                        $permotioncheck = DB::table('teamrolehistory')
                                            ->where('teammember_id', $timesheetDatas->created_by)
                                            ->first();
                                        //shshid client
                                        $datadate = Carbon\Carbon::createFromFormat(
                                            'Y-m-d H:i:s',
                                            $timesheetDatas->created_at,
                                        );

                                        $permotiondate = null;
                                        if ($permotioncheck) {
                                            $permotiondate = Carbon\Carbon::createFromFormat(
                                                'Y-m-d H:i:s',
                                                $permotioncheck->created_at,
                                            );
                                        }
                                    @endphp
                                    <td style="display: none;">{{ $timesheetDatas->id }}</td>
                                    <td class="textfixed">{{ $timesheetDatas->team_member ?? '' }} </td>
                                    @if ($permotioncheck && $datadate->greaterThan($permotiondate))
                                        <td>{{ $permotioncheck->newstaff_code }}</td>
                                    @else
                                        <td>{{ $timesheetDatas->staffcode }}</td>
                                    @endif

                                    <td class="textfixed">{{ date('d-m-Y', strtotime($timesheetDatas->date)) }}
                                    </td>
                                    <td class="textfixed">
                                        @if ($timesheetDatas->date != null)
                                            {{ $dates ?? '' }}
                                        @endif
                                    </td>



                                    <td class="textfixed">
                                        @foreach ($client_id as $item)
                                            {{ $item->client_name ?? '' }}
                                            @if ($item->client_name != 0)
                                                ,
                                            @endif
                                        @endforeach
                                    </td>
                                    <td>
                                        @foreach ($client_id as $item)
                                            {{ $item->client_code ?? '' }}
                                            @if ($item->client_code != 0)
                                                ,
                                            @endif
                                        @endforeach
                                    </td>
                                    <td class="textfixed">
                                        @foreach ($client_id as $item)
                                            {{ $item->assignment_name ?? '' }}
                                            @if ($item->assignment_name != null)
                                                ,
                                            @endif
                                        @endforeach
                                    </td>

                                    <td class="textfixed">
                                        @foreach ($client_id as $item)
                                            {{ $item->workitem ?? '' }}@if ($item->workitem != null)
                                                ,
                                            @endif
                                        @endforeach
                                    </td>
                                    <td class="textfixed">
                                        @foreach ($client_id as $item)
                                            {{ $item->team_member ?? '' }}
                                            @if ($item->team_member != null)
                                                ,
                                            @endif
                                        @endforeach
                                    </td>
                                    <td>
                                        @foreach ($client_id as $item)
                                            @php

                                                $partnerpermotioncheck = DB::table('teamrolehistory')
                                                    ->where('teammember_id', $item->id)
                                                    ->first();
                                                //shshid client
                                                $partnerdatadate = Carbon\Carbon::createFromFormat(
                                                    'Y-m-d H:i:s',
                                                    $timesheetDatas->created_at,
                                                );

                                                $partnerpermotiondate = null;
                                                if ($partnerpermotioncheck) {
                                                    $partnerpermotiondate = Carbon\Carbon::createFromFormat(
                                                        'Y-m-d H:i:s',
                                                        $partnerpermotioncheck->created_at,
                                                    );
                                                }
                                            @endphp

                                            @if ($partnerpermotioncheck && $partnerdatadate && $partnerdatadate->greaterThan($partnerpermotiondate))
                                                {{ $partnerpermotioncheck->newstaff_code }}
                                            @else
                                                {{ $item->staffcode }}
                                            @endif
                                            @if ($item->team_member != null)
                                                ,
                                            @endif
                                        @endforeach
                                    </td>
                                    <td class="textfixed">
                                        @foreach ($client_id as $item)
                                            {{ $item->hour ?? '' }} @if ($item->hour != null)
                                                ,
                                            @endif
                                        @endforeach
                                    </td>
                                    <td>{{ $total }}</td>
                                    <td>
                                        @if (auth()->user()->role_id == 18 || auth()->user()->role_id == 11)
                                            <a href="{{ url('/timesheet/destroy/' . $timesheetDatas->id) }}"
                                                onclick="return confirm('Are you sure you want to delete this item?');"
                                                class="btn btn-danger-soft btn-sm"><i class="far fa-trash-alt"></i></a>
                                        @else
                                            <!-- <td> <a href="{{ url('/timesheet/destroy/' . $timesheetDatas->id) }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                onclick="return confirm('Are you sure you want to delete this item?');"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                class="btn btn-danger-soft btn-sm"><i class="far fa-trash-alt"></i></a></td>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        -->
                                        @endif
                                    </td>

                                </tr>
                            @endforeach

                            {{-- @foreach ($timesheetData as $timesheet)
                                @php
                                    // dd($timesheet);
                                    $clientData = $timesheetUsers[$timesheet->id] ?? collect();
                                    $dates = date('l', strtotime($timesheet->date));

                                    // Check promotion
                                    $promotion = $promotionData[$timesheet->created_by] ?? null;
                                    $datadate = \Carbon\Carbon::parse($timesheet->created_at);
                                    $promotiondate = $promotion ? \Carbon\Carbon::parse($promotion->created_at) : null;

                                    $total = DB::table('timesheetusers')
                                        ->where('timesheetusers.timesheetid', $timesheet->id)
                                        ->sum('hour');

                                @endphp

                                <tr>
                                    <td style="display: none;">{{ $timesheet->id }}</td>
                                    <td class="textfixed">{{ $timesheet->team_member ?? '' }}</td>
                                    <td>{{ $promotion && $datadate->greaterThan($promotiondate) ? $promotion->newstaff_code : $timesheet->staffcode }}
                                    </td>
                                    <td class="textfixed">{{ date('d-m-Y', strtotime($timesheet->date)) }}</td>
                                    <td class="textfixed">{{ $timesheet->date ? $dates : '' }}</td>

                                    <td class="textfixed">{{ $clientData->pluck('client_name')->filter()->implode(', ') }}
                                    </td>
                                    <td>{{ $clientData->pluck('client_code')->filter()->implode(', ') }}</td>
                                    <td class="textfixed">
                                        {{ $clientData->pluck('assignment_name')->filter()->implode(', ') }}</td>
                                    <td class="textfixed">{{ $clientData->pluck('workitem')->filter()->implode(', ') }}
                                    </td>
                                    <td class="textfixed">{{ $clientData->pluck('team_member')->filter()->implode(', ') }}
                                    </td>

                                    <td>
                                        @foreach ($clientData as $client)
                                            @php
                                                $partnerPromotion = $promotionData[$client->teammember_id] ?? null;
                                                $partnerdatadate = \Carbon\Carbon::parse($timesheet->created_at);
                                                $partnerpromotiondate = $partnerPromotion
                                                    ? \Carbon\Carbon::parse($partnerPromotion->created_at)
                                                    : null;
                                            @endphp

                                            {{ $partnerPromotion && $partnerdatadate->greaterThan($partnerpromotiondate) ? $partnerPromotion->newstaff_code : $client->staffcode }}

                                            @if (!$loop->last)
                                                ,
                                            @endif
                                        @endforeach
                                    </td>

                                    <td class="textfixed">
                                        {{ $clientData->pluck('hour')->filter()->implode(', ') ?: '0' }}</td>

                                    <td>{{ $total }}</td>
                                    <td>
                                        @if (auth()->user()->role_id == 18 || auth()->user()->role_id == 11)
                                            <a href="{{ url('/timesheet/destroy/' . $timesheet->id) }}"
                                                onclick="return confirm('Are you sure you want to delete this item?');"
                                                class="btn btn-danger-soft btn-sm"><i class="far fa-trash-alt"></i></a>
                                        @endif
                                    </td>
                                </tr>
                            @endforeach --}}

                        </tbody>
                    </table>
                          




22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\TimesheetController.php
public function show(Request $request)

 } elseif (auth()->user()->role_id == 11 || auth()->user()->role_id == 18) {
 
 
 
  } elseif (auth()->user()->role_id == 11 || auth()->user()->role_id == 18) {

      $teammember = DB::table('teammembers')
        ->leftjoin('roles', 'roles.id', 'teammembers.role_id')
        ->leftJoin('teamrolehistory', 'teamrolehistory.teammember_id', '=', 'teammembers.id')
        ->select('teammembers.id', 'teammembers.team_member', 'teammembers.emailid', 'roles.rolename', 'teammembers.staffcode', 'teamrolehistory.newstaff_code')
        ->where('teammembers.status', '1')->distinct()->get();

      $month = collect([
        'January',
        'February',
        'March',
        'April',
        'May',
        'June',
        'July',
        'August',
        'September',
        'October',
        'November',
        'December'
      ]);

      $timesheetData = DB::table('timesheets')
        ->leftjoin('teammembers', 'teammembers.id', 'timesheets.created_by')
        ->where('timesheets.created_by', $request->teammember)
        ->where('timesheets.month', $request->month)
        ->whereYear('timesheets.date', '=', $request->year)
        ->where('timesheets.status', '=', 0)
        ->select('timesheets.*', 'teammembers.team_member', 'teammembers.staffcode')->get();
    }




22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\TimesheetController.php
  // this is for team submitted timesheet on Admin
  
  
      // this is for team submitted timesheet on Admin
    else {
      // dd(auth()->user()->role_id);
      $teamname = $request->input('teamname');
      $start = $request->input('start');
      $end = $request->input('end');
      $totalhours = $request->input('totalhours');
      $partnerId = $request->input('partnersearch');

      $query = DB::table('timesheetreport')
        ->leftjoin('teammembers', 'teammembers.id', 'timesheetreport.teamid')
        ->leftJoin('teamrolehistory', function ($join) {
          $join->on('teamrolehistory.teammember_id', '=', 'teammembers.id')
            ->on('teamrolehistory.created_at', '<', 'timesheetreport.created_at');
        })
        ->leftjoin('teammembers as partners', 'partners.id', 'timesheetreport.partnerid')
        ->select('timesheetreport.*', 'teammembers.team_member', 'partners.team_member as partnername', 'teammembers.staffcode', 'teamrolehistory.newstaff_code')
        ->orderBy('timesheetreport.startdate', 'desc');

      // teamname with othser field to  filter
      if ($teamname) {
        $query->where('timesheetreport.teamid', $teamname);
      }

      if ($teamname && $totalhours) {
        $query->where(function ($q) use ($teamname, $totalhours) {
          $q->where('timesheetreport.teamid', $teamname)
            ->where('timesheetreport.totaltime', $totalhours);
        });
      }
      if ($teamname && $partnerId) {
        $query->where(function ($q) use ($teamname, $partnerId) {
          $q->where('timesheetreport.teamid', $teamname)
            ->where('timesheetreport.partnerid', $partnerId);
        });
      }

      // patner or othse one data
      if ($partnerId) {
        $query->where('timesheetreport.partnerid', $partnerId);
      }

      if ($partnerId && $totalhours) {
        $query->where(function ($q) use ($partnerId, $totalhours) {
          $q->where('timesheetreport.partnerid', $partnerId)
            ->where('timesheetreport.totaltime', $totalhours);
        });
      }

      // total hour wise  wise or othser data
      if ($totalhours) {
        $query->where('timesheetreport.totaltime', $totalhours);
      }
      //! end date 
      if ($start && $end) {
        $query->where(function ($query) use ($start, $end) {
          $query->whereBetween('timesheetreport.startdate', [$start, $end])
            ->orWhereBetween('timesheetreport.enddate', [$start, $end])
            ->orWhere(function ($query) use ($start, $end) {
              $query->where('timesheetreport.startdate', '<=', $start)
                ->where('timesheetreport.enddate', '>=', $end);
            });
        });
      }

      $filteredDataaa = $query->get();

      // maping double date ************
      $groupedData = $filteredDataaa->groupBy(function ($item) {
        return $item->team_member . '|' . $item->week;
      })->map(function ($group) {
        $firstItem = $group->first();

        return (object)[
          'id' => $firstItem->id,
          'teamid' => $firstItem->teamid,
          'week' => $firstItem->week,
          'totaldays' => $group->sum('totaldays'),
          'totaltime' => $group->sum('totaltime'),
          'dayscount' => $group->sum('dayscount'),
          'startdate' => $firstItem->startdate,
          'enddate' => $firstItem->enddate,
          'partnername' => $firstItem->partnername,
          'created_at' => $firstItem->created_at,
          'team_member' => $firstItem->team_member,
          'staffcode' => $firstItem->newstaff_code ?? $firstItem->staffcode,
          'partnerid' => $firstItem->partnerid,
        ];
      });

      $filteredData = collect($groupedData->values());
      // dd($filteredData);
      return response()->json($filteredData);
    }






22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\TimesheetController.php

  public function allteamsubmitted()
  {
    // Fetch all necessary data in a single query
    $get_datess = DB::table('timesheetreport')
      ->leftjoin('teammembers', 'teammembers.id', 'timesheetreport.teamid')
      ->leftJoin('teamrolehistory', function ($join) {
        $join->on('teamrolehistory.teammember_id', '=', 'teammembers.id')
          ->on('teamrolehistory.created_at', '<', 'timesheetreport.created_at');
      })
      ->leftjoin('teammembers as partners', 'partners.id', 'timesheetreport.partnerid')
      // ->where('timesheetreport.teamid', 868)
      ->select(
        'timesheetreport.*',
        'teamrolehistory.newstaff_code',
        'teammembers.team_member',
        'teammembers.staffcode',
        'partners.team_member as partnername',
        'teammembers.emailid'
      )
      ->latest()
      ->get();

    $permissiontimesheet = DB::table('timesheetreport')->first();

    // Map and group data
    $groupedData = $get_datess->groupBy(function ($item) {
      return $item->team_member . '|' . $item->week;
    })->map(function ($group) {
      $firstItem = $group->first();

      return (object)[
        'id' => $firstItem->id,
        'teamid' => $firstItem->teamid,
        'week' => $firstItem->week,
        'totaldays' => $group->sum('totaldays'),
        'totaltime' => $group->sum('totaltime'),
        'dayscount' => $group->sum('dayscount'),
        'startdate' => $firstItem->startdate,
        'enddate' => $firstItem->enddate,
        'partnername' => $firstItem->partnername,
        'created_at' => $firstItem->created_at,
        'team_member' => $firstItem->team_member,
        'emailid' => $firstItem->emailid,
        // Use newstaff_code if available, otherwise staffcode
        'staffcode' => $firstItem->newstaff_code ?? $firstItem->staffcode,
        'partnerid' => $firstItem->partnerid,
      ];
    });

    $get_date = collect($groupedData->values());


    return view('backEnd.timesheet.myteamindex', compact('get_date', 'permissiontimesheet'));
  }





22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\timesheet\hrindex.blade.php

                            @foreach ($timesheetData as $timesheetDatas)
                                <tr>
                                    @php
                                        $client_id = DB::table('timesheetusers')
                                            ->leftjoin('clients', 'clients.id', 'timesheetusers.client_id')
                                            ->leftjoin('assignments', 'assignments.id', 'timesheetusers.assignment_id')
                                            ->leftjoin('teammembers', 'teammembers.id', 'timesheetusers.partner')
                                            ->where('timesheetusers.timesheetid', $timesheetDatas->id)
                                            ->select(
                                                'clients.client_name',
                                                'clients.client_code',
                                                'timesheetusers.hour',
                                                'assignments.assignment_name',
                                                'billable_status',
                                                'workitem',
                                                'teammembers.id',
                                                'teammembers.team_member',
                                                'teammembers.staffcode',
                                            )
                                            ->get();

                                        //  dd($client_id);
                                        $total = DB::table('timesheetusers')
                                            ->where('timesheetusers.timesheetid', $timesheetDatas->id)
                                            ->sum('hour');

                                        $dates = date('l', strtotime($timesheetDatas->date));

                                        $permotioncheck = DB::table('teamrolehistory')
                                            ->where('teammember_id', $timesheetDatas->created_by)
                                            ->first();

                                        $assignmentcheck = DB::table('timesheetusers')
                                            ->leftJoin(
                                                'assignmentbudgetings',
                                                'assignmentbudgetings.assignmentgenerate_id',
                                                'timesheetusers.assignmentgenerate_id',
                                            )
                                            ->where('timesheetid', $timesheetDatas->id)
                                            ->select('assignmentbudgetings.created_at')
                                            ->first();

                                        //shshid client

                                        $datadate = $assignmentcheck->created_at
                                            ? Carbon\Carbon::createFromFormat(
                                                'Y-m-d H:i:s',
                                                $assignmentcheck->created_at,
                                            )
                                            : null;

                                        $permotiondate = null;
                                        if ($permotioncheck) {
                                            $permotiondate = Carbon\Carbon::createFromFormat(
                                                'Y-m-d H:i:s',
                                                $permotioncheck->created_at,
                                            );
                                        }
                                    @endphp
                                    <td style="display: none;">{{ $timesheetDatas->id }}</td>
                                    <td class="textfixed">{{ $timesheetDatas->team_member ?? '' }} </td>
                                    @if ($permotioncheck && $datadate && $datadate->greaterThan($permotiondate))
                                        <td>{{ $permotioncheck->newstaff_code }}</td>
                                    @else
                                        <td>{{ $timesheetDatas->staffcode }}</td>
                                    @endif

                                    <td class="textfixed">{{ date('d-m-Y', strtotime($timesheetDatas->date)) }}
                                    </td>
                                    <td class="textfixed">
                                        @if ($timesheetDatas->date != null)
                                            {{ $dates ?? '' }}
                                        @endif
                                    </td>



                                    <td class="textfixed">
                                        @foreach ($client_id as $item)
                                            {{ $item->client_name ?? '' }}
                                            @if ($item->client_name != 0)
                                                ,
                                            @endif
                                        @endforeach
                                    </td>
                                    <td>
                                        @foreach ($client_id as $item)
                                            {{ $item->client_code ?? '' }}
                                            @if ($item->client_code != 0)
                                                ,
                                            @endif
                                        @endforeach
                                    </td>
                                    <td class="textfixed">
                                        @foreach ($client_id as $item)
                                            {{ $item->assignment_name ?? '' }}
                                            @if ($item->assignment_name != null)
                                                ,
                                            @endif
                                        @endforeach
                                    </td>

                                    <td class="textfixed">
                                        @foreach ($client_id as $item)
                                            {{ $item->workitem ?? '' }}@if ($item->workitem != null)
                                                ,
                                            @endif
                                        @endforeach
                                    </td>
                                    <td class="textfixed">
                                        @foreach ($client_id as $item)
                                            {{ $item->team_member ?? '' }}
                                            @if ($item->team_member != null)
                                                ,
                                            @endif
                                        @endforeach
                                    </td>
                                    <td>
                                        @foreach ($client_id as $item)
                                            @php

                                                $partnerpermotioncheck = DB::table('teamrolehistory')
                                                    ->where('teammember_id', $item->id)
                                                    ->first();

                                                $assignmentcheck = DB::table('timesheetusers')
                                                    ->leftJoin(
                                                        'assignmentbudgetings',
                                                        'assignmentbudgetings.assignmentgenerate_id',
                                                        'timesheetusers.assignmentgenerate_id',
                                                    )
                                                    ->where('timesheetid', $timesheetDatas->id)
                                                    ->select('assignmentbudgetings.created_at')
                                                    ->first();

                                                //shshid client

                                                $partnerdatadate = $assignmentcheck->created_at
                                                    ? Carbon\Carbon::createFromFormat(
                                                        'Y-m-d H:i:s',
                                                        $assignmentcheck->created_at,
                                                    )
                                                    : null;

                                                $partnerpermotiondate = null;
                                                if ($partnerpermotioncheck) {
                                                    $partnerpermotiondate = Carbon\Carbon::createFromFormat(
                                                        'Y-m-d H:i:s',
                                                        $partnerpermotioncheck->created_at,
                                                    );
                                                }
                                            @endphp

                                            @if ($partnerpermotioncheck && $partnerdatadate && $partnerdatadate->greaterThan($partnerpermotiondate))
                                                {{ $partnerpermotioncheck->newstaff_code }}
                                            @else
                                                {{ $item->staffcode }}
                                            @endif
                                            @if ($item->team_member != null)
                                                ,
                                            @endif
                                        @endforeach
                                    </td>
                                    <td class="textfixed">
                                        @foreach ($client_id as $item)
                                            {{ $item->hour ?? '' }} @if ($item->hour != null)
                                                ,
                                            @endif
                                        @endforeach
                                    </td>
                                    <td>{{ $total }}</td>
                                    <td>
                                        @if (auth()->user()->role_id == 18 || auth()->user()->role_id == 11)
                                            <a href="{{ url('/timesheet/destroy/' . $timesheetDatas->id) }}"
                                                onclick="return confirm('Are you sure you want to delete this item?');"
                                                class="btn btn-danger-soft btn-sm"><i class="far fa-trash-alt"></i></a>
                                        @else
                                            <!-- <td> <a href="{{ url('/timesheet/destroy/' . $timesheetDatas->id) }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            onclick="return confirm('Are you sure you want to delete this item?');"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            class="btn btn-danger-soft btn-sm"><i class="far fa-trash-alt"></i></a></td>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    -->
                                        @endif
                                    </td>

                                </tr>
                            @endforeach
							
							
							
							
							
							
							
							
							
							



22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\timesheet\rejectedlist.blade.php
 $assignmentcheck = DB::table('assignmentbudgetings')


                                          $assignmentcheck = DB::table('assignmentbudgetings')
                                            ->where('assignmentgenerate_id', $timesheetDatas->assignmentgenerate_id)
                                            ->first();

                                        $teamMembers = DB::table('teamrolehistory')
                                            ->whereIn('teammember_id', [
                                                $timesheetDatas->createdby,
                                                $timesheetDatas->partner,
                                            ])
                                            ->get()
                                            ->keyBy('teammember_id');

                                        $datadate = $assignmentcheck
                                            ? Carbon\Carbon::createFromFormat(
                                                'Y-m-d H:i:s',
                                                $assignmentcheck->created_at,
                                            )
                                            : null;

                                        // dd($teamMembers);

                                        $permotioncheck = $teamMembers[$timesheetDatas->createdby] ?? null;
                                        $approverdata = $teamMembers[$timesheetDatas->partner] ?? null;

                                        $permotiondate = $permotioncheck
                                            ? Carbon\Carbon::createFromFormat(
                                                'Y-m-d H:i:s',
                                                $permotioncheck->created_at,
                                            )
                                            : null;
                                        $approverdate = $approverdata
                                            ? Carbon\Carbon::createFromFormat('Y-m-d H:i:s', $approverdata->created_at)
                                            : null;
                                    @endphp
									
									
									
									
									
									
									
									
 {{ $timesheetDatas->staffcode }}
 
									
                                    <td>
                                        @if ($permotioncheck && $datadate && $datadate->greaterThan($permotiondate))
                                            {{ $permotioncheck->newstaff_code }}
                                        @else
                                            {{ $timesheetDatas->staffcode }}
                                        @endif
                                    </td>
									
									
									
									
@if (count((array) $client_id->assignment_name) > 1)
									
                                    <td class="textfixed">
                                        {{ $client_id->assignment_name ?? '' }}
                                        @if ($timesheetDatas->assignmentname != null)
                                            ({{ $timesheetDatas->assignmentname ?? '' }})
                                        @endif
                                        @if (count((array) $client_id->assignment_name) > 1)
                                            ,
                                        @endif
                                    </td>	




  {{ $client_id->staffcode ?? '' }}
  
                                    <td class="textfixed">
                                        @if ($approverdata && $datadate && $datadate->greaterThan($approverdate))
                                            {{ $approverdata->newstaff_code }}
                                        @else
                                            {{ $client_id->staffcode ?? '' }}
                                        @endif
                                        @if (count((array) $client_id->team_member) > 1)
                                            ,
                                        @endif
                                    </td>									




22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\report\assignmentreport.blade.php

 ->where('teammembers.id', $assignmentmappingDatas->otherpartner)



                                                 @php
                                                    $leadpartner = DB::table('teammembers')
                                                        ->leftJoin(
                                                            'teamrolehistory',
                                                            'teamrolehistory.teammember_id',
                                                            '=',
                                                            'teammembers.id',
                                                        )
                                                        ->where('teammembers.id', $assignmentmappingDatas->leadpartner)
                                                        ->select(
                                                            'teammembers.team_member',
                                                            'teammembers.staffcode',
                                                            'teamrolehistory.newstaff_code',
                                                        )
                                                        ->first();

                                                    $otherPartner = DB::table('teammembers')
                                                        ->leftJoin(
                                                            'teamrolehistory',
                                                            'teamrolehistory.teammember_id',
                                                            '=',
                                                            'teammembers.id',
                                                        )
                                                        ->where('teammembers.id', $assignmentmappingDatas->otherpartner)
                                                        ->select(
                                                            'teammembers.team_member',
                                                            'teammembers.staffcode',
                                                            'teamrolehistory.newstaff_code',
                                                        )
                                                        ->first();

                                                @endphp
                                                <td>
                                                    {{ $leadpartner->team_member ?? '' }}
                                                </td>
                                                <td>
                                                    @if ($leadpartner && $leadpartner->team_member)
                                                        {{ $leadpartner->newstaff_code ?? ($leadpartner->staffcode ?? '') }}
                                                    @endif
                                                </td>

                                                <td>
                                                    {{ $otherPartner->team_member ?? '' }}
                                                </td>
                                                <td>
                                                    @if ($otherPartner && $otherPartner->team_member)
                                                        {{ $otherPartner->newstaff_code ?? ($otherPartner->staffcode ?? '') }}
                                                    @endif
                                                </td>
												
									

									
												
												
 <td>{{ App\Models\Teammember::select('team_member')->where('id', $assignmentmappingcloseDatas->otherpartner)->first()											
												


                                            @php
                                                $leadpartner = DB::table('teammembers')
                                                    ->leftJoin(
                                                        'teamrolehistory',
                                                        'teamrolehistory.teammember_id',
                                                        '=',
                                                        'teammembers.id',
                                                    )
                                                    ->where('teammembers.id', $assignmentmappingcloseDatas->leadpartner)
                                                    ->select(
                                                        'teammembers.team_member',
                                                        'teammembers.staffcode',
                                                        'teamrolehistory.newstaff_code',
                                                    )
                                                    ->first();

                                                $otherPartner = DB::table('teammembers')
                                                    ->leftJoin(
                                                        'teamrolehistory',
                                                        'teamrolehistory.teammember_id',
                                                        '=',
                                                        'teammembers.id',
                                                    )
                                                    ->where(
                                                        'teammembers.id',
                                                        $assignmentmappingcloseDatas->otherpartner,
                                                    )
                                                    ->select(
                                                        'teammembers.team_member',
                                                        'teammembers.staffcode',
                                                        'teamrolehistory.newstaff_code',
                                                    )
                                                    ->first();

                                            @endphp
                                            <td>
                                                {{ $leadpartner->team_member ?? '' }}
                                            </td>
                                            <td>
                                                @if ($leadpartner && $leadpartner->team_member)
                                                    {{ $leadpartner->newstaff_code ?? ($leadpartner->staffcode ?? '') }}
                                                @endif
                                            </td>

                                            <td>
                                                {{ $otherPartner->team_member ?? '' }}
                                            </td>
                                            <td>
                                                @if ($otherPartner && $otherPartner->team_member)
                                                    {{ $otherPartner->newstaff_code ?? ($otherPartner->staffcode ?? '') }}
                                                @endif
                                            </td>
											
											

22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\StepController.php

    public function assignmentviewer()
    {
        // $assignmentviwerteams = DB::table('assignmentmappings')
        //     ->join('assignmentbudgetings', 'assignmentmappings.assignmentgenerate_id', '=', 'assignmentbudgetings.assignmentgenerate_id')
        //     ->join('assignments', 'assignments.id', '=', 'assignmentbudgetings.assignment_id')
        //     ->leftjoin('assignmentteammappings', 'assignmentteammappings.assignmentmapping_id', 'assignmentmappings.id')
        //     ->leftjoin('teammembers', 'teammembers.id', 'assignmentteammappings.teammember_id')
        //     ->leftJoin('teamrolehistory', 'teamrolehistory.teammember_id', '=', 'assignmentteammappings.teammember_id')
        //     ->leftjoin('titles', 'titles.id', 'teammembers.title_id')
        //     ->leftjoin('roles', 'roles.id', 'teammembers.role_id')
        //     ->where('assignmentteammappings.viewerteam', 1)
        //     ->select(
        //         'teammembers.*',
        //         'roles.rolename',
        //         'assignmentteammappings.type',
        //         'titles.title',
        //         'assignmentteammappings.id As assignmentteammappingsId',
        //         'assignmentteammappings.status as assignmentteammappingsStatus',
        //         'assignmentmappings.assignmentgenerate_id as assignmentgenerateid',
        //         'assignmentteammappings.teamhour',
        //         'assignmentmappings.leadpartner',
        //         'teamrolehistory.newstaff_code',
        //         'assignmentbudgetings.assignmentname',
        //         'assignments.assignment_name',
        //         'assignmentteammappings.viewerteam'
        //     )
        //     ->get();

        $assignmentviwerteams = DB::table('assignmentmappings')
            ->join('assignmentbudgetings', 'assignmentmappings.assignmentgenerate_id', '=', 'assignmentbudgetings.assignmentgenerate_id')
            ->join('assignments', 'assignments.id', '=', 'assignmentbudgetings.assignment_id')
            ->leftjoin('assignmentteammappings', 'assignmentteammappings.assignmentmapping_id', 'assignmentmappings.id')
            ->leftjoin('teammembers', 'teammembers.id', 'assignmentteammappings.teammember_id')
            ->leftJoin('teamrolehistory', function ($join) {
                $join->on('teamrolehistory.teammember_id', '=', 'assignmentteammappings.teammember_id')
                    ->on('teamrolehistory.created_at', '<', 'assignmentteammappings.created_at');
            })
            ->leftjoin('titles', 'titles.id', 'teammembers.title_id')
            ->leftjoin('roles', 'roles.id', 'teammembers.role_id')
            ->where('assignmentteammappings.viewerteam', 1)
            ->select(
                'teammembers.*',
                'roles.rolename',
                'assignmentteammappings.type',
                'titles.title',
                'assignmentteammappings.id As assignmentteammappingsId',
                'assignmentteammappings.status as assignmentteammappingsStatus',
                'assignmentmappings.assignmentgenerate_id as assignmentgenerateid',
                'assignmentteammappings.teamhour',
                'assignmentmappings.leadpartner',
                'teamrolehistory.newstaff_code',
                'assignmentbudgetings.assignmentname',
                'assignments.assignment_name',
                'assignmentteammappings.viewerteam'
            )
            ->get();

        // dd($assignmentviwerteams);

        return view('backEnd.assignmentviewer', compact('assignmentviwerteams'));
    }







22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\AttendanceController.php
 // Fetch single user data


        // Fetch single user data
        // $singleusersearched = DB::table('teammembers')
        //     ->where('id', $teamnid)
        //     ->select('team_member', 'staffcode', 'id', 'leavingdate', 'joining_date')
        //     ->first();

        $singleusersearched = DB::table('teammembers')
            ->where('teammembers.id', $teamnid)
            ->leftJoin(
                'teamrolehistory',
                'teamrolehistory.teammember_id',
                '=',
                'teammembers.id',
            )
            ->leftJoin(
                'rejoiningsamepost',
                'rejoiningsamepost.teammember_id',
                '=',
                'teammembers.id',
            )
            ->select([
                'teammembers.id',
                'teammembers.team_member',
                'teammembers.staffcode',
                'teammembers.joining_date',
                'teammembers.team_member',
                DB::raw(
                    'COALESCE(teamrolehistory.rejoiniedexitdate, rejoiningsamepost.rejoiniedexitdate, teammembers.leavingdate) AS final_leavingdate',
                ),
            ])
            ->first();

        // dd($singleusersearched);

        // Check leaving date validation
        if ($singleusersearched && $singleusersearched->final_leavingdate) {
            $final_leavingdate = Carbon::parse($singleusersearched->final_leavingdate);
            if ($startdate->gt($final_leavingdate)) {
                $output = ['msg' => 'User left on ' . $final_leavingdate->format('d-m-Y') . ', cannot select beyond this date.'];
                $request->flash();
                return redirect()->to('attendance')->with('statuss', $output);
            }
        }







22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\applyleave\adminopen.blade.php
 $permotioncheck = DB::table('teamrolehistory')

                                      @php
                                        $teamMembers = DB::table('teamrolehistory')
                                            ->whereIn('teammember_id', [
                                                $applyleaveDatas->createdby,
                                                $applyleaveDatas->approver,
                                            ])
                                            ->get()
                                            ->keyBy('teammember_id');

                                        $datadate = $applyleaveDatas->created_at
                                            ? Carbon\Carbon::createFromFormat(
                                                'Y-m-d H:i:s',
                                                $applyleaveDatas->created_at,
                                            )
                                            : null;

                                        $permotioncheck = $teamMembers[$applyleaveDatas->createdby] ?? null;
                                        $approverdata = $teamMembers[$applyleaveDatas->approver] ?? null;

                                        $permotiondate = $permotioncheck
                                            ? Carbon\Carbon::createFromFormat(
                                                'Y-m-d H:i:s',
                                                $permotioncheck->created_at,
                                            )
                                            : null;
                                        $approverdate = $approverdata
                                            ? Carbon\Carbon::createFromFormat('Y-m-d H:i:s', $approverdata->created_at)
                                            : null;
                                    @endphp
									
	




	

 {{ $applyleaveDatas->staffcode }}

					
	                                    <td>
                                        @if ($permotioncheck && $datadate && $datadate->greaterThan($permotiondate))
                                            {{ $permotioncheck->newstaff_code }}
                                        @else
                                            {{ $applyleaveDatas->staffcode }}
                                        @endif
                                    </td>								
									
	

	
									
				





				
 {{ App\Models\Teammember::select('team_member', 'staffcode')->where('id', $applyleaveDatas->approver)->first()->staffcode ?? '' }}									
									
									

                                    <td class="textfixed">
                                        {{ App\Models\Teammember::select('team_member')->where('id', $applyleaveDatas->approver)->first()->team_member ?? '' }}

                                    </td>
                                    <td>
                                        @if ($approverdata && $datadate && $datadate->greaterThan($approverdate))
                                            {{ $approverdata->newstaff_code }}
                                        @else
                                            {{ App\Models\Teammember::select('team_member', 'staffcode')->where('id', $applyleaveDatas->approver)->first()->staffcode ?? '' }}
                                        @endif
                                    </td>
									
									
									
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\applyleave\index.blade.php
 <td>{{ $applyleaveDatas->staffcode }}</td>
 

                                              <td> {{ $applyleaveDatas->newstaff_code ?? ($applyleaveDatas->staffcode ?? '') }}
                                              </td>
											  
											  
											  

22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\ApplyleaveController.php
index function 
 } else {
 
 
       $teamapplyleaveDatas  = DB::table('applyleaves')
        ->leftjoin('leavetypes', 'leavetypes.id', 'applyleaves.leavetype')
        ->leftjoin('teammembers', 'teammembers.id', 'applyleaves.createdby')
        ->leftJoin('teamrolehistory as teamrolehistoryteam', function ($join) {
          $join->on('teamrolehistoryteam.teammember_id', '=', 'applyleaves.createdby')
            ->on('teamrolehistoryteam.created_at', '<', 'applyleaves.created_at');
        })
        ->leftjoin('roles', 'roles.id', 'teammembers.role_id')
        ->where('applyleaves.approver', auth()->user()->teammember_id)
        ->select('applyleaves.*', 'teammembers.team_member', 'teammembers.staffcode', 'roles.rolename', 'leavetypes.name', 'teamrolehistoryteam.newstaff_code')->get();







index function 
 } elseif ($permotioncheck && auth()->user()->role_id == 13) {



      $teamapplyleaveDatas  = DB::table('applyleaves')
        ->leftjoin('leavetypes', 'leavetypes.id', 'applyleaves.leavetype')
        ->leftjoin('teammembers', 'teammembers.id', 'applyleaves.createdby')
        ->leftJoin('teamrolehistory as teamrolehistoryteam', function ($join) {
          $join->on('teamrolehistoryteam.teammember_id', '=', 'applyleaves.createdby')
            ->on('teamrolehistoryteam.created_at', '<', 'applyleaves.created_at');
        })
        ->leftjoin('roles', 'roles.id', 'teammembers.role_id')
        ->where('applyleaves.approver', auth()->user()->teammember_id)
        ->select('applyleaves.*', 'teammembers.team_member', 'teammembers.staffcode', 'roles.rolename', 'leavetypes.name', 'teamrolehistoryteam.newstaff_code')->get();





22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\applyleave\examrequestlist.blade.php
 @foreach ($timesheetrequestsDatas as $timesheetrequestsData)
 
                                         @php
                                                $teamMembers = DB::table('teamrolehistory')
                                                    ->whereIn('teammember_id', [
                                                        $timesheetrequestsData->createdby,
                                                        $timesheetrequestsData->approver,
                                                    ])
                                                    ->get()
                                                    ->keyBy('teammember_id');

                                                $datadate = $timesheetrequestsData->created_at
                                                    ? Carbon\Carbon::createFromFormat(
                                                        'Y-m-d H:i:s',
                                                        $timesheetrequestsData->created_at,
                                                    )
                                                    : null;

                                                $permotioncheck =
                                                    $teamMembers[$timesheetrequestsData->createdby] ?? null;
                                                $approverdata = $teamMembers[$timesheetrequestsData->approver] ?? null;

                                                $permotiondate = $permotioncheck
                                                    ? Carbon\Carbon::createFromFormat(
                                                        'Y-m-d H:i:s',
                                                        $permotioncheck->created_at,
                                                    )
                                                    : null;
                                                $approverdate = $approverdata
                                                    ? Carbon\Carbon::createFromFormat(
                                                        'Y-m-d H:i:s',
                                                        $approverdata->created_at,
                                                    )
                                                    : null;
                                            @endphp
											
										




										
 {{ $timesheetrequestsData->teamstaffcode }}
 
                                            <td>
                                                @if ($permotioncheck && $datadate && $datadate->greaterThan($permotiondate))
                                                    {{ $permotioncheck->newstaff_code }}
                                                @else
                                                    {{ $timesheetrequestsData->teamstaffcode }}
                                                @endif
                                            </td>



		


 {{ $timesheetrequestsData->staffcode }}
 
 
                                          <td>
                                                @if ($approverdata && $datadate && $datadate->greaterThan($approverdate))
                                                    {{ $approverdata->newstaff_code }}
                                                @else
                                                    {{ $timesheetrequestsData->staffcode }}
                                                @endif
                                            </td>



											

22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\applyleave\examrequestlist.blade.php
 @foreach ($myteamtimesheetrequestsDatas as $timesheetrequestsDatass)
                   
				   
                                            @php
                                                $teamMembers = DB::table('teamrolehistory')
                                                    ->whereIn('teammember_id', [
                                                        $timesheetrequestsDatass->createdby,
                                                        $timesheetrequestsDatass->approver,
                                                    ])
                                                    ->get()
                                                    ->keyBy('teammember_id');

                                                $datadate = $timesheetrequestsDatass->created_at
                                                    ? Carbon\Carbon::createFromFormat(
                                                        'Y-m-d H:i:s',
                                                        $timesheetrequestsDatass->created_at,
                                                    )
                                                    : null;

                                                $permotioncheck =
                                                    $teamMembers[$timesheetrequestsDatass->createdby] ?? null;
                                                $approverdata =
                                                    $teamMembers[$timesheetrequestsDatass->approver] ?? null;

                                                $permotiondate = $permotioncheck
                                                    ? Carbon\Carbon::createFromFormat(
                                                        'Y-m-d H:i:s',
                                                        $permotioncheck->created_at,
                                                    )
                                                    : null;
                                                $approverdate = $approverdata
                                                    ? Carbon\Carbon::createFromFormat(
                                                        'Y-m-d H:i:s',
                                                        $approverdata->created_at,
                                                    )
                                                    : null;
                                            @endphp






 {{ $timesheetrequestsDatass->teamstaffcode }}

                                            <td>
                                                @if ($permotioncheck && $datadate && $datadate->greaterThan($permotiondate))
                                                    {{ $permotioncheck->newstaff_code }}
                                                @else
                                                    {{ $timesheetrequestsDatass->teamstaffcode }}
                                                @endif
                                            </td>
											
											
			

			



{{ $timesheetrequestsDatass->staffcode }}

                                            <td>
                                                @if ($approverdata && $datadate && $datadate->greaterThan($approverdate))
                                                    {{ $approverdata->newstaff_code }}
                                                @else
                                                    {{ $timesheetrequestsDatass->staffcode }}
                                                @endif
                                            </td>										




22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\timesheetrequest\teamtimesheetrequest.blade.php
  @foreach ($teamtimesheetrequest as $timesheetrequestsData)
  
                                          @php
                                                $teamMembers = DB::table('teamrolehistory')
                                                    ->whereIn('teammember_id', [
                                                        $timesheetrequestsData->createdby,
                                                        $timesheetrequestsData->partner,
                                                    ])
                                                    ->get()
                                                    ->keyBy('teammember_id');

                                                $datadate = $timesheetrequestsData->created_at
                                                    ? Carbon\Carbon::createFromFormat(
                                                        'Y-m-d H:i:s',
                                                        $timesheetrequestsData->created_at,
                                                    )
                                                    : null;

                                                $permotioncheck =
                                                    $teamMembers[$timesheetrequestsData->createdby] ?? null;
                                                $approverdata = $teamMembers[$timesheetrequestsData->partner] ?? null;

                                                $permotiondate = $permotioncheck
                                                    ? Carbon\Carbon::createFromFormat(
                                                        'Y-m-d H:i:s',
                                                        $permotioncheck->created_at,
                                                    )
                                                    : null;
                                                $approverdate = $approverdata
                                                    ? Carbon\Carbon::createFromFormat(
                                                        'Y-m-d H:i:s',
                                                        $approverdata->created_at,
                                                    )
                                                    : null;
                                            @endphp
											
											
											
											
   {{ $timesheetrequestsData->staffcodeid }}
   
                                            <td>
                                                @if ($permotioncheck && $datadate && $datadate->greaterThan($permotiondate))
                                                    {{ $permotioncheck->newstaff_code }}
                                                @else
                                                    {{ $timesheetrequestsData->staffcodeid }}
                                                @endif
                                            </td>
											
											
											
											
	 {{ $timesheetrequestsData->staffcode }}										
											
                                            <td>
                                                @if ($approverdata && $datadate && $datadate->greaterThan($approverdate))
                                                    {{ $approverdata->newstaff_code }}
                                                @else
                                                    {{ $timesheetrequestsData->staffcode }}
                                                @endif
                                            </td>											
											







22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\TimesheetController.php
  public function timesheet_teamlist()
  
  
  if (auth()->user()->role_id == 13) {

    $get_datess = DB::table('timesheetreport')
        ->leftJoin('teammembers', 'teammembers.id', 'timesheetreport.teamid')
        ->leftJoin('teamrolehistory', function ($join) {
          $join->on('teamrolehistory.teammember_id', '=', 'teammembers.id')
            ->on('teamrolehistory.created_at', '<', 'timesheetreport.created_at');
        })
        ->leftJoin('teammembers as partners', 'partners.id', 'timesheetreport.partnerid')
        ->where('timesheetreport.partnerid', auth()->user()->teammember_id)
        ->whereColumn('timesheetreport.teamid', '!=', 'timesheetreport.partnerid')
        ->select('timesheetreport.*', 'teammembers.team_member', 'teammembers.staffcode', 'partners.team_member as partnername', 'teammembers.emailid', 'teamrolehistory.newstaff_code')
        ->latest()
        ->get();
		
		
		
		
		
and replace 

 return (object)[
        'id' => $firstItem->id,
        'teamid' => $firstItem->teamid,
        'emailid' => $firstItem->emailid,
        'week' => $firstItem->week,
        'totaldays' => $group->sum('totaldays'),
        'totaltime' => $group->sum('totaltime'),
        'startdate' => $firstItem->startdate,
        'enddate' => $firstItem->enddate,
        'partnername' => $firstItem->partnername,
        'created_at' => $firstItem->created_at,
        'team_member' => $firstItem->team_member,
        'partnerid' => $firstItem->partnerid,
        'staffcode' => $firstItem->newstaff_code ?? $firstItem->staffcode,
      ];
    });




22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\TimesheetController.php

public function filterDataAdmin(Request $request)
elseif (auth()->user()->role_id == 13 && $path == '/timesheet/teamlist') {



      $query = DB::table('timesheetreport')
        ->leftjoin('teammembers', 'teammembers.id', 'timesheetreport.teamid')
        ->leftJoin('teamrolehistory', function ($join) {
          $join->on('teamrolehistory.teammember_id', '=', 'teammembers.id')
            ->on('teamrolehistory.created_at', '<', 'timesheetreport.created_at');
        })
        ->leftjoin('teammembers as partners', 'partners.id', 'timesheetreport.partnerid')
        ->where('timesheetreport.partnerid', auth()->user()->teammember_id)
        // ->whereJsonContains('timesheetreport.partnerid', auth()->user()->teammember_id)
        ->select('timesheetreport.*', 'teammembers.team_member', 'partners.team_member as partnername', 'teammembers.staffcode', 'teamrolehistory.newstaff_code')
        ->orderBy('timesheetreport.startdate', 'desc');
		
		
		
		
		
		
and find 
  if (auth()->user()->role_id != 11) {
  
  
  
        return (object)[
          'id' => $firstItem->id,
          'teamid' => $firstItem->teamid,
          'week' => $firstItem->week,
          'totaldays' => $group->sum('totaldays'),
          'totaltime' => $group->sum('totaltime'),
          'startdate' => $firstItem->startdate,
          'enddate' => $firstItem->enddate,
          'partnername' => $firstItem->partnername,
          'created_at' => $firstItem->created_at,
          'team_member' => $firstItem->team_member,
          'staffcode' => $firstItem->newstaff_code ?? $firstItem->staffcode,
          'partnerid' => $firstItem->partnerid,
        ];
      });



22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\TimesheetController.php

  public function filterDataAdmin(Request $request)
  {
    $urlheader = $request->headers->get('referer');
    $url = parse_url($urlheader);
    $path = $url['path'];
    // dd($url);
    // this is for patner submitted timesheet 
    if (auth()->user()->role_id == 13 && $path == '/timesheet/partnersubmitted') {
      // dd('patner');
      $teamname = $request->input('teamname');
      $start = $request->input('start');
      $end = $request->input('end');
      $totalhours = $request->input('totalhours');
      $partnerId = $request->input('partnersearch');


      $query = DB::table('timesheetreport')
        ->leftjoin('teammembers', 'teammembers.id', 'timesheetreport.teamid')
        ->leftJoin('teamrolehistory', function ($join) {
          $join->on('teamrolehistory.teammember_id', '=', 'teammembers.id')
            ->on('teamrolehistory.created_at', '<', 'timesheetreport.created_at');
        })
        ->leftjoin('teammembers as partners', 'partners.id', 'timesheetreport.partnerid')
        ->where('timesheetreport.teamid', auth()->user()->teammember_id)
        ->select('timesheetreport.*', 'teammembers.team_member', 'partners.team_member as partnername', 'teammembers.staffcode', 'teamrolehistory.newstaff_code')
        ->latest();

      // teamname with othser field to  filter
      if ($teamname) {
        $query->where('timesheetreport.teamid', $teamname);
      }

      if ($teamname && $totalhours) {
        $query->where(function ($q) use ($teamname, $totalhours) {
          $q->where('timesheetreport.teamid', $teamname)
            ->where('timesheetreport.totaltime', $totalhours);
        });
      }
      if ($teamname && $partnerId) {
        $query->where(function ($q) use ($teamname, $partnerId) {
          $q->where('timesheetreport.teamid', $teamname)
            ->where('timesheetreport.partnerid', $partnerId);
        });
      }

      // patner or othse one data
      if ($partnerId) {
        $query->where('timesheetreport.partnerid', $partnerId);
      }

      if ($partnerId && $totalhours) {
        $query->where(function ($q) use ($partnerId, $totalhours) {
          $q->where('timesheetreport.partnerid', $partnerId)
            ->where('timesheetreport.totaltime', $totalhours);
        });
      }

      // total hour wise  wise or othser data
      if ($totalhours) {
        $query->where('timesheetreport.totaltime', $totalhours);
      }
      //! end date 
      if ($start && $end) {
        $query->where(function ($query) use ($start, $end) {
          $query->whereBetween('timesheetreport.startdate', [$start, $end])
            ->orWhereBetween('timesheetreport.enddate', [$start, $end])
            ->orWhere(function ($query) use ($start, $end) {
              $query->where('timesheetreport.startdate', '<=', $start)
                ->where('timesheetreport.enddate', '>=', $end);
            });
        });
      }
    }
    // this is for team submitted timesheet on patner
    elseif (auth()->user()->role_id == 13 && $path == '/timesheet/teamlist') {
      // dd($request);
      // dd('team');
      $teamname = $request->input('teamname');
      $start = $request->input('start');
      $end = $request->input('end');
      $totalhours = $request->input('totalhours');
      $partnerId = $request->input('partnersearch');


      $query = DB::table('timesheetreport')
        ->leftjoin('teammembers', 'teammembers.id', 'timesheetreport.teamid')
        ->leftJoin('teamrolehistory', function ($join) {
          $join->on('teamrolehistory.teammember_id', '=', 'teammembers.id')
            ->on('teamrolehistory.created_at', '<', 'timesheetreport.created_at');
        })
        ->leftjoin('teammembers as partners', 'partners.id', 'timesheetreport.partnerid')
        ->where('timesheetreport.partnerid', auth()->user()->teammember_id)
        // ->whereJsonContains('timesheetreport.partnerid', auth()->user()->teammember_id)
        ->select('timesheetreport.*', 'teammembers.team_member', 'partners.team_member as partnername', 'teammembers.staffcode', 'teamrolehistory.newstaff_code')
        ->orderBy('timesheetreport.startdate', 'desc');



      // teamname with othser field to  filter
      if ($teamname) {
        $query->where('timesheetreport.teamid', $teamname);
      }

      if ($teamname && $totalhours) {
        $query->where(function ($q) use ($teamname, $totalhours) {
          $q->where('timesheetreport.teamid', $teamname)
            ->where('timesheetreport.totaltime', $totalhours);
        });
      }
      if ($teamname && $partnerId) {
        $query->where(function ($q) use ($teamname, $partnerId) {
          $q->where('timesheetreport.teamid', $teamname)
            ->where('timesheetreport.partnerid', $partnerId);
        });
      }

      // patner or othse one data
      if ($partnerId) {
        $query->where('timesheetreport.partnerid', $partnerId);
      }

      if ($partnerId && $totalhours) {
        $query->where(function ($q) use ($partnerId, $totalhours) {
          $q->where('timesheetreport.partnerid', $partnerId)
            ->where('timesheetreport.totaltime', $totalhours);
        });
      }

      // total hour wise  wise or othser data
      if ($totalhours) {
        $query->where('timesheetreport.totaltime', $totalhours);
      }
      //! end date 
      if ($start && $end) {
        $query->where(function ($query) use ($start, $end) {
          $query->whereBetween('timesheetreport.startdate', [$start, $end])
            ->orWhereBetween('timesheetreport.enddate', [$start, $end])
            ->orWhere(function ($query) use ($start, $end) {
              $query->where('timesheetreport.startdate', '<=', $start)
                ->where('timesheetreport.enddate', '>=', $end);
            });
        });
      }
    }
    // this is for submitted timesheet on staff and manager 
    elseif (auth()->user()->role_id == 14 || auth()->user()->role_id == 15) {
      // dd($request);
      $teamname = $request->input('teamname');
      $start = $request->input('start');
      $end = $request->input('end');
      $totalhours = $request->input('totalhours');
      $partnerId = $request->input('partnersearch');


      $query = DB::table('timesheetreport')
        ->leftjoin('teammembers', 'teammembers.id', 'timesheetreport.teamid')
        ->leftJoin('teamrolehistory', function ($join) {
          $join->on('teamrolehistory.teammember_id', '=', 'teammembers.id')
            ->on('teamrolehistory.created_at', '<', 'timesheetreport.created_at');
        })
        ->leftjoin('teammembers as partners', 'partners.id', 'timesheetreport.partnerid')
        ->where('timesheetreport.teamid', auth()->user()->teammember_id)
        ->select('timesheetreport.*', 'teammembers.team_member', 'partners.team_member as partnername', 'teammembers.staffcode', 'teamrolehistory.newstaff_code')
        ->latest();

      // teamname with othser field to  filter
      if ($teamname) {
        $query->where('timesheetreport.teamid', $teamname);
      }

      if ($teamname && $totalhours) {
        $query->where(function ($q) use ($teamname, $totalhours) {
          $q->where('timesheetreport.teamid', $teamname)
            ->where('timesheetreport.totaltime', $totalhours);
        });
      }
      if ($teamname && $partnerId) {
        $query->where(function ($q) use ($teamname, $partnerId) {
          $q->where('timesheetreport.teamid', $teamname)
            ->where('timesheetreport.partnerid', $partnerId);
        });
      }

      // patner or othse one data
      if ($partnerId) {
        $query->where('timesheetreport.partnerid', $partnerId);
      }

      if ($partnerId && $totalhours) {
        $query->where(function ($q) use ($partnerId, $totalhours) {
          $q->where('timesheetreport.partnerid', $partnerId)
            ->where('timesheetreport.totaltime', $totalhours);
        });
      }

      // total hour wise  wise or othser data
      if ($totalhours) {
        $query->where('timesheetreport.totaltime', $totalhours);
      }
      //! end date 
      if ($start && $end) {
        $query->where(function ($query) use ($start, $end) {
          $query->whereBetween('timesheetreport.startdate', [$start, $end])
            ->orWhereBetween('timesheetreport.enddate', [$start, $end])
            ->orWhere(function ($query) use ($start, $end) {
              $query->where('timesheetreport.startdate', '<=', $start)
                ->where('timesheetreport.enddate', '>=', $end);
            });
        });
      }
    }
    // this is for team submitted timesheet on Admin
    else {
      // dd(auth()->user()->role_id);
      $teamname = $request->input('teamname');
      $start = $request->input('start');
      $end = $request->input('end');
      $totalhours = $request->input('totalhours');
      $partnerId = $request->input('partnersearch');

      $query = DB::table('timesheetreport')
        ->leftjoin('teammembers', 'teammembers.id', 'timesheetreport.teamid')
        ->leftJoin('teamrolehistory', function ($join) {
          $join->on('teamrolehistory.teammember_id', '=', 'teammembers.id')
            ->on('teamrolehistory.created_at', '<', 'timesheetreport.created_at');
        })
        ->leftjoin('teammembers as partners', 'partners.id', 'timesheetreport.partnerid')
        ->select('timesheetreport.*', 'teammembers.team_member', 'partners.team_member as partnername', 'teammembers.staffcode', 'teamrolehistory.newstaff_code')
        ->orderBy('timesheetreport.startdate', 'desc');

      // teamname with othser field to  filter
      if ($teamname) {
        $query->where('timesheetreport.teamid', $teamname);
      }

      if ($teamname && $totalhours) {
        $query->where(function ($q) use ($teamname, $totalhours) {
          $q->where('timesheetreport.teamid', $teamname)
            ->where('timesheetreport.totaltime', $totalhours);
        });
      }
      if ($teamname && $partnerId) {
        $query->where(function ($q) use ($teamname, $partnerId) {
          $q->where('timesheetreport.teamid', $teamname)
            ->where('timesheetreport.partnerid', $partnerId);
        });
      }

      // patner or othse one data
      if ($partnerId) {
        $query->where('timesheetreport.partnerid', $partnerId);
      }

      if ($partnerId && $totalhours) {
        $query->where(function ($q) use ($partnerId, $totalhours) {
          $q->where('timesheetreport.partnerid', $partnerId)
            ->where('timesheetreport.totaltime', $totalhours);
        });
      }

      // total hour wise  wise or othser data
      if ($totalhours) {
        $query->where('timesheetreport.totaltime', $totalhours);
      }
      //! end date 
      if ($start && $end) {
        $query->where(function ($query) use ($start, $end) {
          $query->whereBetween('timesheetreport.startdate', [$start, $end])
            ->orWhereBetween('timesheetreport.enddate', [$start, $end])
            ->orWhere(function ($query) use ($start, $end) {
              $query->where('timesheetreport.startdate', '<=', $start)
                ->where('timesheetreport.enddate', '>=', $end);
            });
        });
      }

      $filteredDataaa = $query->get();

      // maping double date ************
      $groupedData = $filteredDataaa->groupBy(function ($item) {
        return $item->team_member . '|' . $item->week;
      })->map(function ($group) {
        $firstItem = $group->first();

        return (object)[
          'id' => $firstItem->id,
          'teamid' => $firstItem->teamid,
          'week' => $firstItem->week,
          'totaldays' => $group->sum('totaldays'),
          'totaltime' => $group->sum('totaltime'),
          'dayscount' => $group->sum('dayscount'),
          'startdate' => $firstItem->startdate,
          'enddate' => $firstItem->enddate,
          'partnername' => $firstItem->partnername,
          'created_at' => $firstItem->created_at,
          'team_member' => $firstItem->team_member,
          'staffcode' => $firstItem->newstaff_code ?? $firstItem->staffcode,
          'partnerid' => $firstItem->partnerid,
        ];
      });

      $filteredData = collect($groupedData->values());
      // dd($filteredData);
      return response()->json($filteredData);
    }

    if (auth()->user()->role_id != 11) {
      $filteredDataaa = $query->get();

      // maping double date ************
      $groupedData = $filteredDataaa->groupBy(function ($item) {
        return $item->team_member . '|' . $item->week;
      })->map(function ($group) {
        $firstItem = $group->first();

        return (object)[
          'id' => $firstItem->id,
          'teamid' => $firstItem->teamid,
          'week' => $firstItem->week,
          'totaldays' => $group->sum('totaldays'),
          'totaltime' => $group->sum('totaltime'),
          'startdate' => $firstItem->startdate,
          'enddate' => $firstItem->enddate,
          'partnername' => $firstItem->partnername,
          'created_at' => $firstItem->created_at,
          'team_member' => $firstItem->team_member,
          'staffcode' => $firstItem->newstaff_code ?? $firstItem->staffcode,
          'partnerid' => $firstItem->partnerid,
        ];
      });

      $filteredData = collect($groupedData->values());
      return response()->json($filteredData);
    }
  }






22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\TimesheetController.php

  public function weeklylist(Request $request)
  {
    // dd($request);
    if (auth()->user()->role_id == 13) {

      $date = DB::table('timesheetreport')->where('id', $request->id)->first();
      // $timesheetData = DB::table('timesheetusers')
      //   ->leftjoin('teammembers', 'teammembers.id', 'timesheetusers.createdby')
      //   ->where('timesheetusers.createdby', $request->teamid)
      //   ->whereIn('timesheetusers.status', [1, 2, 3])
      //   ->where('timesheetusers.date', '>=', $date->startdate)
      //   ->where('timesheetusers.date', '<=', $date->enddate)
      //   ->leftjoin('clients', 'clients.id', 'timesheetusers.client_id')
      //   ->leftjoin('assignments', 'assignments.id', 'timesheetusers.assignment_id')
      //   ->leftjoin('teammembers as patnerid', 'patnerid.id', 'timesheetusers.partner')
      //   ->leftJoin('teamrolehistory', 'teamrolehistory.teammember_id', '=', 'patnerid.id')
      //   ->leftjoin('assignmentbudgetings', 'assignmentbudgetings.assignmentgenerate_id', 'timesheetusers.assignmentgenerate_id')
      //   // ->select('timesheetusers.*', 'assignments.assignment_name', 'clients.client_name', 'teammembers.team_member', 'teammembers.staffcode', 'patnerid.team_member as patnername', 'assignmentbudgetings.assignmentname')
      //   ->select('timesheetusers.*', 'assignments.assignment_name', 'clients.client_name', 'clients.client_code', 'teammembers.team_member', 'teammembers.staffcode', 'patnerid.team_member as patnername', 'patnerid.staffcode as patnerstaffcodee', 'assignmentbudgetings.assignmentname', 'teamrolehistory.newstaff_code', 'assignmentbudgetings.created_at as assignmentcreated')
      //   ->orderBy('id', 'ASC')
      //   //   ->orderBy('date', 'DESC')
      //   ->get();

      $timesheetData = DB::table('timesheetusers')
        ->leftjoin('teammembers', 'teammembers.id', 'timesheetusers.createdby')
        ->leftjoin('assignmentbudgetings', 'assignmentbudgetings.assignmentgenerate_id', 'timesheetusers.assignmentgenerate_id')
        ->leftJoin('teamrolehistory as teamrolehistoryteam', function ($join) {
          $join->on('teamrolehistoryteam.teammember_id', '=', 'teammembers.id')
            ->whereRaw('teamrolehistoryteam.created_at < assignmentbudgetings.created_at');
        })
        ->where('timesheetusers.createdby', $request->teamid)
        ->whereIn('timesheetusers.status', [1, 2, 3])
        ->where('timesheetusers.date', '>=', $date->startdate)
        ->where('timesheetusers.date', '<=', $date->enddate)
        ->leftjoin('clients', 'clients.id', 'timesheetusers.client_id')
        ->leftjoin('assignments', 'assignments.id', 'timesheetusers.assignment_id')
        ->leftjoin('teammembers as patnerid', 'patnerid.id', 'timesheetusers.partner')
        ->leftJoin('teamrolehistory', function ($join) {
          $join->on('teamrolehistory.teammember_id', '=', 'patnerid.id')
            ->whereRaw('teamrolehistory.created_at < assignmentbudgetings.created_at');
        })
        ->select(
          'timesheetusers.*',
          'assignments.assignment_name',
          'clients.client_name',
          'clients.client_code',
          'teammembers.team_member',
          'teammembers.staffcode',
          'patnerid.team_member as patnername',
          'patnerid.staffcode as patnerstaffcodee',
          'assignmentbudgetings.assignmentname',
          'teamrolehistory.newstaff_code as ptnrstaffcode',
          'teamrolehistoryteam.newstaff_code as teamnewstaffcode',
          'assignmentbudgetings.created_at as assignmentcreated'
        )
        ->orderBy('timesheetusers.id', 'ASC')
        ->get();
    } else {
      $date = DB::table('timesheetreport')->where('id', $request->id)->first();
      // $timesheetData = DB::table('timesheetusers')
      //   ->leftjoin('teammembers', 'teammembers.id', 'timesheetusers.createdby')
      //   ->where('timesheetusers.createdby', $request->teamid)
      //   ->whereIn('timesheetusers.status', [1, 2, 3])
      //   ->where('timesheetusers.date', '>=', $date->startdate)
      //   ->where('timesheetusers.date', '<=', $date->enddate)
      //   ->leftjoin('clients', 'clients.id', 'timesheetusers.client_id')
      //   ->leftjoin('assignments', 'assignments.id', 'timesheetusers.assignment_id')
      //   ->leftjoin('teammembers as patnerid', 'patnerid.id', 'timesheetusers.partner')
      //   ->leftJoin('teamrolehistory', 'teamrolehistory.teammember_id', '=', 'patnerid.id')
      //   ->leftjoin('assignmentbudgetings', 'assignmentbudgetings.assignmentgenerate_id', 'timesheetusers.assignmentgenerate_id')
      //   ->select('timesheetusers.*', 'assignments.assignment_name', 'clients.client_name', 'clients.client_code', 'teammembers.team_member', 'teammembers.staffcode', 'patnerid.team_member as patnername', 'patnerid.staffcode as patnerstaffcodee', 'assignmentbudgetings.assignmentname', 'teamrolehistory.newstaff_code', 'assignmentbudgetings.created_at as assignmentcreated')
      //   ->orderBy('id', 'ASC')
      //   ->get();
      $timesheetData = DB::table('timesheetusers')
        ->leftJoin('teammembers', 'teammembers.id', '=', 'timesheetusers.createdby')
        ->leftJoin('assignmentbudgetings', 'assignmentbudgetings.assignmentgenerate_id', '=', 'timesheetusers.assignmentgenerate_id') // Move this join up
        ->leftJoin('teamrolehistory as teamrolehistoryteam', function ($join) {
          $join->on('teamrolehistoryteam.teammember_id', '=', 'teammembers.id')
            ->whereRaw('teamrolehistoryteam.created_at < assignmentbudgetings.created_at');
        })
        ->where('timesheetusers.createdby', $request->teamid)
        ->whereIn('timesheetusers.status', [1, 2, 3])
        ->whereBetween('timesheetusers.date', [$date->startdate, $date->enddate])
        ->leftJoin('clients', 'clients.id', '=', 'timesheetusers.client_id')
        ->leftJoin('assignments', 'assignments.id', '=', 'timesheetusers.assignment_id')
        ->leftJoin('teammembers as patnerid', 'patnerid.id', '=', 'timesheetusers.partner')
        ->leftJoin('teamrolehistory', function ($join) {
          $join->on('teamrolehistory.teammember_id', '=', 'patnerid.id')
            ->whereRaw('teamrolehistory.created_at < assignmentbudgetings.created_at');
        })
        ->select(
          'timesheetusers.*',
          'assignments.assignment_name',
          'clients.client_name',
          'clients.client_code',
          'teammembers.team_member',
          'teammembers.staffcode',
          'patnerid.team_member as patnername',
          'patnerid.staffcode as patnerstaffcodee',
          'assignmentbudgetings.assignmentname',
          'teamrolehistory.newstaff_code as ptnrstaffcode',
          'teamrolehistoryteam.newstaff_code as teamnewstaffcode',
          'assignmentbudgetings.created_at as assignmentcreated'
        )
        ->orderBy('timesheetusers.id', 'ASC')
        ->get();
    }
    return view('backEnd.timesheet.weeklylist', compact('timesheetData'));
  }



22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\timesheet\rejectedlistteam.blade.php
@foreach ($timesheetData as $timesheetDatas)
 $dates = date('l', strtotime($timesheetDatas->date));



                                     $dates = date('l', strtotime($timesheetDatas->date));

                                        $assignmentcheck = DB::table('assignmentbudgetings')
                                            ->where('assignmentgenerate_id', $timesheetDatas->assignmentgenerate_id)
                                            ->first();

                                        $teamMembers = DB::table('teamrolehistory')
                                            ->whereIn('teammember_id', [
                                                $timesheetDatas->createdby,
                                                $timesheetDatas->partner,
                                            ])
                                            ->get()
                                            ->keyBy('teammember_id');

                                        $datadate = $assignmentcheck
                                            ? Carbon\Carbon::createFromFormat(
                                                'Y-m-d H:i:s',
                                                $assignmentcheck->created_at,
                                            )
                                            : null;

                                        // dd($teamMembers);

                                        $permotioncheck = $teamMembers[$timesheetDatas->createdby] ?? null;
                                        $approverdata = $teamMembers[$timesheetDatas->partner] ?? null;

                                        $permotiondate = $permotioncheck
                                            ? Carbon\Carbon::createFromFormat(
                                                'Y-m-d H:i:s',
                                                $permotioncheck->created_at,
                                            )
                                            : null;
                                        $approverdate = $approverdata
                                            ? Carbon\Carbon::createFromFormat('Y-m-d H:i:s', $approverdata->created_at)
                                            : null;
                                    @endphp


                                    <td>
                                        @if ($permotioncheck && $datadate && $datadate->greaterThan($permotiondate))
                                            {{ $permotioncheck->newstaff_code }}
                                        @else
                                            {{ $timesheetDatas->staffcode }}
                                        @endif
                                    </td>






                                        <td>
                                            @foreach ($client_id as $item)
                                                @if ($approverdata && $datadate && $datadate->greaterThan($approverdate))
                                                    {{ $approverdata->newstaff_code }}
                                                @else
                                                    {{ $item->staffcode ?? '' }}
                                                @endif
                                                @if ($item->staffcode != null)
                                                    ,
                                                @endif
                                            @endforeach
                                        </td>
										


										


22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\applyleave\openindex.blade.php
       @foreach ($teamapplyleaveDatas as $applyleaveDatas)
	   
	  after tr add this code

                                     @php
                                              $teamMembers = DB::table('teamrolehistory')
                                                  ->whereIn('teammember_id', [
                                                      $applyleaveDatas->createdby,
                                                      $applyleaveDatas->approver,
                                                  ])
                                                  ->get()
                                                  ->keyBy('teammember_id');

                                              $datadate = $applyleaveDatas->created_at
                                                  ? Carbon\Carbon::createFromFormat(
                                                      'Y-m-d H:i:s',
                                                      $applyleaveDatas->created_at,
                                                  )
                                                  : null;

                                              $permotioncheck = $teamMembers[$applyleaveDatas->createdby] ?? null;
                                              $approverdata = $teamMembers[$applyleaveDatas->approver] ?? null;

                                              $permotiondate = $permotioncheck
                                                  ? Carbon\Carbon::createFromFormat(
                                                      'Y-m-d H:i:s',
                                                      $permotioncheck->created_at,
                                                  )
                                                  : null;
                                              $approverdate = $approverdata
                                                  ? Carbon\Carbon::createFromFormat(
                                                      'Y-m-d H:i:s',
                                                      $approverdata->created_at,
                                                  )
                                                  : null;
                                          @endphp





 {{ $applyleaveDatas->staffcode ?? '' }}

                                          <td>
                                              @if ($permotioncheck && $datadate && $datadate->greaterThan($permotiondate))
                                                  {{ $permotioncheck->newstaff_code }}
                                              @else
                                                  {{ $applyleaveDatas->staffcode ?? '' }}
                                              @endif
                                          </td>




22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\timesheetrequest\teamtimesheetrequest.blade.php
@foreach ($mytimesheetrequest as $timesheetrequestsData)
                                   
								   
                                                @php
                                                    $teamMembers = DB::table('teamrolehistory')
                                                        ->whereIn('teammember_id', [
                                                            $timesheetrequestsData->createdby,
                                                            $timesheetrequestsData->partner,
                                                        ])
                                                        ->get()
                                                        ->keyBy('teammember_id');

                                                    $datadate = $timesheetrequestsData->created_at
                                                        ? Carbon\Carbon::createFromFormat(
                                                            'Y-m-d H:i:s',
                                                            $timesheetrequestsData->created_at,
                                                        )
                                                        : null;

                                                    $permotioncheck =
                                                        $teamMembers[$timesheetrequestsData->createdby] ?? null;
                                                    $approverdata =
                                                        $teamMembers[$timesheetrequestsData->partner] ?? null;

                                                    $permotiondate = $permotioncheck
                                                        ? Carbon\Carbon::createFromFormat(
                                                            'Y-m-d H:i:s',
                                                            $permotioncheck->created_at,
                                                        )
                                                        : null;
                                                    $approverdate = $approverdata
                                                        ? Carbon\Carbon::createFromFormat(
                                                            'Y-m-d H:i:s',
                                                            $approverdata->created_at,
                                                        )
                                                        : null;
                                                @endphp
												
											

											
												
	  {{ $timesheetrequestsData->staffcodeid }}
	  
				                                 <td>
                                                    @if ($permotioncheck && $datadate && $datadate->greaterThan($permotiondate))
                                                        {{ $permotioncheck->newstaff_code }}
                                                    @else
                                                        {{ $timesheetrequestsData->staffcodeid }}
                                                    @endif
                                                </td>								
												

 {{ $timesheetrequestsData->staffcode }}
 
 
                                          <td>
                                                    @if ($approverdata && $datadate && $datadate->greaterThan($approverdate))
                                                        {{ $approverdata->newstaff_code }}
                                                    @else
                                                        {{ $timesheetrequestsData->staffcode }}
                                                    @endif
                                                </td>
	
	
	
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\timesheet\index.blade.php
  @foreach ($timesheetData as $timesheetDatas)
                      
                                        @php
                                            $timeid = DB::table('timesheetusers')
                                                ->where('timesheetusers.id', $timesheetDatas->id)
                                                ->first();

                                            // $client_id = DB::table('timesheetusers')
                                            //     ->leftjoin('clients', 'clients.id', 'timesheetusers.client_id')
                                            //     ->leftjoin(
                                            //         'assignmentbudgetings',
                                            //         'assignmentbudgetings.assignment_id',
                                            //         'timesheetusers.assignment_id',
                                            //     )
                                            //     ->leftjoin(
                                            //         'assignments',
                                            //         'assignments.id',
                                            //         'timesheetusers.assignment_id',
                                            //     )
                                            //     ->leftjoin('teammembers', 'teammembers.id', 'timesheetusers.partner')
                                            //     ->leftJoin('teamrolehistory', function ($join) {
                                            //         $join
                                            //             ->on('teamrolehistory.teammember_id', '=', 'teammembers.id')
                                            //             ->on(
                                            //                 'teamrolehistory.created_at',
                                            //                 '<',
                                            //                 'timesheetusers.created_at',
                                            //             );
                                            //     })
                                            //     ->where('timesheetusers.id', $timesheetDatas->id)
                                            //     ->select(
                                            //         'clients.client_name',
                                            //         'clients.client_code',
                                            //         'timesheetusers.hour',
                                            //         'timesheetusers.location',
                                            //         'timesheetusers.status',
                                            //         'assignments.assignment_name',
                                            //         'billable_status',
                                            //         'workitem',
                                            //         'teammembers.team_member',
                                            //         'teammembers.staffcode',
                                            //         'teamrolehistory.newstaff_code',
                                            //         'assignmentbudgetings.assignmentname',
                                            //         'assignmentbudgetings.assignmentgenerate_id',
                                            //     )
                                            //     ->first();

                                            $client_id = DB::table('timesheetusers')
                                                ->leftjoin('clients', 'clients.id', 'timesheetusers.client_id')
                                                ->leftjoin(
                                                    'assignmentbudgetings',
                                                    'assignmentbudgetings.assignment_id',
                                                    'timesheetusers.assignment_id',
                                                )
                                                ->leftjoin(
                                                    'assignments',
                                                    'assignments.id',
                                                    'timesheetusers.assignment_id',
                                                )
                                                ->leftjoin('teammembers', 'teammembers.id', 'timesheetusers.partner')
                                                ->where('timesheetusers.id', $timesheetDatas->id)
                                                ->select(
                                                    'clients.client_name',
                                                    'clients.client_code',
                                                    'timesheetusers.hour',
                                                    'timesheetusers.location',
                                                    'timesheetusers.status',
                                                    'assignments.assignment_name',
                                                    'billable_status',
                                                    'workitem',
                                                    'teammembers.team_member',
                                                    'teammembers.staffcode',
                                                    'assignmentbudgetings.assignmentname',
                                                )
                                                ->first();

                                            $total = DB::table('timesheetusers')

                                                ->where('timesheetusers.timesheetid', $timesheetDatas->timesheetid)
                                                ->sum('hour');
                                            //	dd($total);
                                            $dates = date('l', strtotime($timesheetDatas->date));

                                            $teamMembers = DB::table('teamrolehistory')
                                                ->whereIn('teammember_id', [
                                                    $timesheetDatas->createdby,
                                                    $timesheetDatas->partner,
                                                ])
                                                ->get()
                                                ->keyBy('teammember_id');

                                            $datadate = $timesheetDatas->assignmentcreated
                                                ? Carbon\Carbon::createFromFormat(
                                                    'Y-m-d H:i:s',
                                                    $timesheetDatas->assignmentcreated,
                                                )
                                                : null;

                                            $permotioncheck = $teamMembers[$timesheetDatas->createdby] ?? null;
                                            $approverdata = $teamMembers[$timesheetDatas->partner] ?? null;

                                            $permotiondate = $permotioncheck
                                                ? Carbon\Carbon::createFromFormat(
                                                    'Y-m-d H:i:s',
                                                    $permotioncheck->created_at,
                                                )
                                                : null;
                                            $approverdate = $approverdata
                                                ? Carbon\Carbon::createFromFormat(
                                                    'Y-m-d H:i:s',
                                                    $approverdata->created_at,
                                                )
                                                : null;

                                        @endphp






                                        <td>
                                            @if ($approverdata && $datadate && $datadate->greaterThan($approverdate))
                                                {{ $approverdata->newstaff_code }}
                                            @else
                                                {{ $client_id->staffcode ?? '' }}
                                            @endif
                                            @if (count((array) $client_id->team_member) > 1)
                                                ,
                                            @endif
                                        </td>
	




	
										
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\TimesheetController.php

  public function timesheet_teamlist()
  {

    if (auth()->user()->role_id == 13) {
      $partner = Teammember::where('role_id', '=', 13)->where('status', '=', 1)->with('title')
        ->orderBy('team_member', 'asc')->get();

      // $get_datess = DB::table('timesheetreport')
      //   ->leftjoin('teammembers', 'teammembers.id', 'timesheetreport.teamid')
      //   ->leftjoin('teammembers as partners', 'partners.id', 'timesheetreport.partnerid')
      //   ->where('timesheetreport.partnerid', auth()->user()->teammember_id)
      //   // ->whereJsonContains('timesheetreport.partnerid', auth()->user()->teammember_id)
      //   ->select('timesheetreport.*', 'teammembers.team_member', 'teammembers.staffcode', 'partners.team_member as partnername')
      //   ->latest()->get();

      $get_datess = DB::table('timesheetreport')
        ->leftJoin('teammembers', 'teammembers.id', 'timesheetreport.teamid')
        ->leftJoin('teamrolehistory', function ($join) {
          $join->on('teamrolehistory.teammember_id', '=', 'teammembers.id')
            ->on('teamrolehistory.created_at', '<', 'timesheetreport.created_at');
        })
        ->leftJoin('teammembers as partners', 'partners.id', 'timesheetreport.partnerid')
        ->where('timesheetreport.partnerid', auth()->user()->teammember_id)
        ->whereColumn('timesheetreport.teamid', '!=', 'timesheetreport.partnerid')
        ->select('timesheetreport.*', 'teammembers.team_member', 'teammembers.staffcode', 'partners.team_member as partnername', 'teammembers.emailid', 'teamrolehistory.newstaff_code')
        ->latest()
        ->get();

      // For permission
      $permissiontimesheet = DB::table('timesheetreport')
        ->where('timesheetreport.teamid', auth()->user()->teammember_id)
        ->first();
      // dd($get_datess);
    } else {

      $partner = Teammember::where('role_id', '=', 13)->where('status', '=', 1)->with('title')
        ->orderBy('team_member', 'asc')->get();
      $get_datess = DB::table('timesheetreport')
        ->leftjoin('teammembers', 'teammembers.id', 'timesheetreport.teamid')
        ->leftJoin('teamrolehistory', function ($join) {
          $join->on('teamrolehistory.teammember_id', '=', 'teammembers.id')
            ->on('teamrolehistory.created_at', '<', 'timesheetreport.created_at');
        })
        ->leftjoin('teammembers as partners', 'partners.id', 'timesheetreport.partnerid')
        ->where('timesheetreport.teamid', auth()->user()->teammember_id)
        // ->select('timesheetreport.*', 'teammembers.team_member', 'teammembers.staffcode', 'partners.team_member as partnername')
        ->select('timesheetreport.*', 'teammembers.team_member', 'teammembers.staffcode', 'partners.team_member as partnername', 'teammembers.emailid', 'teamrolehistory.newstaff_code')
        ->latest()->get();

      // For permission working 
      $permissiontimesheet = DB::table('timesheetreport')
        ->where('timesheetreport.teamid', auth()->user()->teammember_id)
        ->first();
    }


    $groupedData = $get_datess->groupBy(function ($item) {
      return $item->team_member . '|' . $item->week;
    })->map(function ($group) {
      $firstItem = $group->first();

      return (object)[
        'id' => $firstItem->id,
        'teamid' => $firstItem->teamid,
        'emailid' => $firstItem->emailid,
        'week' => $firstItem->week,
        'totaldays' => $group->sum('totaldays'),
        'totaltime' => $group->sum('totaltime'),
        'startdate' => $firstItem->startdate,
        'enddate' => $firstItem->enddate,
        'partnername' => $firstItem->partnername,
        'created_at' => $firstItem->created_at,
        'team_member' => $firstItem->team_member,
        'partnerid' => $firstItem->partnerid,
        'staffcode' => $firstItem->newstaff_code ?? $firstItem->staffcode,
      ];
    });

    $get_date = collect($groupedData->values());
    return view('backEnd.timesheet.myteamindex', compact('get_date', 'partner', 'permissiontimesheet'));
  }



22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\timesheet\weeklylist.blade.php
                            @foreach ($timesheetData as $timesheetDatas)
                                <tr>
                                    <td style="display: none;">{{ $timesheetDatas->id }}</td>
                                    <td class="textfixed"> {{ $timesheetDatas->team_member ?? '' }} </td>
                                    <td>{{ $timesheetDatas->teamnewstaffcode ?? ($timesheetDatas->staffcode ?? '') }}</td>
                                    <td class="textfixed"> <span style="display: none;">
                                            {{ date('Y-m-d', strtotime($timesheetDatas->date)) }}</span>{{ date('d-m-Y', strtotime($timesheetDatas->date)) }}
                                    </td>
                                    <td class="textfixed">
                                        @if ($timesheetDatas->date != null)
                                            {{ date('l', strtotime($timesheetDatas->date)) }}
                                        @endif
                                    </td>
                                    <td class="textfixed">{{ $timesheetDatas->client_name ?? '' }}
                                    </td>
                                    <td> {{ $timesheetDatas->client_code ?? '' }}
                                    </td>
                                    <td class="textfixed">
                                        {{ $timesheetDatas->assignment_name ?? '' }}
                                        @if ($timesheetDatas->assignmentname != null)
                                            ({{ $timesheetDatas->assignmentname ?? '' }})
                                        @endif
                                    </td>
                                    <td>
                                        {{ $timesheetDatas->assignmentgenerate_id ?? '' }}
                                    </td>
                                    <td class="textfixed"> {{ $timesheetDatas->workitem ?? '' }}</td>
                                    <td class="textfixed">{{ $timesheetDatas->location ?? '' }} </td>
                                    <td class="textfixed"> {{ $timesheetDatas->patnername ?? '' }}
                                    </td>
                                    <td>{{ $timesheetDatas->ptnrstaffcode ?? ($timesheetDatas->patnerstaffcodee ?? '') }}
                                    </td>
                                    <td>{{ $timesheetDatas->hour ?? '' }}</td>
                                    <td>
                                        @if ($timesheetDatas->status == 0)
                                            <span class="badge badge-pill badge-warning">Saved</span>
                                        @elseif ($timesheetDatas->status == 1 || $timesheetDatas->status == 3)
                                            <span class="badge badge-pill badge-danger">Submit</span>
                                        @else
                                            <span class="badge badge-pill badge-secondary">Rejected</span>
                                        @endif
                                    </td>
                                    @if (Auth::user()->role_id == 11 || Auth::user()->teammember_id != $timesheetDatas->createdby)
                                        <td>

                                            @if ($timesheetDatas->assignmentgenerate_id != null)
                                                <a href="{{ url('/timesheet/reject/' . $timesheetDatas->id) }}"
                                                    onclick="return confirm('Are you sure you want to Reject this timesheet?');">
                                                    <button class="btn btn-danger"
                                                        style="height: 16px; width: auto; border-radius: 7px; display: flex; align-items: center; justify-content: center; font-size: 11px;"
                                                        {{ $timesheetDatas->status == 2 ? 'disabled' : '' }}>
                                                        Reject
                                                    </button>
                                                </a>
                                            @else
                                                <span>NA</span>
                                            @endif
                                        </td>
                                    @endif
                                </tr>
                            @endforeach   

Rejoining/Promotion features Deployed ```end
Client want to implement Rejoining process to users.

vsalocal, vsademo ```end 



vsalocal, ```start

this task related to acending and decending icon on tables
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\client\clientlist.blade.php

replace it
{{-- <link href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css" rel="stylesheet"> --}}
<link href="https://cdn.datatables.net/buttons/1.7.1/css/buttons.dataTables.min.css" rel="stylesheet">



add on tables
 <table id="examplee" class="table table-bordered table-striped table-hover">
  
check </tbody> 
   
   
   

add this style 
resources\views\backEnd\layouts\includes\stylesheet.blade.php

@if (Request::is('client-list') || Request::is('client-list'))
    <style>
        #examplee {
            width: 100%;
            table-layout: auto;
            /* Columns adjust based on content */
            white-space: nowrap;
            /* Prevent text wrapping */
        }

        #examplee th,
        #examplee td {
            padding: 8px;
            /* Add spacing for better readability */
            text-align: left;
        }

        #examplee th {
            white-space: nowrap;
            /* Prevent column headers from wrapping */
        }
    </style>
@endif
 
this task related to acending and decending icon on tables end 






Dashboard - Client Box (UI-Text)
Dashboard - signout and assignment box (UI-fixed)
vsalocal, vsademo , vsalive  
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\index.blade.php

1.Active Clients

2.Active Member




resources\views\backEnd\index.blade.php
  @if (Auth::user()->role_id == 13)
<a href="{{ url('assignment_report') }}">
 
 
                         <a href="{{ url('assignment_report') }}">
                            <div style="color:white;"
                                class="opacity-50 header-pretitle fs-11 font-weight-bold text-uppercase">Assignment
                            </div>
                            <div style="color:white;" class="fs-32 text-monospace">{{ $assignmentcount }}</div>
                            <small style="color:white;">Open Assignment</small>
                        </a>
		

		
						
						
  @if (Auth::user()->role_id == 14)			
						
                        <a href="{{ url('assignment_report') }}">
                            <div style="color:white;"
                                class="opacity-50 header-pretitle fs-11 font-weight-bold text-uppercase">Assignment
                            </div>
                            <div style="color:white;" class="fs-32 text-monospace">{{ $assignmentcount }}</div>
                            <small style="color:white;">Open Assignment</small>
                        </a>				
						
	
	
	

	
resources\views\backEnd\layouts\includes\header.blade.php
<div class="dropdown-menu dropdown-menu-left"

	 <div class="dropdown-menu dropdown-menu-left" style="margin-left: -110px;">

	 

Dashboard - signout and assignment box (UI-fixed) 
Dashboard - Client Box (UI-Text)  end

vsalocal, ```end



22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\TimesheetController.php



22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\ApplyleaveController.php



























